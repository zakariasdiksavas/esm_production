import{d as w,aa as T,r as j,ae as $,l as a,j as e,au as R,ba as x,a9 as S,a as k,ab as N,a7 as V,T as B,a2 as A,aF as H,a4 as W}from"./index-5b79c039.js";import{G as D,B as P,e as q,T as z,a as O,b as y,c as l,d as Q,S as F,u as M,E as G,h as _}from"./moment-864131f4.js";import{E as U}from"./Eye-655a27ed.js";import{C as Y,T as J}from"./TableRowsLoader-23cb4167.js";import{u as K,c as X,e as L,C as I,b as Z}from"./formik.esm-f8b1f355.js";import{F as ee}from"./FilePreview-1d12d7cb.js";import{C as te}from"./CardHeader-0df2b094.js";import{C as ae}from"./CardActions-a1a436e4.js";import{D as E}from"./DatePicker-9add668e.js";import{A as se}from"./AlertError-96b329d4.js";import{T as ie}from"./TextSnippet-080a66bc.js";import{M as ne}from"./ModalDetails-8e2290ae.js";import"./KeyboardArrowUp-c6409d2a.js";import"./fr-4efeb1d7.js";import"./FilterAlt-785cb8e5.js";import"./Tabs-0c73418c.js";function re({id:p}){const{t:o,i18n:b}=w(),d=T(),[n,h]=j.useState(!1),[r,g]=j.useState(""),{isModalDisplayDoc:f}=$(i=>i.situationFournisseur),s=K({initialValues:{date1:null,date2:null},validationSchema:X({date1:L().nullable().test("is-before-date2",o(a.global.date2Greather),function(i){const{date2:u}=this.parent;return i<=u}),date2:L().nullable().test("is-after-date1",o(a.global.date2Greather),function(i){const{date1:u}=this.parent;return i>=u})}),onSubmit:async(i,{resetForm:u,setErrors:t})=>{let c="";for(let m in i)if(i[m]!==""&&i[m]!==null){let C=new Date(i[m]),v=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;c==""?c+=`?${m}=${v}`:c+=`&${m}=${v}`}g(`/suppliersituation/report/${p}/${c}`),h(!0)}});return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:f,onClose:()=>d(x.actions.openCloseModalDoc()),children:e.jsxs(I,{children:[e.jsx(te,{title:o(a.situationCliente.docTitle),sx:{borderBottom:i=>`0.5px solid ${i.palette.mode=="dark"?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,padding:2},action:e.jsx(S,{onClick:()=>d(x.actions.openCloseModalDoc()),children:e.jsx(Y,{})})}),e.jsxs("form",{onSubmit:s.handleSubmit,children:[e.jsx(Z,{children:e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date1,onChange:i=>s.setFieldValue("date1",i),onBlur:s.handleBlur,label:o(a.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date1&&s.errors.date1),helperText:s.touched.date1&&s.errors.date1}}})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date2,onChange:i=>s.setFieldValue("date2",i),onBlur:s.handleBlur,label:o(a.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date2&&s.errors.date2),helperText:s.touched.date2&&s.errors.date2}}})})]})}),e.jsxs(ae,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(k,{variant:"outlined",color:"error",onClick:()=>d(x.actions.openCloseModalDoc()),children:o(a.client.deleteCancel)}),e.jsx(k,{variant:"contained",type:"submit",children:o(a.situationCliente.afficher)})]})]})]})}),n&&e.jsx(ee,{close:()=>h(!1),isPreview:n,file:{file:r}})]})}function oe({isLoading:p,setData:o,setLink:b,isError:d}){const{t:n,i18n:h}=w(),{situationFournisseur:r}=$(t=>t.situationFournisseur),g=T(),[f,s]=j.useState(),i=t=>{console.log(t),o(t),g(x.actions.setCurrentData(t))},u=t=>{s(t),g(x.actions.openCloseModalDoc())};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(I,{children:e.jsx(q,{component:N,children:e.jsxs(z,{children:[e.jsx(O,{children:e.jsxs(y,{children:[e.jsx(l,{children:n(a.fournisseur.title)}),e.jsxs(l,{children:[n(a.situationFournisseur.totalEntrees)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.totalPaiment)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.paymentProgress)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.paymentEchec)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.debt)," ",n(a.global.mad)]}),e.jsx(l,{})]})}),p?e.jsx(J,{rowsNum:10}):e.jsx(Q,{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map(t=>{const c=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsx(e.Fragment,{children:e.jsxs(y,{children:[e.jsx(l,{children:e.jsxs(F,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(V,{sx:{bgcolor:"rgb(19, 194, 194)",color:"white",width:45,height:45},children:t.first_name[0]+" "+t.last_name[0]}),e.jsxs("div",{children:[t.first_name+" "+t.last_name,e.jsx(B,{color:"text.secondary",variant:"body2",children:t.email})]})]})}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:c.format(t.sum_inbound_price).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{style:{fontWeight:"bold"},sx:{direction:"initial",whiteSpace:"nowrap"},children:c.format(t.sum_payment_payed).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{sx:{color:m=>m.palette.warning.main,fontWeight:"600",direction:"initial",whiteSpace:"nowrap"},children:c.format(t.sum_payment_in_progress).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:t.sum_payment_invalid>0?"red":"green"},children:c.format(t.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:t.solde>=0?"green":"red"},children:c.format(t.solde).replaceAll(","," ").replace("MAD","")})}),e.jsxs(l,{children:[e.jsx(S,{color:"info",onClick:()=>i(t.eggsource),children:e.jsx(A,{children:e.jsx(U,{})})}),e.jsx(H,{title:"Telecharger document du situation fournisseur",children:e.jsx(S,{color:"primary",onClick:()=>u(t.eggsource),children:e.jsx(A,{children:e.jsx(ie,{})})})})]})]})})}):e.jsx(y,{children:e.jsx(l,{colSpan:5,sx:{textAlign:"center"},children:n(a.magazin.nothingToDisplay)})})})]})})}),d&&e.jsx(se,{})]}),e.jsx(re,{id:f})]})}function le(){const p=T(),[o,b]=j.useState(),[d,n]=j.useState(""),h=M("clients",_.getClientFournisseur),r=M(["client",o,d],()=>_.getFournisseurSituationDetails(o,d)),[g,f]=j.useState(),{t:s,i18n:i}=w(),u=c=>{b(c)},t=c=>n(c);return j.useEffect(()=>{!h.isLoading&&r.data==0&&p(x.actions.fetchSituationFournisseur(h.data)),r.status=="success"&&r.data!==0&&o!==""&&(p(x.actions.setFournisseurSituationForOneFournisseur({id:o})),p(x.actions.fetchFournisseurSituationDetails({data:r.data})),b(void 0))},[h.isLoading,r.isLoading,o,d]),e.jsx(e.Fragment,{children:e.jsxs(G,{children:[r.isLoading&&e.jsx(W,{}),e.jsx(P,{component:"main",sx:{flexGrow:1,p:3},children:e.jsxs(F,{spacing:4,children:[e.jsx(F,{spacing:1,children:e.jsx(B,{variant:"h4",children:s(a.situationFournisseur.title)})}),e.jsx(oe,{isLoading:h.isLoading,isError:h.isError,details:g,setData:u,setLink:t,isLoadingDetails:r.isLoading})]})}),e.jsx(ne,{})]})})}function we(){return e.jsx(e.Fragment,{children:e.jsx(G,{children:e.jsx(le,{})})})}export{we as default};
