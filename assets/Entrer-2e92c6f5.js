import{r as D,ao as we,a2 as $,d as E,j as e,B as De,a3 as Se,l as t,a1 as z,V as Z,al as Be,bk as u,h as M,ab as Y,ac as J,ad as G,ae as W,a as A,a6 as O,T as H,a7 as K,F as ie,Y as q,b3 as Te,bl as Ne,U as le,bm as he,k as U,S as ke}from"./index-bffffd5d.js";import{e as me,T as xe,a as pe,b as R,c as b,d as ge,f as _e,g as Me,G as S,u as se,S as _,h as Ee,B as ee,j as Ae,E as ve}from"./moment-c1228ca8.js";import{E as je,P as qe,M as Fe}from"./ModalDelete-6c83eee3.js";import{T as Ie,C as te}from"./TableRowsLoader-1fe09bf9.js";import{A as $e}from"./AlertError-b5da0392.js";import{K as Pe,a as We,A as Oe}from"./KeyboardArrowUp-4b584357.js";import{D as Ve}from"./DeleteOutlineOutlined-6b34994d.js";import{A as Re}from"./Add-ee847921.js";import{u as ae,c as de,e as fe,C as ye,b as ze,d as oe}from"./formik.esm-51017e53.js";import{A as Ue,a as Le,F as Ye,b as Je}from"./fr-a1d10d63.js";import{E as Ge}from"./ExpandMore-933c5590.js";import{D as be}from"./DatePicker-b45e2a50.js";import{C as He}from"./Container-76ca21d5.js";import{M as Ke}from"./ModalConfirm-f66dfd05.js";import{m as L}from"./moment-52bdcb4a.js";import{D as Ce}from"./DateTimePicker-ccc7cb69.js";import"./Tabs-12df9ed9.js";const Qe=D.memo(i=>{const o=we(),a=$();let{count:s=0,items:h=[],onDeselectAll:x,onDeselectOne:l,onSelectAll:r,onSelectOne:j,selected:m=[],isLoading:B,isError:n}=i;const[y,N]=D.useState(0),[c,k]=D.useState(25),T=JSON.parse(sessionStorage.getItem("user")),{t:f,i18n:P}=E(),[Q,re]=D.useState({}),F=p=>{re(d=>({...d,[p]:!d[p]}))},X=(p,d)=>{M.get(`/inbound/find/${p}`).then(C=>{switch(a(u.actions.setCurrentData(C.data)),d){case"update":a(u.actions.openCloseModalUpdate());break;case"delete":a(u.actions.openCloseModalDelete());break;case"addDetails":a(u.actions.openCloseModalAddDetails());break}})},g=(p,d)=>{N(d)},ce=p=>{k(parseInt(p.target.value,10)),N(0)},ne=h==null?void 0:h.slice(y*c,y*c+c);return e.jsxs(De,{sx:{position:"relative"},children:[e.jsx(me,{component:Se,children:e.jsxs(xe,{sx:{minWidth:700,"& .MuiTableCell-body":{padding:"2px 18px"}},size:"small","aria-label":"a dense table",children:[e.jsx(pe,{children:e.jsxs(R,{children:[e.jsx(b,{align:"left"}),e.jsx(b,{align:"left",children:T!=null&&T.is_eleveur?f(t.batiment.Nom):f(t.fournisseur.Nom)}),e.jsx(b,{align:"left",children:f(t.magazin.Nom)}),e.jsx(b,{align:"left",children:f(t.entrer.date)}),e.jsx(b,{align:"left",children:f(t.entrer.temps)}),e.jsx(b,{align:"left"})]})}),B?e.jsx(Ie,{rowsNum:10}):e.jsx(ge,{children:ne.length>0?ne.map((p,d)=>{const C=Q[p.id]||!1;let w=new Date(p.date),v={year:w.getFullYear(),month:`${w.getMonth()+1}`,day:`${w.getDate()}`};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{hover:!1,sx:{backgroundColor:d%2!==0?C?o.palette.mode=="dark"?o.palette.primary.dark:o.palette.primary.light:o.palette.mode==="dark"?o.palette.grey[900]:o.palette.grey[100]:C?o.palette.mode=="dark"?o.palette.primary.dark:o.palette.primary.light:"transparent"},children:[e.jsx(b,{children:p.inbound_details.length!==0&&e.jsx(z,{"aria-label":"expand row",size:"small",onClick:()=>F(p.id),children:C?e.jsx(Pe,{}):e.jsx(We,{})})}),e.jsx(b,{align:"left",children:p.eggsource_name}),e.jsx(b,{align:"left",children:p.warehouse_name}),e.jsxs(b,{align:"left",children:[v.day.padStart(2,0),"/",v.month.padStart(2,0),"/",v.year]}),e.jsx(b,{align:"left",children:p.time.substring(0,5)}),e.jsxs(b,{children:[e.jsx(z,{color:"warning",onClick:()=>X(p.id,"update"),children:e.jsx(Z,{children:e.jsx(je,{})})}),e.jsx(z,{color:"error",onClick:()=>X(p.id,"delete"),children:e.jsx(Z,{children:e.jsx(Ve,{})})}),p.inbound_details.length==0&&e.jsx(z,{color:"success",onClick:()=>X(p.id,"addDetails"),children:e.jsx(Z,{children:e.jsx(Re,{})})})]})]},p.id),e.jsx(R,{children:e.jsx(b,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(Be,{in:C,timeout:"auto",unmountOnExit:!0,children:e.jsx(me,{children:e.jsxs(xe,{children:[e.jsx(pe,{children:e.jsxs(R,{children:[e.jsxs(b,{children:[f(t.sortie.eggType)," "]}),e.jsx(b,{children:f(t.entrer.quantity)}),!(T!=null&&T.is_eleveur)&&e.jsxs(b,{children:[f(t.entrer.prix)," ",f(t.global.mad)]}),e.jsx(b,{})]})}),e.jsx(ge,{children:p.inbound_details.map((V,I)=>e.jsxs(R,{sx:{backgroundColor:I%2!==0?o.palette.mode==="dark"?o.palette.grey[900]:o.palette.grey[100]:"transparent","&:hover":{backgroundColor:o.palette.mode==="dark"?o.palette.grey[800]:o.palette.grey[200]}},children:[e.jsx(b,{children:V.egg_class}),e.jsx(b,{children:V.quantity}),!(T!=null&&T.is_eleveur)&&e.jsx(b,{children:V.price}),e.jsxs(b,{children:[" ",e.jsx(z,{color:"info",onClick:()=>a(u.actions.setCurrentDetailData({id:p.id,id_details:V.id})),children:e.jsx(Z,{children:e.jsx(je,{})})})]})]},I))})]})})})})})]})}):e.jsx(R,{children:e.jsx(b,{colSpan:7,sx:{textAlign:"center"},children:f(t.magazin.nothingToDisplay)})})})]})}),e.jsx(_e,{component:"div",count:s,onPageChange:g,onRowsPerPageChange:ce,page:y,rowsPerPage:c,rowsPerPageOptions:[5,10,25],labelRowsPerPage:f(t.magazin.Lignes),labelDisplayedRows:({from:p,to:d,count:C})=>`${p}–${d} ${f(t.magazin.sur)} ${C}`}),n&&e.jsx($e,{})]})});function Xe({batiment:i,magazin:o}){Me.locale("fr");const{t:a,i18n:s}=E(),h=$(),x=JSON.parse(sessionStorage.getItem("user")),l=ae({initialValues:{date1:null,date2:null,warehouse:"",eggsource:""},validationSchema:de({date1:fe().nullable().test("is-before-date2",a(t.global.date2Greather),function(r){const{date2:j}=this.parent;return r<=j}),date2:fe().nullable().test("is-after-date1",a(t.global.date2Greather),function(r){const{date1:j}=this.parent;return r>=j})}),onSubmit:async(r,{resetForm:j,setErrors:m})=>{let B="";for(let n in r)if(r[n]!==""&&r[n]!==null){let y=new Date(r[n]),N=y.getFullYear()!==1970?`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}-${String(y.getDate()).padStart(2,"0")}`:r[n];B==""?B+=`?${n}=${N}`:B+=`&${n}=${N}`}if(r.date1!==null&&r.date2==null){m({date2:a(t.global.date2Required)});return}else if(r.date1==null&&r.date2!==null){m({date1:a(t.global.date1Required)});return}M.get("/inbound/list/"+B).then(n=>{h(u.actions.fetchEntrer(n.data))})},onReset:()=>{M.get("/inbound/list/").then(r=>{h(u.actions.fetchEntrer(r.data))})}});return e.jsxs(Ue,{defaultExpanded:!0,children:[e.jsx(Le,{expandIcon:e.jsx(Ge,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(Ye,{}),a(t.global.filter)]})}),e.jsx(Je,{children:e.jsx(ye,{children:e.jsx(ze,{children:e.jsx("form",{noValidate:!0,onSubmit:l.handleSubmit,onReset:l.handleReset,children:e.jsxs(S,{container:!0,alignItems:"center",gap:2,children:[e.jsx(S,{item:!0,xs:12,md:2,sm:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(J,{id:"batiment-id",children:x!=null&&x.is_eleveur?a(t.batiment.Nom):a(t.fournisseur.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:l.handleBlur,fullWidth:!0,name:"eggsource",onChange:l.handleChange,value:l.values.eggsource,label:x!=null&&x.is_eleveur?a(t.batiment.Nom):a(t.fournisseur.Nom),children:i==null?void 0:i.map(r=>e.jsx(W,{value:r.id,children:r.name}))})]})}),e.jsx(S,{items:!0,xs:12,md:2,sm:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(J,{id:"batiment-id",children:a(t.magazin.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:l.handleBlur,fullWidth:!0,name:"warehouse",onChange:l.handleChange,value:l.values.warehouse,label:a(t.batiment.Nom),children:o==null?void 0:o.map(r=>e.jsx(W,{value:r.id,children:r.name}))})]})}),e.jsx(S,{item:!0,xs:12,md:2,sm:12,children:e.jsx(be,{value:l.values.date1,onChange:r=>l.setFieldValue("date1",r),onBlur:l.handleBlur,label:a(t.global.date1),name:"date1",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",error:!!(l.touched.date1&&l.errors.date1),helperText:l.touched.date1&&l.errors.date1}}})}),e.jsx(S,{item:!0,xs:12,md:2,sm:12,children:e.jsx(be,{value:l.values.date2,onChange:r=>l.setFieldValue("date2",r),onBlur:l.handleBlur,label:a(t.global.date2),name:"date2",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",error:!!(l.touched.date2&&l.errors.date2),helperText:l.touched.date2&&l.errors.date2}}})}),e.jsxs(S,{item:!0,container:!0,xs:12,md:2,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(S,{items:!0,children:e.jsx(A,{variant:"contained",type:"reset",children:a(t.global.reset)})}),e.jsx(S,{items:!0,children:e.jsx(A,{type:"submit",variant:"contained",children:a(t.global.filter)})})]})]})})})})})]})}function Ze({batiment:i,magazin:o}){const a=$(),{t:s,i18n:h}=E(),{entrer:x}=O(j=>j.entrer),l=se("entrers",Ee.getEntrer),r=JSON.parse(sessionStorage.getItem("user"));return D.useEffect(()=>{l.status=="success"&&a(u.actions.fetchEntrer(l.data))},[l.status]),e.jsx(He,{maxWidth:"xl",children:e.jsxs(_,{spacing:4,children:[e.jsxs(_,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(_,{spacing:1,children:e.jsx(H,{variant:"h4",children:r!=null&&r.is_eleveur?s(t.entrer.titleBreeder):s(t.entrer.titleDealer)})}),e.jsx(_,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(A,{startIcon:e.jsx(Z,{children:e.jsx(qe,{})}),variant:"contained",onClick:()=>a(u.actions.openCloseModalAdd()),children:s(t.global.ajouter)})})]}),e.jsxs(ye,{children:[e.jsx(Xe,{batiment:i,magazin:o}),e.jsx(Qe,{items:x,isLoading:l.isLoading,count:x.length,rowsPerPage:25,isError:l.isError})]})]})})}function ue({confirmed:i}){const{currentData:o,isConfirm:a}=O(r=>r.entrer),s=$(),{t:h,i18n:x}=E(),l=()=>{i()};return e.jsx(K,{open:a,onClose:()=>s(u.actions.openCloseConfirm()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Ke,{title:h(t.global.confirmOperation),message:h(t.global.confirmMessage),confirmFn:l,cancel:()=>s(u.actions.openCloseConfirm())})})}const et={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function tt({batiment:i,magazin:o}){L.locale("fr");const a=JSON.parse(sessionStorage.getItem("user")),s=$(),{t:h,i18n:x}=E(),{currentData:l,isModalUpdate:r}=O(c=>c.entrer),[j,m]=D.useState(new Date),B=de({warehouse:oe().required(),eggsource:oe().required()}),n=ae({initialValues:{warehouse:"",eggsource:"",dateTime:""},validationSchema:B,onSubmit:async(c,{resetForm:k,setErrors:T})=>{let f={...c};f.date=L(j).format("YYYY-MM-DD"),f.time=L(j).format("LT"),M.put("/inbound/update/",f).then(P=>{s(u.actions.editEntrer(P.data)),s(u.actions.openCloseModalUpdate()),s(u.actions.openCloseConfirm()),q.success(a!=null&&a.is_eleveur?h(t.entrer.toastAddSuccessBreeder):h(t.entrer.toastAddSuccessDealer)),k()}).catch(P=>{s(u.actions.openCloseConfirm()),q.error(h(t.entrer.toastError))})}}),y=async c=>{c.preventDefault();const k=await n.validateForm();Object.keys(k).length===0?s(u.actions.openCloseConfirm()):await n.submitForm()},N=()=>{n.handleSubmit()};return D.useEffect(()=>{n.setValues(l),m(new Date(`${l.date}T${l.time}`)),n.setFieldValue("dateTime",new Date,!1)},[n.errors]),e.jsxs(e.Fragment,{children:[e.jsx(K,{open:r,onClose:()=>s(u.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:et,children:[e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(H,{id:"modal-modal-title",variant:"h6",component:"h2",children:a!=null&&a.is_eleveur?h(t.entrer.updateBreeder):h(t.entrer.updateDealer)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>s(u.actions.openCloseModalUpdate()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:c=>y(c),children:[e.jsxs(Y,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.eggsource&&n.errors.eggsource),children:[e.jsx(J,{id:"batiment-id",children:a!=null&&a.is_eleveur?h(t.batiment.Nom):h(t.fournisseur.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"eggsource",onChange:n.handleChange,value:n.values.eggsource,label:a!=null&&a.is_eleveur?h(t.batiment.Nom):h(t.fournisseur.Nom),children:i.map(c=>e.jsx(W,{value:c.id,children:c.name}))}),n.touched.eggsource&&n.errors.eggsource&&e.jsx(ie,{children:n.errors.eggsource})]}),e.jsxs(Y,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.warehouse&&n.errors.warehouse),children:[e.jsx(J,{id:"batiment-id",children:h(t.magazin.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"warehouse",onChange:n.handleChange,value:n.values.warehouse,label:h(t.batiment.Nom),children:o.map(c=>e.jsx(W,{value:c.id,children:c.name}))}),n.touched.warehouse&&n.errors.warehouse&&e.jsx(ie,{children:n.errors.warehouse})]}),e.jsx(Ce,{id:"outlined-basic",label:h(t.entrer.temps)+" "+h(t.entrer.date),variant:"outlined",onBlur:n.handleBlur,fullWidth:!0,name:"dateTime",value:j,onChange:c=>{n.setFieldValue("dateTime",c,!0),m(c)},slotProps:{textField:{variant:"outlined",error:!!(n.touched.dateTime&&n.errors.dateTime),helperText:!!(n.touched.dateTime&&n.errors.dateTime)}},sx:{marginBottom:"15px",width:"100%"}}),e.jsx(A,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:h(t.global.modifier)})]})]})}),e.jsx(ue,{confirmed:N})]})}const at={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function rt({batiment:i,magazin:o}){L.locale("fr");const a=$(),{t:s,i18n:h}=E(),{entrer:x,isModalAdd:l}=O(c=>c.entrer),[r,j]=D.useState(new Date),m=JSON.parse(sessionStorage.getItem("user")),B=de({warehouse:oe().required(s(t.sortie.magazinRequired)),eggsource:oe().required(m!=null&&m.is_eleveur?s(t.sortie.batimentRequired):s(t.sortie.fournisseurRequired))}),n=ae({initialValues:{warehouse:"",eggsource:"",dateTime:""},validationSchema:B,onSubmit:async(c,{resetForm:k,setErrors:T})=>{let f={...c};f.date=L(r).format("YYYY-MM-DD"),f.time=L(r).format("LT"),M.post("/inbound/add/",f).then(P=>{a(u.actions.addEntrer(P.data)),a(u.actions.openCloseModalAdd()),a(u.actions.openCloseConfirm()),q.success(m!=null&&m.is_eleveur?s(t.entrer.toastAddSuccessBreeder):s(t.entrer.toastAddSuccessDealer)),k()}).catch(P=>{a(u.actions.openCloseConfirm()),q.error(s(t.entrer.toastError))})}}),y=async c=>{c.preventDefault();const k=await n.validateForm();Object.keys(k).length===0?a(u.actions.openCloseConfirm()):await n.submitForm()},N=()=>{n.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(K,{open:l,onClose:()=>a(u.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:at,children:[e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(H,{id:"modal-modal-title",variant:"h6",component:"h2",children:m!=null&&m.is_eleveur?s(t.entrer.addBreeder):s(t.entrer.addDealer)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(u.actions.openCloseModalAdd()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:c=>y(c),children:[e.jsxs(Y,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.eggsource&&n.errors.eggsource),children:[e.jsx(J,{id:"batiment-id",children:m!=null&&m.is_eleveur?s(t.batiment.Nom):s(t.fournisseur.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"eggsource",onChange:n.handleChange,value:n.values.eggsource,label:m!=null&&m.is_eleveur?s(t.batiment.Nom):s(t.fournisseur.Nom),children:i.length>0?i.map(c=>e.jsx(W,{value:c.id,children:c.name},c.id)):e.jsx(W,{children:s(t.batiment.nothingToDisplay)})}),n.touched.eggsource&&n.errors.eggsource&&e.jsx(ie,{children:n.errors.eggsource})]}),e.jsxs(Y,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.warehouse&&n.errors.warehouse),children:[e.jsx(J,{id:"batiment-id",children:s(t.magazin.Nom)}),e.jsx(G,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"warehouse",onChange:n.handleChange,value:n.values.warehouse,label:s(t.batiment.Nom),children:o.length>0?o.map(c=>e.jsx(W,{value:c.id,children:c.name},c.id)):e.jsx(W,{children:s(t.batiment.nothingToDisplay)})}),n.touched.warehouse&&n.errors.warehouse&&e.jsx(ie,{children:n.errors.warehouse})]}),e.jsx(Ce,{id:"outlined-basic",label:s(t.entrer.temps)+" "+s(t.entrer.date),variant:"outlined",onBlur:n.handleBlur,fullWidth:!0,name:"dateTime",value:r,onChange:c=>{n.setFieldValue("dateTime",c,!0),j(c)},slotProps:{textField:{variant:"outlined",error:!!(n.touched.dateTime&&n.errors.dateTime),helperText:!!(n.touched.dateTime&&n.errors.dateTime)}},sx:{marginBottom:"15px",width:"100%"}}),e.jsx(A,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:s(t.global.ajouter)})]})]})}),e.jsx(ue,{confirmed:N})]})}function nt(){const{currentData:i,isModalDelete:o}=O(j=>j.entrer),a=$(),{t:s,i18n:h}=E(),x=JSON.parse(sessionStorage.getItem("user")),l=()=>{M.delete(`/inbound/delete/${i.id}`).then(j=>{a(u.actions.deleteEntrer()),a(u.actions.openCloseModalDelete()),q.success(x!=null&&x.is_eleveur?s(t.entrer.toastDeleteSuccessBreeder):s(t.entrer.toastDeleteSuccessDealer))}).catch(j=>{a(u.actions.openCloseModalDelete()),q.error(s(t.entrer.toastError))})},r=`${x!=null&&x.is_eleveur?s(t.entrer.deleteDescriptionBreeder):s(t.entrer.deleteDescriptionDealer)}`;return e.jsx(K,{open:o,onClose:()=>a(u.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Fe,{title:x!=null&&x.is_eleveur?s(t.entrer.deleteTitleBreeder):s(t.entrer.deleteTitleDealer),message:r,deleteFn:l,cancel:()=>a(u.actions.openCloseModalDelete())})})}function st({title:i,closeFunction:o}){return e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px",p:"1px"},children:[e.jsx(H,{id:"modal-modal-title",variant:"h6",component:"h2",children:i}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(),children:e.jsx(te,{})})]})}const it={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:2};function lt({eggClass:i}){const o=$(),{t:a,i18n:s}=E(),{entrer:h,currentData:x,isModalAddDetails:l}=O(d=>d.entrer),r=JSON.parse(sessionStorage.getItem("user")),[j,m]=D.useState(0),[B,n]=D.useState(0),[y,N]=D.useState(0),[c,k]=D.useState({}),[T,f]=D.useState(0),[P,Q]=D.useState(!1),re=i==null?void 0:i.findIndex(d=>d.egg_class_id==10),[F,X]=D.useState({Normaux:[],Declasse:[]}),g=ae({initialValues:{},validationSchema:"",onSubmit:async(d,{resetForm:C,setErrors:w})=>{const v=Object.keys(d).map(I=>({option:d[I].option,price:d[I].pu,quantity:d[I].qte}));let V={id:x.id,values:v};M.post("/inbound/detail/add/",V).then(I=>{o(u.actions.addDetailsEnter({details:I.data,id:x.id})),q.success(a(t.entrer.toastAddSuccess)),Q(!1),C()}).catch(I=>{o(u.actions.openCloseConfirm()),q.error(a(t.entrer.toastError))})}}),ce=d=>{d.preventDefault(),Q(!0)},ne=()=>{g.handleSubmit()},p=d=>C=>{if(C.target.name.includes("qte")||C.target.name.includes("pu")){m(0),n(0),f(0),console.log(g.values);for(let w in g.values)r!=null&&r.is_eleveur||(f(v=>v+g.values[w].pu*g.values[w].qte),k(v=>({...v,[w]:g.values[w].pu*g.values[w].qte}))),g.values[w].option<=6?m(v=>v+g.values[w].qte):g.values[w].option==10?N(g.values[w].qte):n(v=>v+g.values[w].qte)}d(C)};return D.useEffect(()=>{let d={};i==null||i.map(v=>{d[v.id]={qte:0,pu:0,option:v.egg_class_id}});const C=i==null?void 0:i.filter(v=>v.egg_class_id<=6),w=i==null?void 0:i.filter(v=>v.egg_class_id>=7);X({Normaux:C,Declasse:w}),g.setValues(d)},[]),e.jsxs(e.Fragment,{children:[Object.keys(g.values).length!==0&&e.jsxs(Te,{fullScreen:!0,open:l,onClose:()=>o(u.actions.openCloseModalAddDetails()),children:[e.jsx(Oe,{sx:{position:"relative"},children:e.jsxs(Ae,{children:[e.jsx(z,{edge:"start",color:"inherit",onClick:()=>o(u.actions.openCloseModalAddDetails()),"aria-label":"close",children:e.jsx(te,{})}),e.jsx(H,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:r!=null&&r.is_eleveur?a(t.entrer.addDetailsBreeder):a(t.entrer.addDetailsDealer)})]})}),e.jsx(Ne,{sx:{p:1},children:e.jsxs("form",{noValidate:!0,onSubmit:d=>ce(d),children:[e.jsxs(S,{container:!0,spacing:2,children:[F.Normaux.length>0&&e.jsxs(S,{item:!0,spacing:2,xs:12,md:6,children:[e.jsxs("h1",{className:"font-bold text-center text-lg",children:[a(t.entrer.nomeaux)," "]}),F.Normaux.map((d,C)=>e.jsxs(S,{item:!0,xs:12,mt:1,children:[e.jsx(le,{children:e.jsx(he,{label:d.value,size:"small"})}),e.jsxs(_,{direction:"row",alignItems:"center",justifyItems:"center",flexWrap:"wrap",gap:1,mt:2,children:[e.jsx(U,{id:"outlined-basic",label:a(t.entrer.quantity),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.qte`,onBlur:p(g.handleBlur),onChange:g.handleChange,value:g.values[d.id].qte,style:{flexBasis:r!=null&&r.is_eleveur?"100%":"48%"}}),!(r!=null&&r.is_eleveur)&&e.jsx(U,{id:"outlined-basic",label:a(t.entrer.prix),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.pu`,onBlur:p(g.handleBlur),onChange:g.handleChange,value:g.values[d.id].pu,style:{flexBasis:r!=null&&r.is_eleveur?"100%":"48%"}}),!(r!=null&&r.is_eleveur)&&e.jsxs("span",{style:{flexBasis:"100%",textAlign:s.language=="ar"?"right":"left"},children:[a(t.entrer.total)," ",c[d.id]]})]})]}))]}),e.jsxs(S,{item:!0,spacing:2,xs:12,md:6,children:[F.Declasse.length>0&&e.jsx("h1",{className:"font-bold text-center text-lg",children:a(t.entrer.declasse)}),F.Declasse.map((d,C)=>e.jsxs(S,{item:!0,xs:12,mt:1,children:[e.jsx(le,{children:e.jsx(he,{label:`${d.value}`,size:"small"})}),e.jsxs(_,{direction:"row",alignItems:"center",justifyItems:"center",flexWrap:"wrap",gap:1,mt:2,children:[e.jsx(U,{id:"outlined-basic",label:d.egg_class_id==10?`${a(t.entrer.quantity)} (kg)`:a(t.entrer.quantity),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.qte`,onBlur:p(g.handleBlur),onChange:g.handleChange,value:g.values[d.id].qte,style:{flexBasis:r!=null&&r.is_eleveur?"100%":"48%"}}),!(r!=null&&r.is_eleveur)&&e.jsx(U,{id:"outlined-basic",label:a(t.entrer.prix),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.pu`,onBlur:p(g.handleBlur),onChange:g.handleChange,value:g.values[d.id].pu,style:{flexBasis:r!=null&&r.is_eleveur?"100%":"48%"}}),!(r!=null&&r.is_eleveur)&&e.jsxs("span",{style:{flexBasis:"100%",textAlign:s.language=="ar"?"right":"left"},children:[a(t.entrer.total)," ",c[d.id]]})]})]})),e.jsx(_,{sx:{backgroundColor:d=>d.palette.mode==="dark"?"neutral.800":"error.lightest",borderRadius:2.5,p:1,mt:3},children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-around mb-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[a(t.entrer.nomeaux)," : "]}),e.jsx("p",{children:j})]}),F.Declasse.length>0&&e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[a(t.entrer.declasse)," : "]}),e.jsx("p",{children:B})]}),re!==-1&&e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[i[re].value," : "]}),e.jsxs("p",{children:[y,"kg"]})]}),e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:a(t.entrer.total)}),e.jsx("p",{children:j+B})]}),!(r!=null&&r.is_eleveur)&&e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:a(t.entrer.totalPrice)}),e.jsx("p",{children:T})]})]})]})}),F.Declasse.length==0&&e.jsx(A,{fullWidth:!0,size:"large",sx:{mt:2,mb:2},type:"submit",variant:"contained",children:r!=null&&r.is_eleveur?a(t.entrer.addDetailsBreeder):a(t.entrer.addDetailsDealer)})]})]}),F.Declasse.length>0&&e.jsx(A,{fullWidth:!0,size:"large",sx:{mt:1,mb:1},type:"submit",variant:"contained",children:a(t.global.ajouter)})]})})]}),e.jsx(ot,{isOpen:P,confirmed:ne,close:()=>{Q(!1)},data:{type1:j,type2:B,weight:y}})]})}const ot=({isOpen:i,confirmed:o,close:a,data:s})=>{const{t:h,i18n:x}=E();return e.jsx(K,{open:i,children:e.jsxs(ee,{sx:it,children:[e.jsx(st,{title:h(t.client.confirmOperation),closeFunction:a}),e.jsxs("div",{className:"flex justify-around mb-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:"Normaux : "}),e.jsx("p",{children:s.type1})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:"Déclassés : "}),e.jsxs("p",{children:[s.type2," + ",s.weight," kg"]})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[h(t.entrer.total)," "]}),e.jsx("p",{children:s.type1+s.type2})]}),e.jsxs(S,{container:!0,mt:3,spacing:2,children:[e.jsx(S,{item:!0,xs:6}),e.jsx(S,{item:!0,xs:3,children:e.jsx(A,{variant:"contained",color:"error",onClick:a,children:h(t.client.deleteCancel)})}),e.jsx(S,{item:!0,xs:3,children:e.jsx(A,{variant:"contained",color:"success",onClick:o,children:h(t.client.deleteConfirm)})})]})]})})},dt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ct(){const i=$(),{t:o,i18n:a}=E(),{currentDetailData:s,isModalUpdateDetails:h}=O(m=>m.entrer),x=de({}),l=ae({initialValues:{quantity:0,price:0},validationSchema:x,onSubmit:async(m,{resetForm:B,setErrors:n})=>{console.log(s),M.put("/inbound/detail/update/",m).then(y=>{i(u.actions.updateDetailsLignes({id:m.inbound,id_details:m.id,details:y.data})),i(u.actions.openCloseModalUpdateDetails()),i(u.actions.openCloseConfirm()),q.success(o(t.entrer.toastAddSuccess)),B()}).catch(y=>{i(u.actions.openCloseConfirm()),i(u.actions.openCloseConfirm()),q.error(o(t.entrer.toastError))})}}),r=m=>{m.preventDefault(),i(u.actions.openCloseConfirm())},j=()=>{l.handleSubmit()};return D.useEffect(()=>{console.log(s),l.setValues(s)},[s]),e.jsxs(e.Fragment,{children:[e.jsx(K,{open:h,onClose:()=>i(u.actions.openCloseModalUpdateDetails()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:dt,children:[e.jsxs(_,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(H,{id:"modal-modal-title",variant:"h6",component:"h2",children:o(t.entrer.updateTitleDetails)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>i(u.actions.openCloseModalUpdateDetails()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:m=>r(m),children:[e.jsx(U,{id:"outlined-basic",label:o(t.entrer.quantity),variant:"outlined",onBlur:l.handleBlur,fullWidth:!0,type:"number",name:"quantity",onChange:l.handleChange,value:l.values.quantity,error:!!(l.touched.quantity&&l.errors.quantity),helperText:l.touched.quantity&&l.errors.quantity,style:{marginBottom:"15px"}}),e.jsx(U,{id:"outlined-basic",label:o(t.entrer.prix),variant:"outlined",onBlur:l.handleBlur,fullWidth:!0,type:"number",name:"price",onChange:l.handleChange,value:l.values.price,error:!!(l.touched.price&&l.errors.price),helperText:l.touched.price&&l.errors.price,style:{marginBottom:"15px"}}),e.jsx(A,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:o(t.entrer.updateTitleDetails)})]})]})}),e.jsx(ue,{confirmed:j})]})}const ut=async()=>{try{const{data:i}=await M.get("/eggsource/select/");return i}catch(i){throw new Error(i)}},ht=async()=>{try{const{data:i}=await M.get("/warehouse/select/");return i}catch(i){throw new Error(i)}},mt=async()=>{try{const{data:i}=await M.get("/class/list/");return i.map(o=>({...o,value:o.custom_name}))}catch(i){throw new Error(i)}};function xt(){const{isModalAdd:i,isModalUpdate:o,isModalAddDetails:a,isModalUpdateDetails:s}=O(r=>r.entrer),h=se("batimens",ut),x=se("magazins",ht),l=se("classLists",mt);return e.jsxs(ee,{component:"main",sx:{flexGrow:1,py:8},children:[e.jsx(ve,{children:e.jsx(Ze,{batiment:h.data,magazin:x.data})}),i&&e.jsx(rt,{batiment:h.data,magazin:x.data}),o&&e.jsx(tt,{batiment:h.data,magazin:x.data}),a&&e.jsx(lt,{eggClass:l.data}),s&&e.jsx(ct,{eggClass:l.data}),e.jsx(nt,{})]})}function Et(){const i=JSON.parse(sessionStorage.getItem("user")),{t:o,i18n:a}=E(),s=i!=null&&i.is_eleveur?o(t.nav.production):o(t.nav.achat);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:`ESM | ${s}`}),e.jsx(ve,{children:e.jsx(xt,{})})]})}export{Et as default};
