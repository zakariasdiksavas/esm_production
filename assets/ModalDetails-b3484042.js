import{r as S,y as ue,O as we,j as e,_ as v,a1 as F,n as fe,o as Se,s as B,ad as ve,ae as Ce,x as Te,bo as O,z,bA as Ie,bB as Re,A as Ae,a6 as k,a2 as xe,d as D,l as a,h as W,b2 as Y,a as J,a3 as K,bg as ge,al as Fe,V as Be,B as _e,i as Le,$ as Me,T as me,an as $e}from"./index-8b885c7c.js";import{u as ke,c as De,e as Q,C as be,b as Ne}from"./formik.esm-8d1d4924.js";import{a4 as X,a5 as Z,c as n,f as Ee,e as U,T as L,a as H,d as V,b as T,P as ze,B as G}from"./moment-a4ec633c.js";import{A as Ke,a as Ue,F as He,b as Ve}from"./fr-f2ae4e07.js";import{E as Ge}from"./ExpandMore-b942b62b.js";import{D as ee}from"./DatePicker-66d8edae.js";import{K as te,b as ae,T as Ye,a as ne}from"./Tabs-bdff0dea.js";import{T as je,K as qe,a as Oe,A as We}from"./KeyboardArrowUp-8cedb4c9.js";import{E as Je}from"./Eye-7bd27996.js";import{F as Qe}from"./FilePreview-9e5f6d41.js";import{C as Xe}from"./TableRowsLoader-05c4d608.js";var se,oe,le,re,ie,ce,de,he;const Ze=["backIconButtonProps","count","getItemAriaLabel","nextIconButtonProps","onPageChange","page","rowsPerPage","showFirstButton","showLastButton"],et=S.forwardRef(function(s,h){const{backIconButtonProps:r,count:l,getItemAriaLabel:o,nextIconButtonProps:i,onPageChange:P,page:c,rowsPerPage:g,showFirstButton:x,showLastButton:u}=s,I=ue(s,Ze),p=we(),j=b=>{P(b,0)},w=b=>{P(b,c-1)},m=b=>{P(b,c+1)},f=b=>{P(b,Math.max(0,Math.ceil(l/g)-1))};return e.jsxs("div",v({ref:h},I,{children:[x&&e.jsx(F,{onClick:j,disabled:c===0,"aria-label":o("first",c),title:o("first",c),children:p.direction==="rtl"?se||(se=e.jsx(X,{})):oe||(oe=e.jsx(Z,{}))}),e.jsx(F,v({onClick:w,disabled:c===0,color:"inherit","aria-label":o("previous",c),title:o("previous",c)},r,{children:p.direction==="rtl"?le||(le=e.jsx(te,{})):re||(re=e.jsx(ae,{}))})),e.jsx(F,v({onClick:m,disabled:l!==-1?c>=Math.ceil(l/g)-1:!1,color:"inherit","aria-label":o("next",c),title:o("next",c)},i,{children:p.direction==="rtl"?ie||(ie=e.jsx(ae,{})):ce||(ce=e.jsx(te,{}))})),u&&e.jsx(F,{onClick:f,disabled:c>=Math.ceil(l/g)-1,"aria-label":o("last",c),title:o("last",c),children:p.direction==="rtl"?de||(de=e.jsx(Z,{})):he||(he=e.jsx(X,{}))})]}))}),tt=et;function at(t){return Se("MuiTablePagination",t)}const nt=fe("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]),$=nt;var pe;const st=["ActionsComponent","backIconButtonProps","className","colSpan","component","count","getItemAriaLabel","labelDisplayedRows","labelRowsPerPage","nextIconButtonProps","onPageChange","onRowsPerPageChange","page","rowsPerPage","rowsPerPageOptions","SelectProps","showFirstButton","showLastButton"],ot=B(n,{name:"MuiTablePagination",slot:"Root",overridesResolver:(t,s)=>s.root})(({theme:t})=>({overflow:"auto",color:(t.vars||t).palette.text.primary,fontSize:t.typography.pxToRem(14),"&:last-child":{padding:0}})),lt=B(je,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(t,s)=>v({[`& .${$.actions}`]:s.actions},s.toolbar)})(({theme:t})=>({minHeight:52,paddingRight:2,[`${t.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[t.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${$.actions}`]:{flexShrink:0,marginLeft:20}})),rt=B("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(t,s)=>s.spacer})({flex:"1 1 100%"}),it=B("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(t,s)=>s.selectLabel})(({theme:t})=>v({},t.typography.body2,{flexShrink:0})),ct=B(ve,{name:"MuiTablePagination",slot:"Select",overridesResolver:(t,s)=>v({[`& .${$.selectIcon}`]:s.selectIcon,[`& .${$.select}`]:s.select},s.input,s.selectRoot)})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${$.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),dt=B(Ce,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(t,s)=>s.menuItem})({}),ht=B("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(t,s)=>s.displayedRows})(({theme:t})=>v({},t.typography.body2,{flexShrink:0}));function pt({from:t,to:s,count:h}){return`${t}–${s} of ${h!==-1?h:`more than ${s}`}`}function ut(t){return`Go to ${t} page`}const xt=t=>{const{classes:s}=t;return Ae({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},at,s)},gt=S.forwardRef(function(s,h){const r=Te({props:s,name:"MuiTablePagination"}),{ActionsComponent:l=tt,backIconButtonProps:o,className:i,colSpan:P,component:c=n,count:g,getItemAriaLabel:x=ut,labelDisplayedRows:u=pt,labelRowsPerPage:I="Rows per page:",nextIconButtonProps:p,onPageChange:j,onRowsPerPageChange:w,page:m,rowsPerPage:f,rowsPerPageOptions:b=[10,25,50,100],SelectProps:d={},showFirstButton:R=!1,showLastButton:N=!1}=r,M=ue(r,st),A=r,y=xt(A),_=d.native?"option":dt;let E;(c===n||c==="td")&&(E=P||1e3);const ye=O(d.id),q=O(d.labelId),Pe=()=>g===-1?(m+1)*f:f===-1?g:Math.min(g,(m+1)*f);return e.jsx(ot,v({colSpan:E,ref:h,as:c,ownerState:A,className:z(y.root,i)},M,{children:e.jsxs(lt,{className:y.toolbar,children:[e.jsx(rt,{className:y.spacer}),b.length>1&&e.jsx(it,{className:y.selectLabel,id:q,children:I}),b.length>1&&e.jsx(ct,v({variant:"standard"},!d.variant&&{input:pe||(pe=e.jsx(Ie,{}))},{value:f,onChange:w,id:ye,labelId:q},d,{classes:v({},d.classes,{root:z(y.input,y.selectRoot,(d.classes||{}).root),select:z(y.select,(d.classes||{}).select),icon:z(y.selectIcon,(d.classes||{}).icon)}),children:b.map(C=>S.createElement(_,v({},!Re(_)&&{ownerState:A},{className:y.menuItem,key:C.label?C.label:C,value:C.value?C.value:C}),C.label?C.label:C))})),e.jsx(ht,{className:y.displayedRows,children:u({from:g===0?0:m*f+1,to:Pe(),count:g===-1?-1:g,page:m})}),e.jsx(l,{className:y.actions,backIconButtonProps:o,count:g,nextIconButtonProps:p,onPageChange:j,page:m,rowsPerPage:f,showFirstButton:R,showLastButton:N,getItemAriaLabel:x})]})}))}),mt=gt;function bt(){Ee.locale("fr");const{currentId:t}=k(o=>o.situationFournisseur),s=xe(),{t:h,i18n:r}=D(),l=ke({initialValues:{date1:null,date2:null},validationSchema:De({date1:Q().nullable().test("is-before-date2",h(a.global.date2Greather),function(o){const{date2:i}=this.parent;return o<=i}),date2:Q().nullable().test("is-after-date1",h(a.global.date2Greather),function(o){const{date1:i}=this.parent;return o>=i})}),onSubmit:async(o,{resetForm:i,setErrors:P})=>{const c=new Date(o.date1),g=new Date(o.date2);let x="";x=`?date1=${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}&date2=${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`,console.log(x),W.get("/suppliersituation/detail/list/"+t+"/"+x).then(u=>{s(Y.actions.fetchFournisseurSituationDetails({data:u.data,isFilter:!0}))})},onReset:()=>{W.get("/suppliersituation/detail/list/"+t+"/").then(o=>{s(Y.actions.fetchFournisseurSituationDetails({data:o.data,isFilter:!0}))})}});return e.jsxs(Ke,{defaultExpanded:!0,children:[e.jsx(Ue,{expandIcon:e.jsx(Ge,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(He,{}),h(a.global.filter)]})}),e.jsx(Ve,{children:e.jsx(be,{children:e.jsx(Ne,{children:e.jsx("form",{noValidate:!0,onSubmit:l.handleSubmit,onReset:l.handleReset,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center space-x-6 space-y-2 md:space-y-0",children:[e.jsx(ee,{value:l.values.date1,onChange:o=>l.setFieldValue("date1",o),onBlur:l.handleBlur,label:h(a.global.date1),name:"date1",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(l.touched.date1&&l.errors.date1),helperText:l.touched.date1&&l.errors.date1}}}),e.jsx(ee,{value:l.values.date2,onChange:o=>l.setFieldValue("date2",o),onBlur:l.handleBlur,label:h(a.global.date2),name:"date2",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(l.touched.date2&&l.errors.date2),helperText:l.touched.date2&&l.errors.date2}}}),e.jsx(J,{variant:"contained",type:"reset",children:h(a.global.reset)}),e.jsx(J,{type:"submit",variant:"contained",children:h(a.global.filter)})]})})})})})]})}function jt(){var u,I;const t=JSON.parse(sessionStorage.getItem("user")),[s,h]=S.useState(0),[r,l]=S.useState(10),{situationFournisseurDetails:o}=k(p=>p.situationFournisseur),{t:i,i18n:P}=D(),c=(p,j)=>{h(j)},g=p=>{l(parseInt(p.target.value,10)),h(0)},x=(u=o==null?void 0:o.inbounds)==null?void 0:u.slice(s*r,s*r+r);return e.jsx(e.Fragment,{children:e.jsxs(U,{component:K,children:[e.jsx(L,{children:e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(n,{children:t!=null&&t.is_eleveur?i(a.batiment.title):i(a.fournisseur.title)}),e.jsx(n,{children:i(a.magazin.title)}),e.jsx(n,{children:i(a.sortie.eggType)}),e.jsx(n,{children:i(a.entrer.quantity)}),e.jsxs(n,{children:[i(a.entrer.prix)," ",i(a.global.mad)]}),e.jsx(n,{children:i(a.entrer.date)}),e.jsx(n,{children:i(a.sortie.status)})]}),e.jsx(V,{children:(x==null?void 0:x.length)>0?x==null?void 0:x.map(p=>{let j=new Date(p.date),w={year:j.getFullYear(),month:`${j.getMonth()+1}`,day:`${j.getDate()}`};const m=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(T,{children:[e.jsx(n,{children:p.eggsource}),e.jsx(n,{children:p.warehouse}),e.jsx(n,{children:p.egg_class}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:p.quantity.toLocaleString("en-US").replaceAll(","," ")}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:m.format(p.price).replaceAll(","," ").replace("MAD","")}),e.jsxs(n,{children:[w.day.padStart(2,0),"/",w.month.padStart(2,0),"/",w.year]}),e.jsxs(n,{children:[" ",e.jsx(ge,{label:p.is_delivered?i(a.sortie.oui):i(a.sortie.non),color:p.is_delivered?"success":"error"})]})]},p.id)}):e.jsx(T,{children:e.jsx(n,{colSpan:10,sx:{textAlign:"center"},children:i(a.magazin.nothingToDisplay)})})})]})}),e.jsx(mt,{component:"div",count:(I=o==null?void 0:o.inbounds)==null?void 0:I.length,onPageChange:c,onRowsPerPageChange:g,page:s,rowsPerPage:r,rowsPerPageOptions:[5,10,25],labelRowsPerPage:i(a.magazin.Lignes),labelDisplayedRows:({from:p,to:j,count:w})=>`${p}–${j} ${i(a.magazin.sur)} ${w}`})]})})}function yt(){var f,b;const[t,s]=S.useState({}),[h,r]=S.useState(!1),[l,o]=S.useState(),[i,P]=S.useState(1),[c,g]=S.useState(10),{situationFournisseurDetails:x}=k(d=>d.situationFournisseur),{t:u,i18n:I}=D(),p=[u(a.paiment.espece),u(a.paiment.virment),u(a.paiment.cheque),u(a.paiment.lcn)],j=d=>{s(R=>({...R,[d]:!R[d]}))},w=(d,R)=>{P(R)},m=(f=x==null?void 0:x.payments)==null?void 0:f.slice((i-1)*c,i*c);return e.jsxs(e.Fragment,{children:[e.jsx(U,{component:K,children:e.jsx(L,{children:e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(n,{width:"50"}),e.jsxs(n,{children:[u(a.paiment.amount)," ",u(a.global.mad)]}),e.jsx(n,{children:u(a.entrer.date)}),e.jsx(n,{children:u(a.paiment.typePayment)}),e.jsx(n,{children:u(a.paiment.isPayed)})]}),e.jsx(V,{children:(m==null?void 0:m.length)>0?m==null?void 0:m.map((d,R)=>{const N=t[d.id]||!1;let M=new Date(d.date),A={year:M.getFullYear(),month:`${M.getMonth()+1}`,day:`${M.getDate()}`};const y=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsx(n,{children:d.payment_proof.length!==0&&e.jsx(F,{"aria-label":"expand row",size:"small",onClick:()=>j(d.id),children:N?e.jsx(qe,{}):e.jsx(Oe,{})})}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:y.format(d.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(n,{children:[" ",A.day.padStart(2,0),"/",A.month.padStart(2,0),"/",A.year]}),e.jsx(n,{children:p[d.mode-1]}),e.jsxs(n,{children:[" ",e.jsx(ge,{label:d.payed==1?u(a.sortie.oui):d.payed==2?u(a.global.enCours):u(a.global.echec),color:d.payed==1?"success":d.payed==2?"warning":"error"})]})]}),e.jsx(T,{children:e.jsx(n,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Fe,{in:N,timeout:"auto",unmountOnExit:!0,children:e.jsx(U,{sx:{width:"100%"},component:K,children:e.jsxs(L,{sx:{width:"100%"},children:[e.jsx(H,{children:e.jsxs(T,{children:[e.jsx(n,{children:"Nom du fichier"}),e.jsx(n,{})]})}),e.jsx(V,{children:d.payment_proof.map((_,E)=>e.jsxs(T,{children:[e.jsx(n,{children:_.file.replace("/uploads/","")}),e.jsxs(n,{children:[" ",e.jsx(F,{color:"secondary",onClick:()=>{o({file:_.file,extension:_.extension}),r(!0)},children:e.jsx(Be,{children:e.jsx(Je,{})})})]})]},E))})]})})})})})]})}):e.jsx(T,{children:e.jsx(n,{colSpan:8,sx:{textAlign:"center"},children:u(a.magazin.nothingToDisplay)})})})]})})}),e.jsx(_e,{sx:{display:"flex",justifyContent:"end",p:"5px"},children:e.jsx(ze,{count:Math.ceil(((b=x==null?void 0:x.payments)==null?void 0:b.length)/c),defaultPage:i,onChange:w,color:"primary",size:"large"})}),h&&e.jsx(Qe,{isPreview:h,close:()=>r(!1),file:l})]})}function Pt(){const{t,i18n:s}=D(),{situationFournisseurForOneFournisseur:h}=k(r=>r.situationFournisseur);return console.log(h),e.jsx(U,{component:K,children:e.jsxs(L,{children:[e.jsx(H,{children:e.jsxs(T,{children:[e.jsx(n,{children:t(a.fournisseur.title)}),e.jsxs(n,{children:[t(a.situationFournisseur.totalEntrees)," ",t(a.global.mad)]}),e.jsxs(n,{children:[t(a.situationCliente.totalPaiment)," ",t(a.global.mad)]}),e.jsxs(n,{children:[t(a.situationCliente.paymentProgress)," ",t(a.global.mad)]}),e.jsxs(n,{children:[t(a.situationCliente.paymentEchec)," ",t(a.global.mad)]}),e.jsxs(n,{children:[t(a.situationCliente.debt)," ",t(a.global.mad)]}),e.jsx(n,{})]})}),e.jsx(V,{children:h.map(r=>{const l=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(T,{children:[e.jsx(n,{children:e.jsxs(Le,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(Me,{sx:{bgcolor:"rgb(19, 194, 194)",color:"white",width:45,height:45},children:r.first_name[0]+" "+r.last_name[0]}),e.jsxs("div",{children:[r.first_name+" "+r.last_name,e.jsx(me,{color:"text.secondary",variant:"body2",children:r.email})]})]})}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:l.format(r.sum_inbound_price).replaceAll(","," ")}),e.jsx(n,{style:{fontWeight:"bold"},sx:{direction:"initial",whiteSpace:"nowrap"},children:l.format(r.sum_payment_payed).replaceAll(","," ")}),e.jsx(n,{sx:{color:o=>o.palette.warning.main,fontWeight:"600",direction:"initial",whiteSpace:"nowrap"},children:l.format(r.sum_payment_in_progress).replaceAll(","," ")}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:r.sum_payment_invalid>0?"red":"green"},children:l.format(r.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(n,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:r.solde>=0?"green":"red"},children:l.format(r.solde).replaceAll(","," ").replace("MAD","")})})]})})})]})})}function _t(){const[t,s]=S.useState(0),{modalDetailsOpen:h}=k(i=>i.situationFournisseur),{t:r,i18n:l}=D(),o=xe();return e.jsxs($e,{open:h,fullScreen:!0,children:[e.jsx(We,{sx:{position:"relative"},children:e.jsxs(je,{children:[e.jsx(F,{edge:"start",color:"inherit",onClick:()=>o(Y.actions.openCloseModalDetails()),"aria-label":"close",children:e.jsx(Xe,{})}),e.jsx(me,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:r(a.situationFournisseur.details)})]})}),e.jsxs(G,{children:[e.jsx(Pt,{}),e.jsx(G,{sx:{bgcolor:"background.paper",display:"flex",justifyContent:"center"},children:e.jsxs(Ye,{value:t,onChange:(i,P)=>s(P),children:[e.jsx(ne,{label:r(a.nav.PaimentF)}),e.jsx(ne,{label:r(a.nav.achat)})]})})]}),e.jsx(G,{children:e.jsxs(be,{children:[e.jsx(bt,{}),t===0?e.jsx(yt,{}):e.jsx(jt,{})]})})]})}export{_t as M,mt as T};
