import{a6 as C,a2 as W,d as v,l as t,h as U,b8 as E,j as e,a as V,r as b,a3 as T,bo as G,a1 as I,al as L,V as ee,i as te,a4 as ae,$ as ne,T as H,an as se}from"./index-b9aeea20.js";import{u as re,c as le,e as Y,C as J,b as ie}from"./formik.esm-799b94e8.js";import{g as oe,e as F,T as P,a as D,c as a,d as $,b as j,f as Q,j as ce,B as z}from"./moment-8bb476e3.js";import{A as de,a as he,F as xe,b as pe}from"./fr-3088b82b.js";import{E as ue}from"./ExpandMore-6e3ae782.js";import{D as q}from"./DatePicker-05f47eec.js";import{E as me}from"./Eye-bd865af3.js";import{F as je}from"./FilePreview-05d835a3.js";import{K as ge,a as be,A as fe}from"./KeyboardArrowUp-80820a8c.js";import{C as ye}from"./TableRowsLoader-c4300d5c.js";import{T as we,a as K}from"./Tabs-029752cf.js";function Se(){oe.locale("fr");const{currentId:o}=C(l=>l.situationClient),x=W(),{t:h,i18n:n}=v(),r=re({initialValues:{date1:null,date2:null},validationSchema:le({date1:Y().nullable().test("is-before-date2",h(t.global.date2Greather),function(l){const{date2:s}=this.parent;return l<=s}),date2:Y().nullable().test("is-after-date1",h(t.global.date2Greather),function(l){const{date1:s}=this.parent;return l>=s})}),onSubmit:async(l,{resetForm:s,setErrors:S})=>{const u=new Date(l.date1),f=new Date(l.date2);let p="";p=`?date1=${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}&date2=${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`,U.get("/clientsituation/detail/list/"+o+"/"+p).then(i=>{x(E.actions.fetchClientSituationDetails({data:i.data,isFilter:!0}))})},onReset:()=>{U.get("/clientsituation/detail/list/"+o+"/").then(l=>{x(E.actions.fetchClientSituationDetails({data:l.data,isFilter:!0}))})}});return e.jsxs(de,{defaultExpanded:!0,children:[e.jsx(he,{expandIcon:e.jsx(ue,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(xe,{}),h(t.global.filter)]})}),e.jsx(pe,{children:e.jsx(J,{children:e.jsx(ie,{children:e.jsx("form",{noValidate:!0,onSubmit:r.handleSubmit,onReset:r.handleReset,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center space-x-6 space-y-2 md:space-y-0",children:[e.jsx(q,{value:r.values.date1,onChange:l=>r.setFieldValue("date1",l),onBlur:r.handleBlur,label:h(t.global.date1),name:"date1",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(r.touched.date1&&r.errors.date1),helperText:r.touched.date1&&r.errors.date1}}}),e.jsx(q,{value:r.values.date2,onChange:l=>r.setFieldValue("date2",l),onBlur:r.handleBlur,label:h(t.global.date2),name:"date2",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(r.touched.date2&&r.errors.date2),helperText:r.touched.date2&&r.errors.date2}}}),e.jsx(V,{variant:"contained",type:"reset",children:h(t.global.reset)}),e.jsx(V,{type:"submit",variant:"contained",children:h(t.global.filter)})]})})})})})]})}function Pe(){var M,_;const o=JSON.parse(sessionStorage.getItem("user")),[x,h]=b.useState(0),[n,r]=b.useState(10),{situationCLientDetails:l}=C(d=>d.situationClient),{t:s,i18n:S}=v(),u=[s(t.sortie.vente),s(t.sortie.gratuit),s(t.sortie.accident),s(t.sortie.change)],f=(d,m)=>{h(m)},p=d=>{r(parseInt(d.target.value,10)),h(0)},i=(M=l==null?void 0:l.outbounds)==null?void 0:M.slice(x*n,x*n+n);return e.jsxs(e.Fragment,{children:[e.jsx(F,{component:T,children:e.jsx(P,{children:e.jsxs(P,{children:[e.jsxs(D,{children:[e.jsx(a,{children:o!=null&&o.is_eleveur?s(t.batiment.title):s(t.fournisseur.title)}),e.jsx(a,{children:s(t.magazin.title)}),e.jsx(a,{children:s(t.sortie.eggType)}),e.jsx(a,{children:s(t.entrer.quantity)}),e.jsx(a,{children:s(t.sortie.typeDeSortie)}),e.jsxs(a,{children:[s(t.entrer.prix)," ",s(t.global.mad)]}),e.jsx(a,{children:s(t.entrer.date)}),e.jsx(a,{children:s(t.entrer.temps)}),e.jsx(a,{children:s(t.sortie.status)})]}),e.jsx($,{children:(i==null?void 0:i.length)>0?i==null?void 0:i.map(d=>{let m=new Date(d.date),y={year:m.getFullYear(),month:`${m.getMonth()+1}`,day:`${m.getDate()}`};const g=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(j,{children:[e.jsx(a,{children:d.eggsource_name}),e.jsx(a,{children:d.warehouse_name}),e.jsx(a,{children:d.eggclass_name}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:d.quantity.toLocaleString("en-US").replaceAll(","," ")}),e.jsx(a,{children:u[d.type-1]}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:g.format(d.price).replaceAll(","," ").replace("MAD","")}),e.jsxs(a,{children:[y.day.padStart(2,0),"/",y.month.padStart(2,0),"/",y.year]}),e.jsx(a,{children:d.time.substring(0,5)}),e.jsxs(a,{children:[" ",e.jsx(G,{label:d.is_delivered?s(t.sortie.oui):s(t.sortie.non),color:d.is_delivered?"success":"error"})]})]},d.id)}):e.jsx(j,{children:e.jsx(a,{colSpan:10,sx:{textAlign:"center"},children:s(t.magazin.nothingToDisplay)})})})]})})}),e.jsx(Q,{component:"div",count:(_=l==null?void 0:l.outbounds)==null?void 0:_.length,onPageChange:f,onRowsPerPageChange:p,page:x,rowsPerPage:n,rowsPerPageOptions:[5,10,25],labelRowsPerPage:s(t.magazin.Lignes),labelDisplayedRows:({from:d,to:m,count:y})=>`${d}–${m} ${s(t.magazin.sur)} ${y}`})]})}function Ce(){var N,O;const[o,x]=b.useState({}),[h,n]=b.useState(!1),[r,l]=b.useState(),[s,S]=b.useState(0),[u,f]=b.useState(10),{situationCLientDetails:p}=C(c=>c.situationClient),{t:i,i18n:M}=v(),_=[i(t.paiment.espece),i(t.paiment.virment),i(t.paiment.cheque),i(t.paiment.lcn)],d=c=>{x(w=>({...w,[c]:!w[c]}))},m=(c,w)=>{S(w)},y=c=>{f(parseInt(c.target.value,10)),S(0)},g=(N=p==null?void 0:p.payments)==null?void 0:N.slice(s*u,s*u+u);return e.jsxs(e.Fragment,{children:[e.jsx(F,{component:T,children:e.jsx(P,{children:e.jsxs(P,{children:[e.jsxs(D,{children:[e.jsx(a,{width:"50"}),e.jsxs(a,{children:[i(t.paiment.amount)," ",i(t.global.mad)]}),e.jsx(a,{children:i(t.entrer.date)}),e.jsx(a,{children:i(t.paiment.typePayment)}),e.jsx(a,{children:i(t.paiment.isPayed)})]}),e.jsx($,{children:(g==null?void 0:g.length)>0?g==null?void 0:g.map((c,w)=>{const A=o[c.id]||!1;let R=new Date(c.date),B={year:R.getFullYear(),month:`${R.getMonth()+1}`,day:`${R.getDate()}`};const X=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(a,{children:c.payment_proof.length!==0&&e.jsx(I,{"aria-label":"expand row",size:"small",onClick:()=>d(c.id),children:A?e.jsx(ge,{}):e.jsx(be,{})})}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:X.format(c.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(a,{children:[" ",B.day.padStart(2,0),"/",B.month.padStart(2,0),"/",B.year]}),e.jsx(a,{children:_[c.mode-1]}),e.jsxs(a,{children:[" ",e.jsx(G,{label:c.payed==1?i(t.sortie.oui):c.payed==2?i(t.global.enCours):i(t.global.echec),color:c.payed==1?"success":c.payed==2?"warning":"error"})]})]}),e.jsx(j,{children:e.jsx(a,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(L,{in:A,timeout:"auto",unmountOnExit:!0,children:e.jsx(F,{sx:{width:"100%"},component:T,children:e.jsxs(P,{sx:{width:"100%"},children:[e.jsx(D,{children:e.jsxs(j,{children:[e.jsx(a,{children:"Nom du fichier"}),e.jsx(a,{})]})}),e.jsx($,{children:c.payment_proof.map((k,Z)=>e.jsxs(j,{children:[e.jsx(a,{children:k.file.replace("/uploads/","")}),e.jsxs(a,{children:[" ",e.jsx(I,{color:"secondary",onClick:()=>{l({file:k.file,extension:k.extension}),n(!0)},children:e.jsx(ee,{children:e.jsx(me,{})})})]})]},Z))})]})})})})})]})}):e.jsx(j,{children:e.jsx(a,{colSpan:5,sx:{textAlign:"center"},children:i(t.magazin.nothingToDisplay)})})})]})})}),e.jsx(Q,{component:"div",count:(O=p==null?void 0:p.payments)==null?void 0:O.length,onPageChange:m,onRowsPerPageChange:y,page:s,rowsPerPage:u,rowsPerPageOptions:[5,10,25],labelRowsPerPage:i(t.magazin.Lignes),labelDisplayedRows:({from:c,to:w,count:A})=>`${c}–${w} ${i(t.magazin.sur)} ${A}`}),h&&e.jsx(je,{isPreview:h,close:()=>n(!1),file:r})]})}function ve(){const{t:o,i18n:x}=v(),{situationCLientForOneClient:h}=C(n=>n.situationClient);return console.log(h),e.jsx(F,{component:T,children:e.jsxs(P,{children:[e.jsx(D,{children:e.jsxs(j,{children:[e.jsx(a,{children:o(t.client.title)}),e.jsxs(a,{children:[o(t.situationCliente.totalSortie)," ",o(t.global.mad)]}),e.jsxs(a,{children:[o(t.situationCliente.totalPaiment)," ",o(t.global.mad)]}),e.jsxs(a,{children:[o(t.situationCliente.paymentProgress)," ",o(t.global.mad)]}),e.jsxs(a,{children:[o(t.situationCliente.paymentEchec)," ",o(t.global.mad)]}),e.jsxs(a,{children:[o(t.situationCliente.debt)," ",o(t.global.mad)]})]})}),e.jsx($,{children:h.map(n=>{const r=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(j,{children:[e.jsx(a,{children:e.jsxs(te,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(ae,{variant:"dot",color:n.is_active?"success":"error",anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",badgeContent:" ",sx:{"& .MuiBadge-badge":{minWidth:"14px",height:"14px",fontSize:"0.75rem",borderRadius:"100%",border:"2px solid #fff"}},children:e.jsx(ne,{sx:{bgcolor:n.is_active?"rgb(19, 194, 194)":"",color:"white",width:45,height:45},children:(n==null?void 0:n.client_f_n[0])+" "+(n==null?void 0:n.client_l_n[0])})}),e.jsxs("div",{children:[n.client_f_n+" "+n.client_l_n,e.jsx(H,{color:"text.secondary",variant:"body2",children:n.client_email})]})]})}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:r.format(n.sum_outbound_price).replaceAll(","," ").replace("MAD","")}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},style:{fontWeight:"bold"},children:r.format(n.sum_payment_cashed_in).replaceAll(","," ").replace("MAD","")}),e.jsx(a,{sx:{color:l=>l.palette.warning.main,fontWeight:"600",direction:"initial",whiteSpace:"nowrap",whiteSpace:"nowrap"},children:r.format(n.sum_payment_in_progress).replaceAll(","," ").replace("MAD","")}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:n.sum_payment_invalid>0?"red":"green"},children:r.format(n.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(a,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:n.final_confirmed_sold>=0?"green":"red"},children:r.format(n.final_confirmed_sold).replaceAll(","," ").replace("MAD","")})})]})})})]})})}function Ee(){const[o,x]=b.useState(0),{modalDetailsOpen:h}=C(s=>s.situationClient),{t:n,i18n:r}=v(),l=W();return e.jsxs(se,{open:h,fullScreen:!0,children:[e.jsx(fe,{sx:{position:"relative"},children:e.jsxs(ce,{children:[e.jsx(I,{edge:"start",color:"inherit",onClick:()=>l(E.actions.openCloseModalDetails()),"aria-label":"close",children:e.jsx(ye,{})}),e.jsx(H,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:n(t.situationCliente.details)})]})}),e.jsxs(z,{children:[e.jsx(ve,{}),e.jsx(z,{sx:{bgcolor:"background.paper",display:"flex",justifyContent:"center"},children:e.jsxs(we,{value:o,onChange:(s,S)=>x(S),children:[e.jsx(K,{label:n(t.nav.Paiment)}),e.jsx(K,{label:n(t.nav.sortie)})]})})]}),e.jsx(z,{children:e.jsxs(J,{children:[e.jsx(Se,{}),o===0?e.jsx(Ce,{}):e.jsx(Pe,{})]})})]})}export{Ee as M};
