import{a2 as k,ao as w,a6 as E,d as L,r,j as a,X as M,a7 as _,l as i,a1 as B,a as N,h as T,am as $,an as G,Y as d}from"./index-5221874e.js";import{u as I,C as D}from"./index-3e901cc2.js";import{B as J}from"./moment-95a9c38c.js";import{C as V}from"./TableRowsLoader-ee514eef.js";const X=m=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",boxShadow:24,p:4,[m.breakpoints.down("md")]:{width:"95%"}}),Y=["application/pdf","image/jpg","image/jpeg","image/png"];function Q({isModalUpload:m,close:f,isFournisseur:u}){var j;const x=k(),y=w(),{currentData:o}=E(e=>e.paiment),{t:n,i18n:Z}=L(),[l,c]=r.useState([]),[h,F]=r.useState(4-((j=o==null?void 0:o.payment_proof)==null?void 0:j.length)-l.length),[P,g]=r.useState(!1),{acceptedFiles:q,getRootProps:S,getInputProps:b}=I({onDrop:(e,t)=>{var s;if(t.length>0){if(t[0].errors[0].code=="too-many-files"){d.error(n(i.paiment.uploadLimitFile)+` ${4-((s=o==null?void 0:o.payment_proof)==null?void 0:s.length)}`);return}else if(t[0].errors[0].code=="file-invalid-type"){d.error(n(i.paiment.fileSupported));return}d.error(t[0].errors[0].message)}c(p=>[...p,...e])},multiple:!0,maxFiles:h,validator:z,accept:{"application/pdf":[],"image/jpeg":[],"image/jpg":[],"image/png":[]}}),C=()=>{g(!0);const e=new FormData;e.append("id",o.id),l.map(s=>{e.append("files",s)});const t=u?"/paymentsupplier/proof/add/":"/payment/proof/add/";T.post(t,e).then(s=>{x(u?G.actions.addProofPaimentF(s.data):$.actions.addProofPaiment(s.data)),d.success(n(i.paiment.toastUploadFile)),g(!1),f(),c([])})},v=e=>{const t=l.findIndex(p=>p.path==e),s=l.filter((p,U)=>U!==t);c(s)};function z(e){var s;if(!Y.includes(e.type))return{code:"extension-supported",message:n(i.paiment.fileSupported)};const t=5*1024*1024;return e.size>t?{code:"max-size",message:n(i.paiment.uploadMaxSize)}:h<=0?{code:"max-file",message:`${n(i.paiment.uploadLimitFile)} ${4-((s=o==null?void 0:o.payment_proof)==null?void 0:s.length)}`}:null}return r.useEffect(()=>{var e;l.length>0&&F(4-((e=o==null?void 0:o.payment_proof)==null?void 0:e.length)-l.length)},[l.length]),a.jsxs(a.Fragment,{children:[P&&a.jsx(M,{}),a.jsx(_,{open:m,onClose:f,children:a.jsxs(J,{sx:X(y),children:[a.jsx("h3",{className:"text-center font-semibold text-lg",children:n(i.paiment.uploadTitle)}),a.jsxs("div",{className:"flex flex-col items-center my-4 border-2 border-dashed border-purple-500 p-4",...S(),children:[a.jsx("input",{...b()}),a.jsx(D,{color:"primary",fontSize:"large"}),a.jsx("p",{children:n(i.paiment.uploadTitle)}),a.jsxs("p",{children:[n(i.paiment.uploadMessage)," PNG, JPG, JPEG, PDF"]})]}),a.jsx("div",{children:l.map((e,t)=>a.jsxs("p",{children:[e.path," ",a.jsx(B,{onClick:()=>v(e.path),children:a.jsx(V,{color:"error"})})]},t))}),a.jsx("div",{className:"flex justify-end",children:a.jsx(N,{onClick:C,variant:"contained",color:"primary",children:n(i.paiment.upload)})})]})})]})}export{Q as U};
