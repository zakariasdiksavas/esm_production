import{a6 as v,a2 as K,d as C,l as a,h as U,b8 as I,j as e,a as V,r as b,a3 as T,bm as G,a1 as N,al as Z,V as ee,i as ae,$ as te,T as W,b3 as ne}from"./index-28be1d4d.js";import{u as se,c as re,e as L,C as H,b as le}from"./formik.esm-afb92aee.js";import{g as ie,e as _,T as P,a as $,c as t,d as D,b as m,f as J,j as oe,B as k}from"./moment-3f0f7cd7.js";import{A as ce,a as de,F as he,b as xe}from"./fr-7f09f739.js";import{E as pe}from"./ExpandMore-d20dac84.js";import{D as Y}from"./DatePicker-9ed1f95c.js";import{E as ue}from"./Eye-23aad4cf.js";import{F as ge}from"./FilePreview-3d1f96d6.js";import{K as me,a as je,A as be}from"./KeyboardArrowUp-95289860.js";import{C as ye}from"./TableRowsLoader-dad3b961.js";import{T as we,a as q}from"./Tabs-605999c5.js";function fe(){ie.locale("fr");const{currentId:i}=v(r=>r.situationFournisseur),p=K(),{t:d,i18n:n}=C(),s=se({initialValues:{date1:null,date2:null},validationSchema:re({date1:L().nullable().test("is-before-date2",d(a.global.date2Greather),function(r){const{date2:l}=this.parent;return r<=l}),date2:L().nullable().test("is-after-date1",d(a.global.date2Greather),function(r){const{date1:l}=this.parent;return r>=l})}),onSubmit:async(r,{resetForm:l,setErrors:j})=>{const u=new Date(r.date1),y=new Date(r.date2);let x="";x=`?date1=${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}&date2=${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}-${String(y.getDate()).padStart(2,"0")}`,console.log(x),U.get("/suppliersituation/detail/list/"+i+"/"+x).then(c=>{p(I.actions.fetchFournisseurSituationDetails({data:c.data,isFilter:!0}))})},onReset:()=>{U.get("/suppliersituation/detail/list/"+i+"/").then(r=>{p(I.actions.fetchFournisseurSituationDetails({data:r.data,isFilter:!0}))})}});return e.jsxs(ce,{defaultExpanded:!0,children:[e.jsx(de,{expandIcon:e.jsx(pe,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(he,{}),d(a.global.filter)]})}),e.jsx(xe,{children:e.jsx(H,{children:e.jsx(le,{children:e.jsx("form",{noValidate:!0,onSubmit:s.handleSubmit,onReset:s.handleReset,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center space-x-6 space-y-2 md:space-y-0",children:[e.jsx(Y,{value:s.values.date1,onChange:r=>s.setFieldValue("date1",r),onBlur:s.handleBlur,label:d(a.global.date1),name:"date1",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date1&&s.errors.date1),helperText:s.touched.date1&&s.errors.date1}}}),e.jsx(Y,{value:s.values.date2,onChange:r=>s.setFieldValue("date2",r),onBlur:s.handleBlur,label:d(a.global.date2),name:"date2",className:"w-[100%] md:w-[30%]",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date2&&s.errors.date2),helperText:s.touched.date2&&s.errors.date2}}}),e.jsx(V,{variant:"contained",type:"reset",children:d(a.global.reset)}),e.jsx(V,{type:"submit",variant:"contained",children:d(a.global.filter)})]})})})})})]})}function Se(){var c,F;const i=JSON.parse(sessionStorage.getItem("user")),[p,d]=b.useState(0),[n,s]=b.useState(10),{situationFournisseurDetails:r}=v(h=>h.situationFournisseur),{t:l,i18n:j}=C(),u=(h,g)=>{d(g)},y=h=>{s(parseInt(h.target.value,10)),d(0)},x=(c=r==null?void 0:r.inbounds)==null?void 0:c.slice(p*n,p*n+n);return e.jsx(e.Fragment,{children:e.jsxs(_,{component:T,children:[e.jsx(P,{children:e.jsxs(P,{children:[e.jsxs($,{children:[e.jsx(t,{children:i!=null&&i.is_eleveur?l(a.batiment.title):l(a.fournisseur.title)}),e.jsx(t,{children:l(a.magazin.title)}),e.jsx(t,{children:l(a.sortie.eggType)}),e.jsx(t,{children:l(a.entrer.quantity)}),e.jsxs(t,{children:[l(a.entrer.prix)," ",l(a.global.mad)]}),e.jsx(t,{children:l(a.entrer.date)}),e.jsx(t,{children:l(a.sortie.status)})]}),e.jsx(D,{children:(x==null?void 0:x.length)>0?x==null?void 0:x.map(h=>{let g=new Date(h.date),w={year:g.getFullYear(),month:`${g.getMonth()+1}`,day:`${g.getDate()}`};const R=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(m,{children:[e.jsx(t,{children:h.eggsource}),e.jsx(t,{children:h.warehouse}),e.jsx(t,{children:h.egg_class}),e.jsx(t,{sx:{direction:j.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:h.quantity.toLocaleString("en-US").replaceAll(","," ")}),e.jsx(t,{sx:{direction:j.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:R.format(h.price).replaceAll(","," ").replace("MAD","")}),e.jsxs(t,{children:[w.day.padStart(2,0),"/",w.month.padStart(2,0),"/",w.year]}),e.jsxs(t,{children:[" ",e.jsx(G,{label:h.is_delivered?l(a.sortie.oui):l(a.sortie.non),color:h.is_delivered?"success":"error"})]})]},h.id)}):e.jsx(m,{children:e.jsx(t,{colSpan:10,sx:{textAlign:"center"},children:l(a.magazin.nothingToDisplay)})})})]})}),e.jsx(J,{component:"div",count:(F=r==null?void 0:r.inbounds)==null?void 0:F.length,onPageChange:u,onRowsPerPageChange:y,page:p,rowsPerPage:n,rowsPerPageOptions:[5,10,25],labelRowsPerPage:l(a.magazin.Lignes),labelDisplayedRows:({from:h,to:g,count:w})=>`${h}–${g} ${l(a.magazin.sur)} ${w}`})]})})}function Pe(){var O,z;const[i,p]=b.useState({}),[d,n]=b.useState(!1),[s,r]=b.useState(),[l,j]=b.useState(0),[u,y]=b.useState(10),{situationFournisseurDetails:x}=v(o=>o.situationFournisseur),{t:c,i18n:F}=C(),h=[c(a.paiment.espece),c(a.paiment.virment),c(a.paiment.cheque),c(a.paiment.lcn)],g=o=>{p(f=>({...f,[o]:!f[o]}))},w=(o,f)=>{j(f)},R=o=>{y(parseInt(o.target.value,10)),j(0)},S=(O=x==null?void 0:x.payments)==null?void 0:O.slice(l*u,l*u+u);return e.jsxs(e.Fragment,{children:[e.jsx(_,{component:T,children:e.jsx(P,{children:e.jsxs(P,{children:[e.jsxs($,{children:[e.jsx(t,{width:"50"}),e.jsxs(t,{children:[c(a.paiment.amount)," ",c(a.global.mad)]}),e.jsx(t,{children:c(a.entrer.date)}),e.jsx(t,{children:c(a.paiment.typePayment)}),e.jsx(t,{children:c(a.paiment.isPayed)})]}),e.jsx(D,{children:(S==null?void 0:S.length)>0?S==null?void 0:S.map((o,f)=>{const A=i[o.id]||!1;let M=new Date(o.date),E={year:M.getFullYear(),month:`${M.getMonth()+1}`,day:`${M.getDate()}`};const Q=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(t,{children:o.payment_proof.length!==0&&e.jsx(N,{"aria-label":"expand row",size:"small",onClick:()=>g(o.id),children:A?e.jsx(me,{}):e.jsx(je,{})})}),e.jsx(t,{sx:{direction:F.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:Q.format(o.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(t,{children:[" ",E.day.padStart(2,0),"/",E.month.padStart(2,0),"/",E.year]}),e.jsx(t,{children:h[o.mode-1]}),e.jsxs(t,{children:[" ",e.jsx(G,{label:o.payed==1?c(a.sortie.oui):o.payed==2?c(a.global.enCours):c(a.global.echec),color:o.payed==1?"success":o.payed==2?"warning":"error"})]})]}),e.jsx(m,{children:e.jsx(t,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Z,{in:A,timeout:"auto",unmountOnExit:!0,children:e.jsx(_,{sx:{width:"100%"},component:T,children:e.jsxs(P,{sx:{width:"100%"},children:[e.jsx($,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Nom du fichier"}),e.jsx(t,{})]})}),e.jsx(D,{children:o.payment_proof.map((B,X)=>e.jsxs(m,{children:[e.jsx(t,{children:B.file.replace("/uploads/","")}),e.jsxs(t,{children:[" ",e.jsx(N,{color:"secondary",onClick:()=>{r({file:B.file,extension:B.extension}),n(!0)},children:e.jsx(ee,{children:e.jsx(ue,{})})})]})]},X))})]})})})})})]})}):e.jsx(m,{children:e.jsx(t,{colSpan:5,sx:{textAlign:"center"},children:c(a.magazin.nothingToDisplay)})})})]})})}),e.jsx(J,{component:"div",count:(z=x==null?void 0:x.payments)==null?void 0:z.length,onPageChange:w,onRowsPerPageChange:R,page:l,rowsPerPage:u,rowsPerPageOptions:[5,10,25],labelRowsPerPage:c(a.magazin.Lignes),labelDisplayedRows:({from:o,to:f,count:A})=>`${o}–${f} ${c(a.magazin.sur)} ${A}`}),d&&e.jsx(ge,{isPreview:d,close:()=>n(!1),file:s})]})}function ve(){const{t:i,i18n:p}=C(),{situationFournisseurForOneFournisseur:d}=v(n=>n.situationFournisseur);return console.log(d),e.jsx(_,{component:T,children:e.jsxs(P,{children:[e.jsx($,{children:e.jsxs(m,{children:[e.jsx(t,{children:i(a.fournisseur.title)}),e.jsxs(t,{children:[i(a.situationFournisseur.totalEntrees)," ",i(a.global.mad)]}),e.jsxs(t,{children:[i(a.situationCliente.totalPaiment)," ",i(a.global.mad)]}),e.jsxs(t,{children:[i(a.situationCliente.paymentProgress)," ",i(a.global.mad)]}),e.jsxs(t,{children:[i(a.situationCliente.paymentEchec)," ",i(a.global.mad)]}),e.jsxs(t,{children:[i(a.situationCliente.debt)," ",i(a.global.mad)]}),e.jsx(t,{})]})}),e.jsx(D,{children:d.map(n=>{const s=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(m,{children:[e.jsx(t,{children:e.jsxs(ae,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(te,{sx:{bgcolor:"rgb(19, 194, 194)",color:"white",width:45,height:45},children:n.first_name[0]+" "+n.last_name[0]}),e.jsxs("div",{children:[n.first_name+" "+n.last_name,e.jsx(W,{color:"text.secondary",variant:"body2",children:n.email})]})]})}),e.jsx(t,{sx:{direction:p.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:s.format(n.sum_inbound_price).replaceAll(","," ")}),e.jsx(t,{style:{fontWeight:"bold"},sx:{direction:p.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:s.format(n.sum_payment_payed).replaceAll(","," ")}),e.jsx(t,{sx:{color:r=>r.palette.warning.main,fontWeight:"600",direction:p.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap",whiteSpace:"nowrap"},children:s.format(n.sum_payment_in_progress).replaceAll(","," ")}),e.jsx(t,{sx:{direction:p.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:n.sum_payment_invalid>0?"red":"green"},children:s.format(n.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(t,{sx:{direction:p.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:n.solde>=0?"green":"red"},children:s.format(n.solde).replaceAll(","," ").replace("MAD","")})})]})})})]})})}function ke(){const[i,p]=b.useState(0),{modalDetailsOpen:d}=v(l=>l.situationFournisseur),{t:n,i18n:s}=C(),r=K();return e.jsxs(ne,{open:d,fullScreen:!0,children:[e.jsx(be,{sx:{position:"relative"},children:e.jsxs(oe,{children:[e.jsx(N,{edge:"start",color:"inherit",onClick:()=>r(I.actions.openCloseModalDetails()),"aria-label":"close",children:e.jsx(ye,{})}),e.jsx(W,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:n(a.situationFournisseur.details)})]})}),e.jsxs(k,{children:[e.jsx(ve,{}),e.jsx(k,{sx:{bgcolor:"background.paper",display:"flex",justifyContent:"center"},children:e.jsxs(we,{value:i,onChange:(l,j)=>p(j),children:[e.jsx(q,{label:n(a.nav.PaimentF)}),e.jsx(q,{label:n(a.nav.achat)})]})})]}),e.jsx(k,{children:e.jsxs(H,{children:[e.jsx(fe,{}),i===0?e.jsx(Pe,{}):e.jsx(Se,{})]})})]})}export{ke as M};
