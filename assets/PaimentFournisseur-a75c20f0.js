import{aa as T,r as D,d as F,l as s,j as e,a9 as O,a as G,a2 as L,ar as Ee,am as A,as as ke,ab as Ae,aw as o,h as w,aj as V,ak as Y,al as $,ae as k,i as ee,T as te,af as J,F as se,k as ie,a5 as R,B as Le,$ as We,u as Be,au as Ne,av as He}from"./index-5b79c039.js";import{e as ge,T as ve,a as De,b as I,c as p,d as je,f as ne,G as H,u as be,h as fe,B as le,S as ye,E as Ve}from"./moment-864131f4.js";import{E as Ye,P as $e,M as Se}from"./ModalDelete-04bd8acd.js";import{T as qe,C as de}from"./TableRowsLoader-23cb4167.js";import{E as Ke}from"./Eye-655a27ed.js";import{C as ze,T as Xe}from"./index-be556e9b.js";import{F as Je}from"./FilePreview-1d12d7cb.js";import{I as Qe,m as we,U as Ze,a as es,C as ss,D as ts}from"./UploadFileModel-b18e9ca9.js";import{A as ns}from"./AlertError-96b329d4.js";import{K as as,a as os}from"./KeyboardArrowUp-c6409d2a.js";import{D as rs}from"./DeleteOutlineOutlined-32598299.js";import{u as ce,c as me,e as Me,C as Fe,b as is,d as W}from"./formik.esm-f8b1f355.js";import"./fr-4efeb1d7.js";import{D as X}from"./DatePicker-9add668e.js";import{M as Pe}from"./ModalConfirm-575c2085.js";import{D as ls}from"./Delete-951034da.js";import{E as ds}from"./Edit-65022ded.js";import{C as cs}from"./Check-81145735.js";const ms=l=>{let{count:m=0,items:a=[],onDeselectAll:n,onDeselectOne:d,onSelectAll:c,onSelectOne:x,selected:f=[],isLoading:v,isError:r}=l;const t=T(),[j,C]=D.useState(1),[i,y]=D.useState(!1),[U,P]=D.useState(25),{t:g,i18n:_e}=F(),[ue,pe]=D.useState({}),[ae,q]=D.useState(!1),[he,xe]=D.useState(),[h,b]=D.useState(),_=D.useRef(null),K=[{mode:1,text:g(s.global.oui)},{mode:2,text:g(s.global.enCours)},{mode:3,text:g(s.global.echec)}],Q=[g(s.paiment.espece),g(s.paiment.virment),g(s.paiment.cheque),g(s.paiment.lcn)],[M,B]=D.useState(null),oe=!!M,Ue=(u,S)=>{b(S),B(u.currentTarget)},Re=()=>{B(null)},Te=u=>{pe(S=>({...S,[u]:!S[u]}))},re=(u,S)=>{const N=a.filter(Z=>Z.id==u);t(o.actions.setCurrentData(N[0])),S=="update"?t(o.actions.openCloseModalUpdate()):S=="delete"?t(o.actions.openCloseModalDelete()):S=="paimentHistory"?t(o.actions.openCloseModalHistory()):y(!0)},Oe=()=>{const u=_.current;u&&u.scrollHeight===u.scrollTop+u.clientHeight&&!v&&C(N=>N+1)};D.useEffect(()=>(_.current&&_.current.addEventListener("scroll",Oe),()=>{_.current&&_.current.removeEventListener("scroll",Oe)}),[v]);const z=a==null?void 0:a.slice(0,j*U),Ie=u=>{w.put("/paymentsupplier/payed/",{id:h,mode:u}).then(S=>{t(o.actions.handlePayed({id:h,data:S.data})),B(null)})};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{children:e.jsxs(ve,{children:[e.jsx(De,{children:e.jsxs(I,{children:[e.jsx(p,{}),e.jsx(p,{children:g(s.nav.fournisseur)}),e.jsxs(p,{children:[g(s.paiment.amount)," ",g(s.global.mad)]}),e.jsx(p,{children:g(s.entrer.date)}),e.jsx(p,{children:g(s.paiment.typePayment)}),e.jsx(p,{children:g(s.paiment.isPayed)}),e.jsx(p,{})]})}),v?e.jsx(qe,{rowsNum:10}):e.jsx(je,{children:(z==null?void 0:z.length)>0?z==null?void 0:z.map(u=>{const S=ue[u.id]||!1;let N=new Date(u.date),Z={year:N.getFullYear(),month:`${N.getMonth()+1}`,day:`${N.getDate()}`};const Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[e.jsx(p,{children:u.payment_proof.length!==0&&e.jsx(O,{"aria-label":"expand row",size:"small",onClick:()=>Te(u.id),children:S?e.jsx(as,{}):e.jsx(os,{})})}),e.jsxs(p,{children:[u.name," ",u.last_name]}),e.jsx(p,{sx:{direction:"initial",whiteSpace:"nowrap"},children:Ge.format(u.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(p,{children:[" ",Z.day.padStart(2,0),"/",Z.month.padStart(2,0),"/",Z.year]}),e.jsx(p,{children:Q[u.mode-1]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":oe?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":oe?"true":void 0,onClick:E=>Ue(E,u.id),color:u.payed==1?"success":u.payed==2?"warning":"error",sx:{"&:disabled":{color:E=>E.palette.success.dark}},disabled:u.mode==1||u.mode==2,children:K[u.payed-1].text}),(u.payed==3||u.history)&&e.jsx(O,{color:"success",onClick:()=>re(u.id,"paimentHistory"),children:e.jsx(L,{children:e.jsx(Qe,{path:we,size:1})})}),e.jsx(Ee,{id:"basic-menu",anchorEl:M,open:oe,onClose:Re,MenuListProps:{"aria-labelledby":"basic-button"},children:K.map((E,Ce)=>e.jsx(A,{onClick:_s=>Ie(E.mode),children:E.text},Ce))})]})}),e.jsxs(p,{children:[e.jsx(O,{color:"warning",onClick:()=>re(u.id,"update"),children:e.jsx(L,{children:e.jsx(Ye,{})})}),e.jsx(O,{color:"error",onClick:()=>re(u.id,"delete"),children:e.jsx(L,{children:e.jsx(rs,{})})}),u.payment_proof.length!==4&&e.jsx(O,{color:"success",onClick:()=>re(u.id,"upload"),children:e.jsx(L,{children:e.jsx(ze,{})})})]})]}),e.jsx(I,{children:e.jsx(p,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(ke,{in:S,timeout:"auto",unmountOnExit:!0,children:e.jsx(ge,{sx:{width:"100%"},component:Ae,children:e.jsxs(ve,{sx:{width:"100%"},children:[e.jsx(De,{children:e.jsxs(I,{children:[e.jsx(p,{children:g(s.paiment.fileName)}),e.jsx(p,{})]})}),e.jsx(je,{children:u.payment_proof.map((E,Ce)=>e.jsxs(I,{children:[e.jsx(p,{children:E.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(p,{children:[" ",e.jsx(O,{color:"inherit",onClick:()=>{t(o.actions.openCloseConfirmDeleteProof()),t(o.actions.setCurrentData({id:u.id,idFile:E.id}))},children:e.jsx(L,{children:e.jsx(Xe,{})})}),e.jsx(O,{color:"secondary",onClick:()=>{xe({file:E.file,extension:E.extension}),q(!0)},children:e.jsx(L,{children:e.jsx(Ke,{})})})]})]},Ce))})]})})})})})]})}):e.jsx(I,{children:e.jsx(p,{colSpan:8,sx:{textAlign:"center"},children:g(s.batiment.nothingToDisplay)})})})]})}),r&&e.jsx(ns,{}),i&&e.jsx(Ze,{isFournisseur:!0,isModalUpload:i,close:()=>y(!1)}),ae&&e.jsx(Je,{isPreview:ae,close:()=>q(!1),file:he})]})};function us({fournisseur:l}){ne.locale("fr");const{t:m,i18n:a}=F(),n=T(),d=ce({initialValues:{date1:null,date2:null,eggsource:""},validationSchema:me({date1:Me().nullable().test("is-before-date2",m(s.global.date2Greather),function(c){const{date2:x}=this.parent;return c<=x}),date2:Me().nullable().test("is-after-date1",m(s.global.date2Greather),function(c){const{date1:x}=this.parent;return c>=x})}),onSubmit:async(c,{resetForm:x,setErrors:f})=>{let v="";for(let r in c)if(c[r]!==""&&c[r]!==null){let t=new Date(c[r]),j=t.getFullYear()!==1970?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:c[r];v==""?v+=`?${r}=${j}`:v+=`&${r}=${j}`}w.get("/paymentsupplier/list/"+v).then(r=>{n(o.actions.fetchPaimentF(r.data))})},onReset:()=>{w.get("/paymentsupplier/list/").then(c=>{n(o.actions.fetchPaimentF(c.data))})}});return e.jsx(Fe,{children:e.jsx(is,{children:e.jsx("form",{noValidate:!0,onSubmit:d.handleSubmit,onReset:d.handleReset,children:e.jsxs(H,{container:!0,alignItems:"center",gap:2,children:[e.jsx(H,{item:!0,xs:12,md:5,sm:12,children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(Y,{id:"batiment-id",size:"small",children:m(s.fournisseur.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:d.handleBlur,fullWidth:!0,name:"eggsource",size:"small",onChange:d.handleChange,value:d.values.eggsource,label:m(s.fournisseur.title),children:l==null?void 0:l.map(c=>e.jsx(A,{value:c.id,children:c.name}))})]})}),e.jsx(H,{item:!0,xs:12,md:2,sm:12,children:e.jsx(X,{value:d.values.date1,onChange:c=>d.setFieldValue("date1",c),onBlur:d.handleBlur,label:m(s.global.date1),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",size:"small",error:!!(d.touched.date1&&d.errors.date1),helperText:d.touched.date1&&d.errors.date1}}})}),e.jsx(H,{item:!0,xs:12,md:2,sm:12,children:e.jsx(X,{value:d.values.date2,onChange:c=>d.setFieldValue("date2",c),onBlur:d.handleBlur,label:m(s.global.date2),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",size:"small",error:!!(d.touched.date2&&d.errors.date2),helperText:d.touched.date2&&d.errors.date2}}})}),e.jsxs(H,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(H,{items:!0,children:e.jsx(G,{variant:"contained",type:"reset",children:m(s.global.reset)})}),e.jsx(H,{items:!0,children:e.jsx(G,{type:"submit",variant:"contained",children:m(s.global.filter)})})]})]})})})})}function ps({fournisseur:l}){const{t:m,i18n:a}=F(),n=T(),d=be("paimentsF",fe.fetchPaimentFournisseur),{paimentF:c}=k(x=>x.paimentFournisseur);return D.useEffect(()=>{d.status=="success"&&n(o.actions.fetchPaimentF(d.data))},[d.status]),e.jsxs(ee,{spacing:4,children:[e.jsxs(ee,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(ee,{spacing:1,children:e.jsx(te,{variant:"h4",children:m(s.paimentF.title)})}),e.jsx(ee,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(G,{startIcon:e.jsx(L,{children:e.jsx($e,{})}),variant:"contained",onClick:()=>n(o.actions.openCloseModalAdd()),children:m(s.global.ajouter)})})]}),e.jsxs(Fe,{children:[e.jsx(us,{fournisseur:l}),e.jsx(ms,{items:c,count:c.length,rowsPerPage:25,isLoading:d.isLoading,isError:d.isError})]})]})}const hs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function xs({fournisseur:l,paimentModes:m}){const a=T(),{t:n,i18n:d}=F(),{isModalAdd:c,isConfirm:x}=k(C=>C.paimentFournisseur),f=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],v=me({eggsource:W().required(n(s.sortie.fournisseurRequired)),amount:W().required(n(s.paiment.amountRequired)),mode:W().required(n(s.paiment.typePaymentRequired))}),r=ce({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:v,onSubmit:async(C,{resetForm:i,setErrors:y})=>{const U={...C};U.date=ne(C.date).format("YYYY-MM-DD"),w.post("/paymentsupplier/add/",U).then(P=>{a(o.actions.addPaimentF(P.data)),a(o.actions.openCloseModalAdd()),a(o.actions.openCloseConfirm()),R.success(n(s.paiment.toastAddSuccess)),i()}).catch(P=>{a(o.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),t=async C=>{C.preventDefault();const i=await r.validateForm();Object.keys(i).length===0?a(o.actions.openCloseConfirm()):await r.submitForm()},j=()=>{r.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(J,{open:c,onClose:()=>a(o.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:hs,children:[e.jsxs(ye,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalAdd()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:C=>t(C),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.eggsource&&r.errors.eggsource),children:[e.jsx(Y,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"eggsource",onChange:r.handleChange,value:r.values.eggsource,label:n(s.fournisseur.title),children:l.length>0?l.map(C=>e.jsxs(A,{value:C.id,children:[C.name," ",C.last_name]})):e.jsx(A,{children:n(s.batiment.nothingToDisplay)})}),r.touched.eggsource&&r.errors.eggsource&&e.jsx(se,{children:r.errors.eggsource})]}),e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.mode&&r.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"mode",onChange:r.handleChange,value:r.values.mode,label:n(s.paiment.typePayment),children:m.map(C=>e.jsx(A,{value:C.id,children:f[C.id-1]}))}),r.touched.mode&&r.errors.mode&&e.jsx(se,{children:r.errors.mode})]}),e.jsx(ie,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:r.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:r.handleChange,value:r.values.amount,error:!!(r.touched.amount&&r.errors.amount),helperText:r.touched.amount&&r.errors.amount,style:{marginBottom:"15px"}}),e.jsx(X,{label:n(s.entrer.date),value:r.values.date,onChange:C=>r.setFieldValue("date",C),onBlur:r.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(Pe,{confirmed:j,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:x})]})}const Cs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function gs({fournisseur:l,paimentModes:m}){const a=T(),{t:n,i18n:d}=F(),{currentData:c,isModalUpdate:x,isConfirm:f}=k(i=>i.paimentFournisseur),v=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],r=me({eggsource:W().required(n(s.sortie.fournisseurRequired)),amount:W().required(n(s.paiment.amountRequired)),mode:W().required(n(s.paiment.typePaymentRequired))}),t=ce({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:r,onSubmit:async(i,{resetForm:y,setErrors:U})=>{const P={...i};P.date=ne(i.date).format("YYYY-MM-DD"),w.put("/paymentsupplier/update/",P).then(g=>{a(o.actions.editPaimentF(g.data)),a(o.actions.openCloseModalUpdate()),a(o.actions.openCloseConfirm()),R.success(n(s.paiment.toastUpdateSuccess)),y()}).catch(g=>{a(o.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),j=async i=>{i.preventDefault();const y=await t.validateForm();Object.keys(y).length===0?a(o.actions.openCloseConfirm()):await t.submitForm()},C=()=>{t.handleSubmit()};return D.useEffect(()=>{let i={...c};i.date=new Date(i.date),t.setValues(i)},[]),e.jsxs(e.Fragment,{children:[e.jsx(J,{open:x,onClose:()=>a(o.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:Cs,children:[e.jsxs(ye,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.update)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalUpdate()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>j(i),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.eggsource&&t.errors.eggsource),children:[e.jsx(Y,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"eggsource",onChange:t.handleChange,value:t.values.eggsource,label:n(s.fournisseur.title),children:l.length>0?l.map(i=>e.jsxs(A,{value:i.id,children:[i.name," ",i.last_name]})):e.jsx(A,{children:n(s.batiment.nothingToDisplay)})}),t.touched.eggsource&&t.errors.eggsource&&e.jsx(se,{children:t.errors.eggsource})]}),e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:m.map(i=>e.jsx(A,{value:i.id,children:v[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(se,{children:t.errors.mode})]}),e.jsx(ie,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(X,{label:n(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(Pe,{confirmed:C,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:f})]})}function vs(){const{currentData:l,isModalDelete:m}=k(x=>x.paimentFournisseur),a=T(),{t:n,i18n:d}=F(),c=()=>{w.delete(`/paymentsupplier/delete/${l.id}`).then(x=>{a(o.actions.deletePaimentF()),a(o.actions.openCloseModalDelete()),R.success(n(s.paiment.toastDeleteSuccess))}).catch(x=>{a(o.actions.openCloseModalDelete()),R.error(n(s.global.toastError))})};return e.jsx(J,{open:m,onClose:()=>a(o.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Se,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:c,cancel:()=>a(o.actions.openCloseModalDelete())})})}function Ds(){const{currentData:l,isModalDeleteProof:m}=k(x=>x.paimentFournisseur),a=T(),{t:n,i18n:d}=F(),c=()=>{w.delete(`/paymentsupplier/proof/delete/${l.idFile}`).then(x=>{a(o.actions.deletePaimentFProof()),a(o.actions.openCloseConfirmDeleteProof()),R.success(n(s.global.toastSuccessDeleteFile))}).catch(x=>{a(o.actions.openCloseConfirmDeleteProof()),R.error(n(s.global.toastError))})};return e.jsx(J,{open:m,onClose:()=>a(o.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Se,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:c,cancel:()=>a(o.actions.openCloseConfirmDeleteProof())})})}function js({isOpen:l,close:m,handleDelete:a}){const{t:n,i18n:d}=F();return e.jsx(J,{open:l,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Se,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:a,cancel:m})})}function bs(){const{t:l,i18n:m}=F(),{currentData:a}=k(h=>h.paimentFournisseur),[n,d]=D.useState(),c=T(),[x,f]=D.useState(!1),[v,r]=D.useState(!1),[t,j]=D.useState(),C=[{mode:1,text:l(s.global.oui)},{mode:2,text:l(s.global.enCours)},{mode:3,text:l(s.global.echec)}],i=[l(s.paiment.espece),l(s.paiment.virment),l(s.paiment.cheque),l(s.paiment.lcn)],[y,U]=D.useState(null),P=!!y,g=(h,b)=>{d(b),U(h.currentTarget)},_e=()=>{U(null)},ue=h=>{w.put("/payment/payedcorrection/",{id:n,mode:h}).then(b=>{c(o.actions.handlePayedCorrection({id:n,data:b.data})),U(null)})},pe=(h,b)=>{j(b),f(!0),d(h)},ae=h=>{r(!0),d(h)},q=h=>{const b=h.target.name;j(b?_=>({..._,date:new Date(_.date),[b]:Number(h.target.value)}):_=>({..._,date:new Date(_.date)}))},he=()=>{let h={...t,date:ne(t.date).format("YYYY-MM-DD")};w.put("/paymentsupplier/updatecorrection/",h).then(b=>{c(o.actions.handlePayedCorrection({id:n,data:b.data})),f(!1)})},xe=()=>{w.delete(`/paymentsupplier/deletecorrection/${n}`).then(h=>{c(o.actions.deletePaimentHistory()),r(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{sx:{position:"relative"},children:e.jsx(ge,{component:Ae,children:e.jsxs(ve,{sx:{minWidth:700},children:[e.jsx(De,{children:e.jsxs(I,{children:[e.jsxs(p,{children:[l(s.paiment.amount)," ",l(s.global.mad)]}),e.jsx(p,{children:l(s.entrer.date)}),e.jsx(p,{children:l(s.paiment.typePayment)}),e.jsx(p,{children:l(s.paiment.isPayed)}),e.jsx(p,{})]})}),e.jsx(je,{children:a.payment_correction.map((h,b)=>{const _=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});let K=new Date(h.date),Q={year:K.getFullYear(),month:`${K.getMonth()+1}`,day:`${K.getDate()}`};return!x||a.payment_correction.length-1!==b?e.jsxs(I,{children:[e.jsxs(p,{sx:{direction:"initial"},children:[" ",_.format(h.amount).replaceAll(","," ").replace("MAD","")]}),e.jsxs(p,{children:[" ",Q.day.padStart(2,0),"/",Q.month.padStart(2,0),"/",Q.year]}),e.jsx(p,{children:i[h.mode-1]}),e.jsxs(p,{children:[" ",e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":P?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":P?"true":void 0,onClick:M=>g(M,h.id),color:h.payed==1?"success":h.payed==2?"warning":"error",sx:{"&:disabled":{color:M=>M.palette.success.dark}},disabled:h.mode==1||h.mode==2?!0:b==0,children:C[Number(h.payed)-1].text}),h.payed==3&&e.jsx(O,{color:"success",onClick:()=>openModal(h.id,"paimentHistory"),children:e.jsx(L,{children:e.jsx(es,{path:we,size:1})})}),e.jsx(Ee,{id:"basic-menu",anchorEl:y,open:P,onClose:_e,MenuListProps:{"aria-labelledby":"basic-button"},children:C.map((M,B)=>e.jsx(A,{onClick:oe=>ue(M.mode),children:M.text},B))})]})]}),a.payment_correction.length-1==b&&b!==0&&e.jsxs(p,{children:[e.jsx(O,{color:"error",onClick:()=>ae(h.id),children:e.jsx(ls,{})}),e.jsx(O,{color:"warning",onClick:()=>pe(h.id,h),children:e.jsx(ds,{})})]})]}):e.jsxs(I,{children:[e.jsx(p,{sx:{direction:"initial"},children:e.jsx(ie,{value:t.amount,fullWidth:!0,label:l(s.paiment.amount),type:"number",name:"amount",onChange:q})}),e.jsxs(p,{children:[" ",e.jsx(X,{value:new Date(t.date),name:"date",onChange:q,label:l(s.entrer.date)})]}),e.jsx(p,{children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(Y,{id:"demo-simple-select-label",children:l(s.paiment.typePayment)}),e.jsx($,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:t.mode,label:l(s.paiment.typePayment),onChange:q,name:"mode",children:i.map((M,B)=>e.jsx(A,{value:B+1,children:M}))})]})}),e.jsxs(p,{children:[e.jsx(O,{color:"success",onClick:he,children:e.jsx(cs,{})}),e.jsx(O,{color:"error",onClick:()=>f(!1),children:e.jsx(ss,{})})]})]})})})]})})}),e.jsx(js,{isOpen:v,close:()=>r(!1),handleDelete:xe})]})}function fs(){const l=T(),m=We(),{t:a}=F(),{currentData:n,isModalHistory:d}=k(v=>v.paimentFournisseur),c=Be(m.breakpoints.down("md")),[x,f]=D.useState(!0);return D.useEffect(()=>{let v=n.payment_correction[0].amount;n.payment_correction.slice(1,n.payment_correction.length).reduce((t,j)=>j.payed==1?t+j.amount:t,0)>=v&&f(!1)},[n]),e.jsxs(Ne,{onClose:()=>l(o.actions.openCloseModalHistory()),fullScreen:c,open:d,maxWidth:"lg",children:[e.jsxs(ts,{sx:{m:0,p:2.5},id:"customized-dialog-title",children:[a(s.paiment.titleHistory)," ",n.name," ",n.last_name]}),e.jsx(O,{"aria-label":"close",onClick:()=>l(o.actions.openCloseModalHistory()),sx:v=>({position:"absolute",right:8,top:8,color:v.palette.grey[500]}),children:e.jsx(de,{})}),e.jsxs(He,{children:[e.jsxs(ee,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:1.5,children:[e.jsx(te,{variant:"h6"}),x&&e.jsx(G,{variant:"contained",onClick:()=>l(o.actions.openCloseModalAddHistory()),children:a(s.global.ajouter)})]}),e.jsx(bs,{})]})]})}const ys={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ss({paimentModes:l}){const m=T(),{t:a,i18n:n}=F(),d=[a(s.paiment.espece),a(s.paiment.virment),a(s.paiment.cheque),a(s.paiment.lcn)],{paiment:c,isModalAddHistory:x,currentData:f,isConfirm:v}=k(i=>i.paimentFournisseur),r=me({amount:W().required(a(s.paiment.amountRequired)),mode:W().required(a(s.paiment.typePaymentRequired))}),t=ce({initialValues:{amount:"",mode:"",date:new Date,payment:f.id},validationSchema:r,onSubmit:async(i,{resetForm:y,setErrors:U})=>{const P={...i};P.date=ne(i.date).format("YYYY-MM-DD"),w.post("/paymentsupplier/addcorrection/",P).then(g=>{m(o.actions.addPaimentFHistory(g.data)),m(o.actions.openCloseModalAddHistory()),m(o.actions.openCloseConfirm()),R.success(a(s.paiment.toastAddSuccess)),y()}).catch(g=>{m(o.actions.openCloseConfirm()),R.error(a(s.global.toastError))})}}),j=async i=>{i.preventDefault();const y=await t.validateForm();Object.keys(y).length===0?m(o.actions.openCloseConfirm()):await t.submitForm()},C=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(J,{open:x,onClose:()=>m(o.actions.openCloseModalAddHistory()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:ys,children:[e.jsxs(ye,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>m(o.actions.openCloseModalAddHistory()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>j(i),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:a(s.paiment.typePayment),children:l.map(i=>e.jsx(A,{value:i.id,children:d[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(se,{children:t.errors.mode})]}),e.jsx(ie,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(X,{label:a(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(Pe,{confirmed:C,cancel:()=>m(o.actions.openCloseConfirm()),isConfirm:v})]})}function Ps(){const{isModalAdd:l,isModalUpdate:m,isModalDelete:a,isModalHistory:n,isModalAddHistory:d}=k(f=>f.paimentFournisseur),c=be("paymentMethod",fe.paymentMode),x=be("fournisseur",fe.getBatimentSelect);return e.jsxs(e.Fragment,{children:[" ",e.jsx(le,{component:"main",sx:{flexGrow:1,p:3},children:e.jsx(ps,{fournisseur:x.data})}),l&&e.jsx(xs,{fournisseur:x.data,paimentModes:c.data}),m&&e.jsx(gs,{fournisseur:x.data,paimentModes:c.data}),d&&e.jsx(Ss,{paimentModes:c.data}),a&&e.jsx(vs,{}),e.jsx(Ds,{}),n&&e.jsx(fs,{})]})}function Ys(){return e.jsx(e.Fragment,{children:e.jsx(Ve,{children:e.jsx(Ps,{})})})}export{Ys as default};
