import{a2 as R,r as v,d as F,l as s,j as e,a1 as _,a as G,V as L,ak as Me,ae as A,al as ke,a3 as Ee,ap as o,B as Ae,h as w,ab as H,ac as V,ad as Y,a6 as k,C as Le,i as Z,T as se,a7 as z,F as ee,k as oe,Y as T,O as We,u as Be,an as Ne,ao as He}from"./index-6dfaf798.js";import{e as xe,T as Ce,a as ge,b as I,c as u,d as je,P as Ve,f as te,G as N,u as De,h as ve,B as re,S as fe,E as Ye}from"./moment-b22360b6.js";import{E as $e,P as qe,M as be}from"./ModalDelete-26a071ca.js";import{T as Ke,C as ie}from"./TableRowsLoader-e8443f2b.js";import{E as ze}from"./Eye-ddc0c46b.js";import{T as Xe}from"./index-913cdcd8.js";import{F as Je}from"./FilePreview-8e9663e6.js";import{I as Qe,m as we,U as Ze,a as es,C as ss,D as ts}from"./UploadFileModel-d3c7f3e5.js";import{A as ns}from"./AlertError-202fc79f.js";import{K as as,a as os}from"./KeyboardArrowUp-fbf656ad.js";import{D as rs}from"./DeleteOutlineOutlined-c33c7e3c.js";import{A as is}from"./Add-5aa9af27.js";import{u as le,c as de,e as Oe,C as Fe,b as ls,d as W}from"./formik.esm-45b81460.js";import{A as ds,a as cs,F as ms,b as us}from"./fr-dfeccf7c.js";import{E as ps}from"./ExpandMore-9a47559a.js";import{D as K}from"./DatePicker-c3bd6d5c.js";import{M as ye}from"./ModalConfirm-0866ad57.js";import{D as hs}from"./Delete-2e42fa1b.js";import{E as xs}from"./Edit-2ba0063f.js";import{C as Cs}from"./Check-be05b6d4.js";const gs=l=>{let{count:m=0,items:a=[],onDeselectAll:n,onDeselectOne:d,onSelectAll:c,onSelectOne:x,selected:b=[],isLoading:j,isError:r}=l;const t=R(),[D,C]=v.useState(1),[i,S]=v.useState(!1),[O,P]=v.useState(25),{t:g,i18n:Se}=F(),[ce,me]=v.useState({}),[ne,$]=v.useState(!1),[ue,pe]=v.useState(),[p,f]=v.useState(),U=[{mode:1,text:g(s.global.oui)},{mode:2,text:g(s.global.enCours)},{mode:3,text:g(s.global.echec)}],X=[g(s.paiment.espece),g(s.paiment.virment),g(s.paiment.cheque),g(s.paiment.lcn)],[q,M]=v.useState(null),B=!!q,Pe=(h,y)=>{f(y),M(h.currentTarget)},Ue=()=>{M(null)},Te=(h,y)=>{C(y)},Re=h=>{me(y=>({...y,[h]:!y[h]}))},ae=(h,y)=>{const J=a.filter(Q=>Q.id==h);t(o.actions.setCurrentData(J[0])),y=="update"?t(o.actions.openCloseModalUpdate()):y=="delete"?t(o.actions.openCloseModalDelete()):y=="paimentHistory"?t(o.actions.openCloseModalHistory()):S(!0)},_e=a==null?void 0:a.slice((D-1)*O,D*O);v.useEffect(()=>{C(1)},[a]);const Ie=h=>{w.put("/paymentsupplier/payed/",{id:p,mode:h}).then(y=>{t(o.actions.handlePayed({id:p,data:y.data})),M(null)})};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsxs(Ce,{children:[e.jsx(ge,{children:e.jsxs(I,{children:[e.jsx(u,{}),e.jsx(u,{children:g(s.nav.fournisseur)}),e.jsxs(u,{children:[g(s.paiment.amount)," ",g(s.global.mad)]}),e.jsx(u,{children:g(s.entrer.date)}),e.jsx(u,{children:g(s.paiment.typePayment)}),e.jsx(u,{children:g(s.paiment.isPayed)}),e.jsx(u,{})]})}),j?e.jsx(Ke,{rowsNum:10}):e.jsx(je,{children:_e.length>0?_e.map(h=>{const y=ce[h.id]||!1;let J=new Date(h.date),Q={year:J.getFullYear(),month:`${J.getMonth()+1}`,day:`${J.getDate()}`};const Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[e.jsx(u,{children:h.payment_proof.length!==0&&e.jsx(_,{"aria-label":"expand row",size:"small",onClick:()=>Re(h.id),children:y?e.jsx(as,{}):e.jsx(os,{})})}),e.jsxs(u,{children:[h.name," ",h.last_name]}),e.jsx(u,{sx:{direction:"initial",whiteSpace:"nowrap"},children:Ge.format(h.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(u,{children:[" ",Q.day.padStart(2,0),"/",Q.month.padStart(2,0),"/",Q.year]}),e.jsx(u,{children:X[h.mode-1]}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":B?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":B?"true":void 0,onClick:E=>Pe(E,h.id),color:h.payed==1?"success":h.payed==2?"warning":"error",sx:{"&:disabled":{color:E=>E.palette.success.dark}},disabled:h.mode==1||h.mode==2,children:U[h.payed-1].text}),(h.payed==3||h.history)&&e.jsx(_,{color:"success",onClick:()=>ae(h.id,"paimentHistory"),children:e.jsx(L,{children:e.jsx(Qe,{path:we,size:1})})}),e.jsx(Me,{id:"basic-menu",anchorEl:q,open:B,onClose:Ue,MenuListProps:{"aria-labelledby":"basic-button"},children:U.map((E,he)=>e.jsx(A,{onClick:Fs=>Ie(E.mode),children:E.text},he))})]})}),e.jsxs(u,{children:[e.jsx(_,{color:"warning",onClick:()=>ae(h.id,"update"),children:e.jsx(L,{children:e.jsx($e,{})})}),e.jsx(_,{color:"error",onClick:()=>ae(h.id,"delete"),children:e.jsx(L,{children:e.jsx(rs,{})})}),h.payment_proof.length!==4&&e.jsx(_,{color:"success",onClick:()=>ae(h.id,"upload"),children:e.jsx(L,{children:e.jsx(is,{})})})]})]}),e.jsx(I,{children:e.jsx(u,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(ke,{in:y,timeout:"auto",unmountOnExit:!0,children:e.jsx(xe,{sx:{width:"100%"},component:Ee,children:e.jsxs(Ce,{sx:{width:"100%"},children:[e.jsx(ge,{children:e.jsxs(I,{children:[e.jsx(u,{children:g(s.paiment.fileName)}),e.jsx(u,{})]})}),e.jsx(je,{children:h.payment_proof.map((E,he)=>e.jsxs(I,{children:[e.jsx(u,{children:E.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(u,{children:[" ",e.jsx(_,{color:"inherit",onClick:()=>{t(o.actions.openCloseConfirmDeleteProof()),t(o.actions.setCurrentData({id:h.id,idFile:E.id}))},children:e.jsx(L,{children:e.jsx(Xe,{})})}),e.jsx(_,{color:"secondary",onClick:()=>{pe({file:E.file,extension:E.extension}),$(!0)},children:e.jsx(L,{children:e.jsx(ze,{})})})]})]},he))})]})})})})})]})}):e.jsx(I,{children:e.jsx(u,{colSpan:5,sx:{textAlign:"center"},children:g(s.batiment.nothingToDisplay)})})})]})}),e.jsx(Ae,{sx:{display:"flex",justifyContent:"end",p:"5px"},children:e.jsx(Ve,{count:Math.ceil(m/O),defaultPage:D,onChange:Te,color:"primary",size:"large"})}),r&&e.jsx(ns,{}),i&&e.jsx(Ze,{isFournisseur:!0,isModalUpload:i,close:()=>S(!1)}),ne&&e.jsx(Je,{isPreview:ne,close:()=>$(!1),file:ue})]})};function js({fournisseur:l}){te.locale("fr");const{t:m,i18n:a}=F(),n=R(),d=le({initialValues:{date1:null,date2:null,eggsource:""},validationSchema:de({date1:Oe().nullable().test("is-before-date2",m(s.global.date2Greather),function(c){const{date2:x}=this.parent;return c<=x}),date2:Oe().nullable().test("is-after-date1",m(s.global.date2Greather),function(c){const{date1:x}=this.parent;return c>=x})}),onSubmit:async(c,{resetForm:x,setErrors:b})=>{let j="";for(let r in c)if(c[r]!==""&&c[r]!==null){let t=new Date(c[r]),D=t.getFullYear()!==1970?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:c[r];j==""?j+=`?${r}=${D}`:j+=`&${r}=${D}`}w.get("/paymentsupplier/list/"+j).then(r=>{n(o.actions.fetchPaimentF(r.data))})},onReset:()=>{w.get("/paymentsupplier/list/").then(c=>{n(o.actions.fetchPaimentF(c.data))})}});return e.jsxs(ds,{defaultExpanded:!0,children:[e.jsx(cs,{expandIcon:e.jsx(ps,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(ms,{}),m(s.global.filter)]})}),e.jsx(us,{children:e.jsx(Fe,{children:e.jsx(ls,{children:e.jsx("form",{noValidate:!0,onSubmit:d.handleSubmit,onReset:d.handleReset,children:e.jsxs(N,{container:!0,alignItems:"center",gap:2,children:[e.jsx(N,{item:!0,xs:12,md:5,sm:12,children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{id:"batiment-id",children:m(s.fournisseur.title)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:d.handleBlur,fullWidth:!0,name:"eggsource",onChange:d.handleChange,value:d.values.eggsource,label:m(s.fournisseur.title),children:l==null?void 0:l.map(c=>e.jsx(A,{value:c.id,children:c.name}))})]})}),e.jsx(N,{item:!0,xs:12,md:2,sm:12,children:e.jsx(K,{value:d.values.date1,onChange:c=>d.setFieldValue("date1",c),onBlur:d.handleBlur,label:m(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(d.touched.date1&&d.errors.date1),helperText:d.touched.date1&&d.errors.date1}}})}),e.jsx(N,{item:!0,xs:12,md:2,sm:12,children:e.jsx(K,{value:d.values.date2,onChange:c=>d.setFieldValue("date2",c),onBlur:d.handleBlur,label:m(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(d.touched.date2&&d.errors.date2),helperText:d.touched.date2&&d.errors.date2}}})}),e.jsxs(N,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(N,{items:!0,children:e.jsx(G,{variant:"contained",type:"reset",children:m(s.global.reset)})}),e.jsx(N,{items:!0,children:e.jsx(G,{type:"submit",variant:"contained",children:m(s.global.filter)})})]})]})})})})})]})}function Ds({fournisseur:l}){const{t:m,i18n:a}=F(),n=R(),d=De("paimentsF",ve.fetchPaimentFournisseur),{paimentF:c}=k(x=>x.paimentFournisseur);return v.useEffect(()=>{d.status=="success"&&n(o.actions.fetchPaimentF(d.data))},[d.status]),e.jsx(Le,{maxWidth:"xl",children:e.jsxs(Z,{spacing:4,children:[e.jsxs(Z,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(Z,{spacing:1,children:e.jsx(se,{variant:"h4",children:m(s.paimentF.title)})}),e.jsx(Z,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(G,{startIcon:e.jsx(L,{children:e.jsx(qe,{})}),variant:"contained",onClick:()=>n(o.actions.openCloseModalAdd()),children:m(s.global.ajouter)})})]}),e.jsxs(Fe,{children:[e.jsx(js,{fournisseur:l}),e.jsx(gs,{items:c,count:c.length,rowsPerPage:25,isLoading:d.isLoading,isError:d.isError})]})]})})}const vs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function fs({fournisseur:l,paimentModes:m}){const a=R(),{t:n,i18n:d}=F(),{isModalAdd:c,isConfirm:x}=k(C=>C.paimentFournisseur),b=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],j=de({eggsource:W().required(n(s.sortie.fournisseurRequired)),amount:W().required(n(s.paiment.amountRequired)),mode:W().required(n(s.paiment.typePaymentRequired))}),r=le({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:j,onSubmit:async(C,{resetForm:i,setErrors:S})=>{const O={...C};O.date=te(C.date).format("YYYY-MM-DD"),w.post("/paymentsupplier/add/",O).then(P=>{a(o.actions.addPaimentF(P.data)),a(o.actions.openCloseModalAdd()),a(o.actions.openCloseConfirm()),T.success(n(s.paiment.toastAddSuccess)),i()}).catch(P=>{a(o.actions.openCloseConfirm()),T.error(n(s.global.toastError))})}}),t=async C=>{C.preventDefault();const i=await r.validateForm();Object.keys(i).length===0?a(o.actions.openCloseConfirm()):await r.submitForm()},D=()=>{r.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(z,{open:c,onClose:()=>a(o.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(re,{sx:vs,children:[e.jsxs(fe,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(se,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalAdd()),children:e.jsx(ie,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:C=>t(C),children:[e.jsxs(H,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.eggsource&&r.errors.eggsource),children:[e.jsx(V,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"eggsource",onChange:r.handleChange,value:r.values.eggsource,label:n(s.fournisseur.title),children:l.length>0?l.map(C=>e.jsxs(A,{value:C.id,children:[C.name," ",C.last_name]})):e.jsx(A,{children:n(s.batiment.nothingToDisplay)})}),r.touched.eggsource&&r.errors.eggsource&&e.jsx(ee,{children:r.errors.eggsource})]}),e.jsxs(H,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.mode&&r.errors.mode),children:[e.jsx(V,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"mode",onChange:r.handleChange,value:r.values.mode,label:n(s.paiment.typePayment),children:m.map(C=>e.jsx(A,{value:C.id,children:b[C.id-1]}))}),r.touched.mode&&r.errors.mode&&e.jsx(ee,{children:r.errors.mode})]}),e.jsx(oe,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:r.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:r.handleChange,value:r.values.amount,error:!!(r.touched.amount&&r.errors.amount),helperText:r.touched.amount&&r.errors.amount,style:{marginBottom:"15px"}}),e.jsx(K,{label:n(s.entrer.date),value:r.values.date,onChange:C=>r.setFieldValue("date",C),onBlur:r.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(ye,{confirmed:D,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:x})]})}const bs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ys({fournisseur:l,paimentModes:m}){const a=R(),{t:n,i18n:d}=F(),{currentData:c,isModalUpdate:x,isConfirm:b}=k(i=>i.paimentFournisseur),j=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],r=de({eggsource:W().required(n(s.sortie.fournisseurRequired)),amount:W().required(n(s.paiment.amountRequired)),mode:W().required(n(s.paiment.typePaymentRequired))}),t=le({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:r,onSubmit:async(i,{resetForm:S,setErrors:O})=>{const P={...i};P.date=te(i.date).format("YYYY-MM-DD"),w.put("/paymentsupplier/update/",P).then(g=>{a(o.actions.editPaimentF(g.data)),a(o.actions.openCloseModalUpdate()),a(o.actions.openCloseConfirm()),T.success(n(s.paiment.toastUpdateSuccess)),S()}).catch(g=>{a(o.actions.openCloseConfirm()),T.error(n(s.global.toastError))})}}),D=async i=>{i.preventDefault();const S=await t.validateForm();Object.keys(S).length===0?a(o.actions.openCloseConfirm()):await t.submitForm()},C=()=>{t.handleSubmit()};return v.useEffect(()=>{let i={...c};i.date=new Date(i.date),t.setValues(i)},[]),e.jsxs(e.Fragment,{children:[e.jsx(z,{open:x,onClose:()=>a(o.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(re,{sx:bs,children:[e.jsxs(fe,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(se,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.update)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalUpdate()),children:e.jsx(ie,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>D(i),children:[e.jsxs(H,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.eggsource&&t.errors.eggsource),children:[e.jsx(V,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"eggsource",onChange:t.handleChange,value:t.values.eggsource,label:n(s.fournisseur.title),children:l.length>0?l.map(i=>e.jsxs(A,{value:i.id,children:[i.name," ",i.last_name]})):e.jsx(A,{children:n(s.batiment.nothingToDisplay)})}),t.touched.eggsource&&t.errors.eggsource&&e.jsx(ee,{children:t.errors.eggsource})]}),e.jsxs(H,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(V,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:m.map(i=>e.jsx(A,{value:i.id,children:j[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(ee,{children:t.errors.mode})]}),e.jsx(oe,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(K,{label:n(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(ye,{confirmed:C,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:b})]})}function Ss(){const{currentData:l,isModalDelete:m}=k(x=>x.paimentFournisseur),a=R(),{t:n,i18n:d}=F(),c=()=>{w.delete(`/paymentsupplier/delete/${l.id}`).then(x=>{a(o.actions.deletePaimentF()),a(o.actions.openCloseModalDelete()),T.success(n(s.paiment.toastDeleteSuccess))}).catch(x=>{a(o.actions.openCloseModalDelete()),T.error(n(s.global.toastError))})};return e.jsx(z,{open:m,onClose:()=>a(o.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(be,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:c,cancel:()=>a(o.actions.openCloseModalDelete())})})}function Ps(){const{currentData:l,isModalDeleteProof:m}=k(x=>x.paimentFournisseur),a=R(),{t:n,i18n:d}=F(),c=()=>{w.delete(`/paymentsupplier/proof/delete/${l.idFile}`).then(x=>{a(o.actions.deletePaimentFProof()),a(o.actions.openCloseConfirmDeleteProof()),T.success(n(s.global.toastSuccessDeleteFile))}).catch(x=>{a(o.actions.openCloseConfirmDeleteProof()),T.error(n(s.global.toastError))})};return e.jsx(z,{open:m,onClose:()=>a(o.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(be,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:c,cancel:()=>a(o.actions.openCloseConfirmDeleteProof())})})}function _s({isOpen:l,close:m,handleDelete:a}){const{t:n,i18n:d}=F();return e.jsx(z,{open:l,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(be,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:a,cancel:m})})}function Os(){const{t:l,i18n:m}=F(),{currentData:a}=k(p=>p.paimentFournisseur),[n,d]=v.useState(),c=R(),[x,b]=v.useState(!1),[j,r]=v.useState(!1),[t,D]=v.useState(),C=[{mode:1,text:l(s.global.oui)},{mode:2,text:l(s.global.enCours)},{mode:3,text:l(s.global.echec)}],i=[l(s.paiment.espece),l(s.paiment.virment),l(s.paiment.cheque),l(s.paiment.lcn)],[S,O]=v.useState(null),P=!!S,g=(p,f)=>{d(f),O(p.currentTarget)},Se=()=>{O(null)},ce=p=>{w.put("/payment/payedcorrection/",{id:n,mode:p}).then(f=>{c(o.actions.handlePayedCorrection({id:n,data:f.data})),O(null)})},me=(p,f)=>{D(f),b(!0),d(p)},ne=p=>{r(!0),d(p)},$=p=>{const f=p.target.name;D(f?U=>({...U,date:new Date(U.date),[f]:Number(p.target.value)}):U=>({...U,date:new Date(U.date)}))},ue=()=>{let p={...t,date:te(t.date).format("YYYY-MM-DD")};w.put("/paymentsupplier/updatecorrection/",p).then(f=>{c(o.actions.handlePayedCorrection({id:n,data:f.data})),b(!1)})},pe=()=>{w.delete(`/paymentsupplier/deletecorrection/${n}`).then(p=>{c(o.actions.deletePaimentHistory()),r(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{sx:{position:"relative"},children:e.jsx(xe,{component:Ee,children:e.jsxs(Ce,{sx:{minWidth:700},children:[e.jsx(ge,{children:e.jsxs(I,{children:[e.jsxs(u,{children:[l(s.paiment.amount)," ",l(s.global.mad)]}),e.jsx(u,{children:l(s.entrer.date)}),e.jsx(u,{children:l(s.paiment.typePayment)}),e.jsx(u,{children:l(s.paiment.isPayed)}),e.jsx(u,{})]})}),e.jsx(je,{children:a.payment_correction.map((p,f)=>{const U=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});let X=new Date(p.date),q={year:X.getFullYear(),month:`${X.getMonth()+1}`,day:`${X.getDate()}`};return!x||a.payment_correction.length-1!==f?e.jsxs(I,{children:[e.jsxs(u,{sx:{direction:"initial"},children:[" ",U.format(p.amount).replaceAll(","," ").replace("MAD","")]}),e.jsxs(u,{children:[" ",q.day.padStart(2,0),"/",q.month.padStart(2,0),"/",q.year]}),e.jsx(u,{children:i[p.mode-1]}),e.jsxs(u,{children:[" ",e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":P?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":P?"true":void 0,onClick:M=>g(M,p.id),color:p.payed==1?"success":p.payed==2?"warning":"error",sx:{"&:disabled":{color:M=>M.palette.success.dark}},disabled:p.mode==1||p.mode==2?!0:f==0,children:C[Number(p.payed)-1].text}),p.payed==3&&e.jsx(_,{color:"success",onClick:()=>openModal(p.id,"paimentHistory"),children:e.jsx(L,{children:e.jsx(es,{path:we,size:1})})}),e.jsx(Me,{id:"basic-menu",anchorEl:S,open:P,onClose:Se,MenuListProps:{"aria-labelledby":"basic-button"},children:C.map((M,B)=>e.jsx(A,{onClick:Pe=>ce(M.mode),children:M.text},B))})]})]}),a.payment_correction.length-1==f&&f!==0&&e.jsxs(u,{children:[e.jsx(_,{color:"error",onClick:()=>ne(p.id),children:e.jsx(hs,{})}),e.jsx(_,{color:"warning",onClick:()=>me(p.id,p),children:e.jsx(xs,{})})]})]}):e.jsxs(I,{children:[e.jsx(u,{sx:{direction:"initial"},children:e.jsx(oe,{value:t.amount,fullWidth:!0,label:l(s.paiment.amount),type:"number",name:"amount",onChange:$})}),e.jsxs(u,{children:[" ",e.jsx(K,{value:new Date(t.date),name:"date",onChange:$,label:l(s.entrer.date)})]}),e.jsx(u,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{id:"demo-simple-select-label",children:l(s.paiment.typePayment)}),e.jsx(Y,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:t.mode,label:l(s.paiment.typePayment),onChange:$,name:"mode",children:i.map((M,B)=>e.jsx(A,{value:B+1,children:M}))})]})}),e.jsxs(u,{children:[e.jsx(_,{color:"success",onClick:ue,children:e.jsx(Cs,{})}),e.jsx(_,{color:"error",onClick:()=>b(!1),children:e.jsx(ss,{})})]})]})})})]})})}),e.jsx(_s,{isOpen:j,close:()=>r(!1),handleDelete:pe})]})}function Ms(){const l=R(),m=We(),{t:a}=F(),{currentData:n,isModalHistory:d}=k(j=>j.paimentFournisseur),c=Be(m.breakpoints.down("md")),[x,b]=v.useState(!0);return v.useEffect(()=>{let j=n.payment_correction[0].amount;n.payment_correction.slice(1,n.payment_correction.length).reduce((t,D)=>D.payed==1?t+D.amount:t,0)>=j&&b(!1)},[n]),e.jsxs(Ne,{onClose:()=>l(o.actions.openCloseModalHistory()),fullScreen:c,open:d,maxWidth:"lg",children:[e.jsxs(ts,{sx:{m:0,p:2.5},id:"customized-dialog-title",children:[a(s.paiment.titleHistory)," ",n.name," ",n.last_name]}),e.jsx(_,{"aria-label":"close",onClick:()=>l(o.actions.openCloseModalHistory()),sx:j=>({position:"absolute",right:8,top:8,color:j.palette.grey[500]}),children:e.jsx(ie,{})}),e.jsxs(He,{children:[e.jsxs(Z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:1.5,children:[e.jsx(se,{variant:"h6"}),x&&e.jsx(G,{variant:"contained",onClick:()=>l(o.actions.openCloseModalAddHistory()),children:a(s.global.ajouter)})]}),e.jsx(Os,{})]})]})}const Es={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function As({paimentModes:l}){const m=R(),{t:a,i18n:n}=F(),d=[a(s.paiment.espece),a(s.paiment.virment),a(s.paiment.cheque),a(s.paiment.lcn)],{paiment:c,isModalAddHistory:x,currentData:b,isConfirm:j}=k(i=>i.paimentFournisseur),r=de({amount:W().required(a(s.paiment.amountRequired)),mode:W().required(a(s.paiment.typePaymentRequired))}),t=le({initialValues:{amount:"",mode:"",date:new Date,payment:b.id},validationSchema:r,onSubmit:async(i,{resetForm:S,setErrors:O})=>{const P={...i};P.date=te(i.date).format("YYYY-MM-DD"),w.post("/paymentsupplier/addcorrection/",P).then(g=>{m(o.actions.addPaimentFHistory(g.data)),m(o.actions.openCloseModalAddHistory()),m(o.actions.openCloseConfirm()),T.success(a(s.paiment.toastAddSuccess)),S()}).catch(g=>{m(o.actions.openCloseConfirm()),T.error(a(s.global.toastError))})}}),D=async i=>{i.preventDefault();const S=await t.validateForm();Object.keys(S).length===0?m(o.actions.openCloseConfirm()):await t.submitForm()},C=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(z,{open:x,onClose:()=>m(o.actions.openCloseModalAddHistory()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(re,{sx:Es,children:[e.jsxs(fe,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(se,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>m(o.actions.openCloseModalAddHistory()),children:e.jsx(ie,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>D(i),children:[e.jsxs(H,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(V,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx(Y,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:a(s.paiment.typePayment),children:l.map(i=>e.jsx(A,{value:i.id,children:d[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(ee,{children:t.errors.mode})]}),e.jsx(oe,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(K,{label:a(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(ye,{confirmed:C,cancel:()=>m(o.actions.openCloseConfirm()),isConfirm:j})]})}function ws(){const{isModalAdd:l,isModalUpdate:m,isModalDelete:a,isModalHistory:n,isModalAddHistory:d}=k(b=>b.paimentFournisseur),c=De("paymentMethod",ve.paymentMode),x=De("fournisseur",ve.getBatimentSelect);return e.jsxs(e.Fragment,{children:[" ",e.jsx(re,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(Ds,{fournisseur:x.data})}),l&&e.jsx(fs,{fournisseur:x.data,paimentModes:c.data}),m&&e.jsx(ys,{fournisseur:x.data,paimentModes:c.data}),d&&e.jsx(As,{paimentModes:c.data}),a&&e.jsx(Ss,{}),e.jsx(Ps,{}),n&&e.jsx(Ms,{})]})}function Zs(){return e.jsx(e.Fragment,{children:e.jsx(Ye,{children:e.jsx(ws,{})})})}export{Zs as default};
