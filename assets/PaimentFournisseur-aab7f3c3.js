import{a2 as w,r as f,d as M,l as s,j as e,a1 as A,a as E,V as R,ak as De,ae as _,al as Ge,a3 as je,ap as o,h as I,ab as W,ac as B,ad as k,a6 as F,C as Le,i as H,T as $,a7 as q,F as V,k as de,Y as O,B as We,O as Be,u as ke,an as Ne,ao as He}from"./index-b9aeea20.js";import{e as ne,T as ae,a as oe,b as U,c as x,d as re,f as Ve,g as X,G as L,u as ie,h as le,B as z,S as ce,E as Ye}from"./moment-8bb476e3.js";import{E as $e,P as qe,M as be}from"./ModalDelete-e666945f.js";import{T as Ke,C as J}from"./TableRowsLoader-c4300d5c.js";import{E as Xe}from"./Eye-bd865af3.js";import{T as ze}from"./index-75d71bb2.js";import{F as Je}from"./FilePreview-05d835a3.js";import{I as Qe,m as fe,U as Ze,a as es,D as ss}from"./UploadFileModel-556f8c1c.js";import{A as ts}from"./AlertError-9fdceddd.js";import{K as ns,a as as}from"./KeyboardArrowUp-80820a8c.js";import{D as os}from"./DeleteOutlineOutlined-7644538f.js";import{A as rs}from"./Add-94c13e39.js";import{u as Q,c as Z,e as ve,C as Se,b as is,d as T}from"./formik.esm-799b94e8.js";import{A as ls,a as ds,F as cs,b as ms}from"./fr-3088b82b.js";import{E as us}from"./ExpandMore-6e3ae782.js";import{D as Y}from"./DatePicker-05f47eec.js";import{M as me}from"./ModalConfirm-37aae7aa.js";const ps=d=>{let{count:u=0,items:a=[],onDeselectAll:n,onDeselectOne:c,onSelectAll:l,onSelectOne:p,selected:b=[],isLoading:g,isError:r}=d;const t=w(),[v,h]=f.useState(0),[i,D]=f.useState(!1),[S,y]=f.useState(25),{t:C,i18n:Os}=M(),[ye,Pe]=f.useState({}),[ue,pe]=f.useState(!1),[_e,Oe]=f.useState(),[he,Me]=f.useState(),xe=[{mode:1,text:C(s.global.oui)},{mode:2,text:C(s.global.enCours)},{mode:3,text:C(s.global.echec)}],Ae=[C(s.paiment.espece),C(s.paiment.virment),C(s.paiment.cheque),C(s.paiment.lcn)],[Ce,ee]=f.useState(null),se=!!Ce,Ee=(m,j)=>{Me(j),ee(m.currentTarget)},we=()=>{ee(null)},Fe=(m,j)=>{h(j)},Re=m=>{y(parseInt(m.target.value,10)),h(0)},Ue=m=>{Pe(j=>({...j,[m]:!j[m]}))},K=(m,j)=>{const G=a.filter(N=>N.id==m);t(o.actions.setCurrentData(G[0])),j=="update"?t(o.actions.openCloseModalUpdate()):j=="delete"?t(o.actions.openCloseModalDelete()):j=="paimentHistory"?(console.log("first"),t(o.actions.openCloseModalHistory())):D(!0)},ge=a==null?void 0:a.slice(v*S,v*S+S),Te=m=>{I.put("/paymentsupplier/payed/",{id:he,mode:m}).then(j=>{t(o.actions.handlePayed({id:he,data:j.data})),ee(null)})};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsx(x,{}),e.jsx(x,{children:C(s.nav.fournisseur)}),e.jsxs(x,{children:[C(s.paiment.amount)," ",C(s.global.mad)]}),e.jsx(x,{children:C(s.entrer.date)}),e.jsx(x,{children:C(s.paiment.typePayment)}),e.jsx(x,{children:C(s.paiment.isPayed)}),e.jsx(x,{})]})}),g?e.jsx(Ke,{rowsNum:10}):e.jsx(re,{children:ge.length>0?ge.map(m=>{const j=ye[m.id]||!1;let G=new Date(m.date),N={year:G.getFullYear(),month:`${G.getMonth()+1}`,day:`${G.getDate()}`};const Ie=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(x,{children:m.payment_proof.length!==0&&e.jsx(A,{"aria-label":"expand row",size:"small",onClick:()=>Ue(m.id),children:j?e.jsx(ns,{}):e.jsx(as,{})})}),e.jsxs(x,{children:[m.name," ",m.last_name]}),e.jsx(x,{sx:{direction:"initial",whiteSpace:"nowrap"},children:Ie.format(m.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(x,{children:[" ",N.day.padStart(2,0),"/",N.month.padStart(2,0),"/",N.year]}),e.jsx(x,{children:Ae[m.mode-1]}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx(E,{id:"basic-button","aria-controls":se?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":se?"true":void 0,onClick:P=>Ee(P,m.id),color:m.payed==1?"success":m.payed==2?"warning":"error",sx:{"&:disabled":{color:P=>P.palette.success.dark}},disabled:m.mode==1||m.mode==2,children:xe[m.payed-1].text}),(m.payed==3||m.history)&&e.jsx(A,{color:"success",onClick:()=>K(m.id,"paimentHistory"),children:e.jsx(R,{children:e.jsx(Qe,{path:fe,size:1})})}),e.jsx(De,{id:"basic-menu",anchorEl:Ce,open:se,onClose:we,MenuListProps:{"aria-labelledby":"basic-button"},children:xe.map((P,te)=>e.jsx(_,{onClick:Ms=>Te(P.mode),children:P.text},te))})]})}),e.jsxs(x,{children:[e.jsx(A,{color:"warning",onClick:()=>K(m.id,"update"),children:e.jsx(R,{children:e.jsx($e,{})})}),e.jsx(A,{color:"error",onClick:()=>K(m.id,"delete"),children:e.jsx(R,{children:e.jsx(os,{})})}),m.payment_proof.length!==4&&e.jsx(A,{color:"success",onClick:()=>K(m.id,"upload"),children:e.jsx(R,{children:e.jsx(rs,{})})})]})]}),e.jsx(U,{children:e.jsx(x,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Ge,{in:j,timeout:"auto",unmountOnExit:!0,children:e.jsx(ne,{sx:{width:"100%"},component:je,children:e.jsxs(ae,{sx:{width:"100%"},children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsx(x,{children:C(s.paiment.fileName)}),e.jsx(x,{})]})}),e.jsx(re,{children:m.payment_proof.map((P,te)=>e.jsxs(U,{children:[e.jsx(x,{children:P.file.replace("http://192.168.1.97:8000/api".replace("/api","")+"/uploads/","")}),e.jsxs(x,{children:[" ",e.jsx(A,{color:"inherit",onClick:()=>{t(o.actions.openCloseConfirmDeleteProof()),t(o.actions.setCurrentData({id:m.id,idFile:P.id}))},children:e.jsx(R,{children:e.jsx(ze,{})})}),e.jsx(A,{color:"secondary",onClick:()=>{Oe({file:P.file,extension:P.extension}),pe(!0)},children:e.jsx(R,{children:e.jsx(Xe,{})})})]})]},te))})]})})})})})]})}):e.jsx(U,{children:e.jsx(x,{colSpan:5,sx:{textAlign:"center"},children:C(s.batiment.nothingToDisplay)})})})]})}),e.jsx(Ve,{component:"div",count:u,onPageChange:Fe,onRowsPerPageChange:Re,page:v,rowsPerPage:S,rowsPerPageOptions:[5,10,25],labelRowsPerPage:C(s.batiment.Lignes),labelDisplayedRows:({from:m,to:j,count:G})=>`${m}â€“${j} ${C(s.batiment.sur)} ${G}`}),r&&e.jsx(ts,{}),i&&e.jsx(Ze,{isFournisseur:!0,isModalUpload:i,close:()=>D(!1)}),ue&&e.jsx(Je,{isPreview:ue,close:()=>pe(!1),file:_e})]})};function hs({fournisseur:d}){X.locale("fr");const{t:u,i18n:a}=M(),n=w(),c=Q({initialValues:{date1:null,date2:null,eggsource:""},validationSchema:Z({date1:ve().nullable().test("is-before-date2",u(s.global.date2Greather),function(l){const{date2:p}=this.parent;return l<=p}),date2:ve().nullable().test("is-after-date1",u(s.global.date2Greather),function(l){const{date1:p}=this.parent;return l>=p})}),onSubmit:async(l,{resetForm:p,setErrors:b})=>{let g="";for(let r in l)if(l[r]!==""&&l[r]!==null){let t=new Date(l[r]),v=t.getFullYear()!==1970?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:l[r];g==""?g+=`?${r}=${v}`:g+=`&${r}=${v}`}I.get("/paymentsupplier/list/"+g).then(r=>{n(o.actions.fetchPaimentF(r.data))})},onReset:()=>{I.get("/paymentsupplier/list/").then(l=>{n(o.actions.fetchPaimentF(l.data))})}});return e.jsxs(ls,{defaultExpanded:!0,children:[e.jsx(ds,{expandIcon:e.jsx(us,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(cs,{}),u(s.global.filter)]})}),e.jsx(ms,{children:e.jsx(Se,{children:e.jsx(is,{children:e.jsx("form",{noValidate:!0,onSubmit:c.handleSubmit,onReset:c.handleReset,children:e.jsxs(L,{container:!0,alignItems:"center",gap:2,children:[e.jsx(L,{item:!0,xs:12,md:5,sm:12,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(B,{id:"batiment-id",children:u(s.fournisseur.title)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:c.handleBlur,fullWidth:!0,name:"eggsource",onChange:c.handleChange,value:c.values.eggsource,label:u(s.fournisseur.title),children:d==null?void 0:d.map(l=>e.jsx(_,{value:l.id,children:l.name}))})]})}),e.jsx(L,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Y,{value:c.values.date1,onChange:l=>c.setFieldValue("date1",l),onBlur:c.handleBlur,label:u(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(c.touched.date1&&c.errors.date1),helperText:c.touched.date1&&c.errors.date1}}})}),e.jsx(L,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Y,{value:c.values.date2,onChange:l=>c.setFieldValue("date2",l),onBlur:c.handleBlur,label:u(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(c.touched.date2&&c.errors.date2),helperText:c.touched.date2&&c.errors.date2}}})}),e.jsxs(L,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(L,{items:!0,children:e.jsx(E,{variant:"contained",type:"reset",children:u(s.global.reset)})}),e.jsx(L,{items:!0,children:e.jsx(E,{type:"submit",variant:"contained",children:u(s.global.filter)})})]})]})})})})})]})}function xs({fournisseur:d}){const{t:u,i18n:a}=M(),n=w(),c=ie("paimentsF",le.fetchPaimentFournisseur),{paimentF:l}=F(p=>p.paimentFournisseur);return f.useEffect(()=>{c.status=="success"&&n(o.actions.fetchPaimentF(c.data))},[c.status]),e.jsx(Le,{maxWidth:"xl",children:e.jsxs(H,{spacing:4,children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(H,{spacing:1,children:e.jsx($,{variant:"h4",children:u(s.paimentF.title)})}),e.jsx(H,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(E,{startIcon:e.jsx(R,{children:e.jsx(qe,{})}),variant:"contained",onClick:()=>n(o.actions.openCloseModalAdd()),children:u(s.global.ajouter)})})]}),e.jsxs(Se,{children:[e.jsx(hs,{fournisseur:d}),e.jsx(ps,{items:l,count:l.length,rowsPerPage:25,isLoading:c.isLoading,isError:c.isError})]})]})})}const Cs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function gs({fournisseur:d,paimentModes:u}){const a=w(),{t:n,i18n:c}=M(),{isModalAdd:l,isConfirm:p}=F(h=>h.paimentFournisseur),b=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],g=Z({eggsource:T().required(n(s.sortie.fournisseurRequired)),amount:T().required(n(s.paiment.amountRequired)),mode:T().required(n(s.paiment.typePaymentRequired))}),r=Q({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:g,onSubmit:async(h,{resetForm:i,setErrors:D})=>{const S={...h};S.date=X(h.date).format("YYYY-MM-DD"),I.post("/paymentsupplier/add/",S).then(y=>{a(o.actions.addPaimentF(y.data)),a(o.actions.openCloseModalAdd()),a(o.actions.openCloseConfirm()),O.success(n(s.paiment.toastAddSuccess)),i()}).catch(y=>{a(o.actions.openCloseConfirm()),O.error(n(s.global.toastError))})}}),t=async h=>{h.preventDefault();const i=await r.validateForm();Object.keys(i).length===0?a(o.actions.openCloseConfirm()):await r.submitForm()},v=()=>{r.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(q,{open:l,onClose:()=>a(o.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(z,{sx:Cs,children:[e.jsxs(ce,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx($,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalAdd()),children:e.jsx(J,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:h=>t(h),children:[e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.eggsource&&r.errors.eggsource),children:[e.jsx(B,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"eggsource",onChange:r.handleChange,value:r.values.eggsource,label:n(s.fournisseur.title),children:d.length>0?d.map(h=>e.jsxs(_,{value:h.id,children:[h.name," ",h.last_name]})):e.jsx(_,{children:n(s.batiment.nothingToDisplay)})}),r.touched.eggsource&&r.errors.eggsource&&e.jsx(V,{children:r.errors.eggsource})]}),e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(r.touched.mode&&r.errors.mode),children:[e.jsx(B,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:r.handleBlur,fullWidth:!0,name:"mode",onChange:r.handleChange,value:r.values.mode,label:n(s.paiment.typePayment),children:u.map(h=>e.jsx(_,{value:h.id,children:b[h.id-1]}))}),r.touched.mode&&r.errors.mode&&e.jsx(V,{children:r.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:r.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:r.handleChange,value:r.values.amount,error:!!(r.touched.amount&&r.errors.amount),helperText:r.touched.amount&&r.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Y,{label:n(s.entrer.date),value:r.values.date,onChange:h=>r.setFieldValue("date",h),onBlur:r.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(E,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(me,{confirmed:v,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:p})]})}const vs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ds({fournisseur:d,paimentModes:u}){const a=w(),{t:n,i18n:c}=M(),{currentData:l,isModalUpdate:p,isConfirm:b}=F(i=>i.paimentFournisseur),g=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],r=Z({eggsource:T().required(n(s.sortie.fournisseurRequired)),amount:T().required(n(s.paiment.amountRequired)),mode:T().required(n(s.paiment.typePaymentRequired))}),t=Q({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:r,onSubmit:async(i,{resetForm:D,setErrors:S})=>{const y={...i};y.date=X(i.date).format("YYYY-MM-DD"),I.put("/paymentsupplier/update/",y).then(C=>{a(o.actions.editPaimentF(C.data)),a(o.actions.openCloseModalUpdate()),a(o.actions.openCloseConfirm()),O.success(n(s.paiment.toastUpdateSuccess)),D()}).catch(C=>{a(o.actions.openCloseConfirm()),O.error(n(s.global.toastError))})}}),v=async i=>{i.preventDefault();const D=await t.validateForm();Object.keys(D).length===0?a(o.actions.openCloseConfirm()):await t.submitForm()},h=()=>{t.handleSubmit()};return f.useEffect(()=>{let i={...l};i.date=new Date(i.date),t.setValues(i)},[]),e.jsxs(e.Fragment,{children:[e.jsx(q,{open:p,onClose:()=>a(o.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(z,{sx:vs,children:[e.jsxs(ce,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx($,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.update)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(o.actions.openCloseModalUpdate()),children:e.jsx(J,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>v(i),children:[e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.eggsource&&t.errors.eggsource),children:[e.jsx(B,{id:"batiment-id",children:n(s.fournisseur.title)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"eggsource",onChange:t.handleChange,value:t.values.eggsource,label:n(s.fournisseur.title),children:d.length>0?d.map(i=>e.jsxs(_,{value:i.id,children:[i.name," ",i.last_name]})):e.jsx(_,{children:n(s.batiment.nothingToDisplay)})}),t.touched.eggsource&&t.errors.eggsource&&e.jsx(V,{children:t.errors.eggsource})]}),e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(B,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:u.map(i=>e.jsx(_,{value:i.id,children:g[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(V,{children:t.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Y,{label:n(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(E,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(me,{confirmed:h,cancel:()=>a(o.actions.openCloseConfirm()),isConfirm:b})]})}function js(){const{currentData:d,isModalDelete:u}=F(p=>p.paimentFournisseur),a=w(),{t:n,i18n:c}=M(),l=()=>{I.delete(`/paymentsupplier/delete/${d.id}`).then(p=>{a(o.actions.deletePaimentF()),a(o.actions.openCloseModalDelete()),O.success(n(s.paiment.toastDeleteSuccess))}).catch(p=>{a(o.actions.openCloseModalDelete()),O.error(n(s.global.toastError))})};return e.jsx(q,{open:u,onClose:()=>a(o.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(be,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:l,cancel:()=>a(o.actions.openCloseModalDelete())})})}function bs(){const{currentData:d,isModalDeleteProof:u}=F(p=>p.paimentFournisseur),a=w(),{t:n,i18n:c}=M(),l=()=>{I.delete(`/paymentsupplier/proof/delete/${d.idFile}`).then(p=>{a(o.actions.deletePaimentFProof()),a(o.actions.openCloseConfirmDeleteProof()),O.success(n(s.global.toastSuccessDeleteFile))}).catch(p=>{a(o.actions.openCloseConfirmDeleteProof()),O.error(n(s.global.toastError))})};return e.jsx(q,{open:u,onClose:()=>a(o.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(be,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:l,cancel:()=>a(o.actions.openCloseConfirmDeleteProof())})})}function fs(){const{t:d,i18n:u}=M(),{currentData:a}=F(t=>t.paimentFournisseur),n=[{mode:1,text:d(s.global.oui)},{mode:2,text:d(s.global.enCours)},{mode:3,text:d(s.global.echec)}],c=[d(s.paiment.espece),d(s.paiment.virment),d(s.paiment.cheque),d(s.paiment.lcn)],[l,p]=f.useState(null),b=!!l,g=(t,v)=>{setCurrentId(v),p(t.currentTarget)},r=()=>{p(null)};return e.jsx(We,{sx:{position:"relative"},children:e.jsx(ne,{component:je,children:e.jsxs(ae,{sx:{minWidth:700},children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsxs(x,{children:[d(s.paiment.amount)," ",d(s.global.mad)]}),e.jsx(x,{children:d(s.entrer.date)}),e.jsx(x,{children:d(s.paiment.typePayment)}),e.jsx(x,{children:d(s.paiment.isPayed)})]})}),e.jsx(re,{children:a.payment_correction.map(t=>{const v=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});let h=new Date(t.date),i={year:h.getFullYear(),month:`${h.getMonth()+1}`,day:`${h.getDate()}`};return e.jsxs(U,{children:[e.jsxs(x,{sx:{direction:"initial"},children:[" ",v.format(t.amount).replaceAll(","," ").replace("MAD","")]}),e.jsxs(x,{children:[" ",i.day.padStart(2,0),"/",i.month.padStart(2,0),"/",i.year]}),e.jsx(x,{children:c[t.mode-1]}),e.jsxs(x,{children:[" ",e.jsxs("div",{children:[e.jsx(E,{id:"basic-button","aria-controls":b?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,onClick:D=>g(D,t.id),color:t.payed==1?"success":t.payed==2?"warning":"error",sx:{"&:disabled":{color:D=>D.palette.success.dark}},disabled:t.mode==1||t.mode==2,children:n[Number(t.payed)-1].text}),t.payed==3&&e.jsx(A,{color:"success",onClick:()=>openModal(t.id,"paimentHistory"),children:e.jsx(R,{children:e.jsx(es,{path:fe,size:1})})}),e.jsx(De,{id:"basic-menu",anchorEl:l,open:b,onClose:r,MenuListProps:{"aria-labelledby":"basic-button"},children:n.map((D,S)=>e.jsx(_,{onClick:y=>handlePayed(D.mode),children:D.text},S))})]})]})]})})})]})})})}function Ss(){const d=w(),u=Be(),{t:a}=M(),{currentData:n,isModalHistory:c}=F(g=>g.paimentFournisseur),l=ke(u.breakpoints.down("md")),[p,b]=f.useState(!0);return f.useEffect(()=>{let g=n.payment_correction[0].amount;n.payment_correction.slice(1,n.payment_correction.length).reduce((t,v)=>v.payed==1?t+v.amount:t,0)>=g&&b(!1)},[n]),e.jsxs(Ne,{onClose:()=>d(o.actions.openCloseModalHistory()),fullScreen:l,open:c,maxWidth:"lg",children:[e.jsxs(ss,{sx:{m:0,p:2.5},id:"customized-dialog-title",children:[a(s.paiment.titleHistory)," ",n.name," ",n.last_name]}),e.jsx(A,{"aria-label":"close",onClick:()=>d(o.actions.openCloseModalHistory()),sx:g=>({position:"absolute",right:8,top:8,color:g.palette.grey[500]}),children:e.jsx(J,{})}),e.jsxs(He,{children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:1.5,children:[e.jsx($,{variant:"h6"}),p&&e.jsx(E,{variant:"contained",onClick:()=>d(o.actions.openCloseModalAddHistory()),children:a(s.global.ajouter)})]}),e.jsx(fs,{})]})]})}const ys={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ps({paimentModes:d}){const u=w(),{t:a,i18n:n}=M(),c=[a(s.paiment.espece),a(s.paiment.virment),a(s.paiment.cheque),a(s.paiment.lcn)],{paiment:l,isModalAddHistory:p,currentData:b,isConfirm:g}=F(i=>i.paimentFournisseur),r=Z({amount:T().required(a(s.paiment.amountRequired)),mode:T().required(a(s.paiment.typePaymentRequired))}),t=Q({initialValues:{amount:"",mode:"",date:new Date,payment:b.id},validationSchema:r,onSubmit:async(i,{resetForm:D,setErrors:S})=>{const y={...i};y.date=X(i.date).format("YYYY-MM-DD"),I.post("/paymentsupplier/addcorrection/",y).then(C=>{u(o.actions.addPaimentFHistory(C.data)),u(o.actions.openCloseModalAddHistory()),u(o.actions.openCloseConfirm()),O.success(a(s.paiment.toastAddSuccess)),D()}).catch(C=>{u(o.actions.openCloseConfirm()),O.error(a(s.global.toastError))})}}),v=async i=>{i.preventDefault();const D=await t.validateForm();Object.keys(D).length===0?u(o.actions.openCloseConfirm()):await t.submitForm()},h=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(q,{open:p,onClose:()=>u(o.actions.openCloseModalAddHistory()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(z,{sx:ys,children:[e.jsxs(ce,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx($,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>u(o.actions.openCloseModalAddHistory()),children:e.jsx(J,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:i=>v(i),children:[e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(B,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx(k,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:a(s.paiment.typePayment),children:d.map(i=>e.jsx(_,{value:i.id,children:c[i.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(V,{children:t.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Y,{label:a(s.entrer.date),value:t.values.date,onChange:i=>t.setFieldValue("date",i),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(E,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(me,{confirmed:h,cancel:()=>u(o.actions.openCloseConfirm()),isConfirm:g})]})}function _s(){const{isModalAdd:d,isModalUpdate:u,isModalDelete:a,isModalHistory:n,isModalAddHistory:c}=F(b=>b.paimentFournisseur),l=ie("paymentMethod",le.paymentMode),p=ie("fournisseur",le.getBatimentSelect);return e.jsxs(e.Fragment,{children:[" ",e.jsx(z,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(xs,{fournisseur:p.data})}),d&&e.jsx(gs,{fournisseur:p.data,paimentModes:l.data}),u&&e.jsx(Ds,{fournisseur:p.data,paimentModes:l.data}),c&&e.jsx(Ps,{paimentModes:l.data}),a&&e.jsx(js,{}),e.jsx(bs,{}),n&&e.jsx(Ss,{})]})}function $s(){return e.jsx(e.Fragment,{children:e.jsx(Ye,{children:e.jsx(_s,{})})})}export{$s as default};
