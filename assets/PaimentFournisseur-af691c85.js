import{a2 as _,r as j,d as O,l as s,j as e,a1 as F,a as G,ak as Te,ae as S,V as T,al as Ie,a3 as Ge,an as r,am as Le,h as y,ab as W,ac as N,ad as B,a6 as U,C as We,i as V,T as Q,a7 as k,F as H,k as Ce,Y as P}from"./index-2315324d.js";import{e as ce,T as me,a as ue,b as w,c as C,d as pe,f as Ne,g as Z,G as M,u as z,h as J,B as ee,S as ge,E as Be}from"./moment-0b0e8416.js";import{E as ke,P as Ve,M as xe}from"./ModalDelete-f6fc281f.js";import{T as He,C as De}from"./TableRowsLoader-12723a10.js";import{E as Ye}from"./Eye-ae0c2454.js";import{T as $e}from"./index-fe901995.js";import{F as Ke}from"./FilePreview-7330affd.js";import{U as qe}from"./UploadFileModel-f28336f7.js";import{A as Xe}from"./AlertError-b447808a.js";import{K as ze,a as Je}from"./KeyboardArrowUp-16b54b68.js";import{D as Qe}from"./DeleteOutlineOutlined-3338308b.js";import{A as Ze}from"./Add-fb3f4505.js";import{u as se,c as ae,e as he,C as ve,b as es,d as I}from"./formik.esm-a69188f0.js";import{A as ss,a as as,F as ns,b as ts}from"./fr-8077ad92.js";import{E as os}from"./ExpandMore-0cef7d7e.js";import{D as Y}from"./DatePicker-794fd4c1.js";import{M as rs}from"./ModalConfirm-1555c5f9.js";const is=p=>{let{count:u=0,items:t=[],onDeselectAll:a,onDeselectOne:o,onSelectAll:d,onSelectOne:h,selected:i=[],isLoading:n,isError:D}=p;const c=_(),[m,E]=j.useState(0),[R,f]=j.useState(!1),[A,je]=j.useState(25),{t:g,i18n:fe}=O(),[be,Se]=j.useState({}),[te,oe]=j.useState(!1),[Pe,_e]=j.useState(),[re,Oe]=j.useState(),ie=[{mode:1,text:g(s.global.oui)},{mode:2,text:g(s.global.enCours)},{mode:3,text:g(s.global.echec)}],Ee=[g(s.paiment.espece),g(s.paiment.virment),g(s.paiment.cheque),g(s.paiment.lcn)],[le,$]=j.useState(null),K=!!le,Ae=(l,x)=>{Oe(x),$(l.currentTarget)},Me=()=>{$(null)},ye=(l,x)=>{E(x)},Ue=l=>{je(parseInt(l.target.value,10)),E(0)},Re=l=>{Se(x=>({...x,[l]:!x[l]}))},q=(l,x)=>{const b=t.filter(L=>L.id==l);c(r.actions.setCurrentData(b[0])),x=="update"?c(r.actions.openCloseModalUpdate()):x=="delete"?c(r.actions.openCloseModalDelete()):(c(Le.actions.setCurrentData(b[0])),f(!0))},de=t==null?void 0:t.slice(m*A,m*A+A),Fe=l=>{y.put("/paymentsupplier/payed/",{id:re,mode:l}).then(x=>{c(r.actions.handlePayed({id:re,data:x.data})),$(null)})};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(w,{children:[e.jsx(C,{}),e.jsx(C,{children:g(s.nav.fournisseur)}),e.jsxs(C,{children:[g(s.paiment.amount)," ",g(s.global.mad)]}),e.jsx(C,{children:g(s.entrer.date)}),e.jsx(C,{children:g(s.paiment.typePayment)}),e.jsx(C,{children:g(s.paiment.isPayed)}),e.jsx(C,{})]})}),n?e.jsx(He,{rowsNum:10}):e.jsx(pe,{children:de.length>0?de.map(l=>{const x=be[l.id]||!1;let b=new Date(l.date),L={year:b.getFullYear(),month:`${b.getMonth()+1}`,day:`${b.getDate()}`};const we=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsx(C,{children:l.payment_proof.length!==0&&e.jsx(F,{"aria-label":"expand row",size:"small",onClick:()=>Re(l.id),children:x?e.jsx(ze,{}):e.jsx(Je,{})})}),e.jsxs(C,{children:[l.name," ",l.last_name]}),e.jsx(C,{sx:{direction:fe.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:we.format(l.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(C,{children:[" ",L.day.padStart(2,0),"/",L.month.padStart(2,0),"/",L.year]}),e.jsx(C,{children:Ee[l.mode-1]}),e.jsx(C,{children:e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":K?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":K?"true":void 0,onClick:v=>Ae(v,l.id),color:l.payed==1?"success":l.payed==2?"warning":"error",sx:{"&:disabled":{color:v=>v.palette.success.dark}},disabled:l.mode==1||l.mode==2,children:ie[l.payed-1].text}),e.jsx(Te,{id:"basic-menu",anchorEl:le,open:K,onClose:Me,MenuListProps:{"aria-labelledby":"basic-button"},children:ie.map((v,X)=>e.jsx(S,{onClick:xs=>Fe(v.mode),children:v.text},X))})]})}),e.jsxs(C,{children:[e.jsx(F,{color:"warning",onClick:()=>q(l.id,"update"),children:e.jsx(T,{children:e.jsx(ke,{})})}),e.jsx(F,{color:"error",onClick:()=>q(l.id,"delete"),children:e.jsx(T,{children:e.jsx(Qe,{})})}),l.payment_proof.length!==4&&e.jsx(F,{color:"success",onClick:()=>q(l.id,"upload"),children:e.jsx(T,{children:e.jsx(Ze,{})})})]})]}),e.jsx(w,{children:e.jsx(C,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Ie,{in:x,timeout:"auto",unmountOnExit:!0,children:e.jsx(ce,{sx:{width:"100%"},component:Ge,children:e.jsxs(me,{sx:{width:"100%"},children:[e.jsx(ue,{children:e.jsxs(w,{children:[e.jsx(C,{children:g(s.paiment.fileName)}),e.jsx(C,{})]})}),e.jsx(pe,{children:l.payment_proof.map((v,X)=>e.jsxs(w,{children:[e.jsx(C,{children:v.file.replace("http://192.168.1.97:8000/api".replace("/api","")+"/uploads/","")}),e.jsxs(C,{children:[" ",e.jsx(F,{color:"inherit",onClick:()=>{c(r.actions.openCloseConfirmDeleteProof()),c(r.actions.setCurrentData({id:l.id,idFile:v.id}))},children:e.jsx(T,{children:e.jsx($e,{})})}),e.jsx(F,{color:"secondary",onClick:()=>{_e({file:v.file,extension:v.extension}),oe(!0)},children:e.jsx(T,{children:e.jsx(Ye,{})})})]})]},X))})]})})})})})]})}):e.jsx(w,{children:e.jsx(C,{colSpan:5,sx:{textAlign:"center"},children:g(s.batiment.nothingToDisplay)})})})]})}),e.jsx(Ne,{component:"div",count:u,onPageChange:ye,onRowsPerPageChange:Ue,page:m,rowsPerPage:A,rowsPerPageOptions:[5,10,25],labelRowsPerPage:g(s.batiment.Lignes),labelDisplayedRows:({from:l,to:x,count:b})=>`${l}â€“${x} ${g(s.batiment.sur)} ${b}`}),D&&e.jsx(Xe,{}),R&&e.jsx(qe,{isFournisseur:!0,isModalUpload:R,close:()=>f(!1)}),te&&e.jsx(Ke,{isPreview:te,close:()=>oe(!1),file:Pe})]})};function ls({fournisseur:p}){Z.locale("fr");const{t:u,i18n:t}=O(),a=_(),o=se({initialValues:{date1:null,date2:null,eggsource:""},validationSchema:ae({date1:he().nullable().test("is-before-date2",u(s.global.date2Greather),function(d){const{date2:h}=this.parent;return d<=h}),date2:he().nullable().test("is-after-date1",u(s.global.date2Greather),function(d){const{date1:h}=this.parent;return d>=h})}),onSubmit:async(d,{resetForm:h,setErrors:i})=>{let n="";for(let D in d)if(d[D]!==""&&d[D]!==null){let c=new Date(d[D]),m=c.getFullYear()!==1970?`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`:d[D];n==""?n+=`?${D}=${m}`:n+=`&${D}=${m}`}y.get("/paymentsupplier/list/"+n).then(D=>{a(r.actions.fetchPaimentF(D.data))})},onReset:()=>{y.get("/paymentsupplier/list/").then(d=>{a(r.actions.fetchPaimentF(d.data))})}});return e.jsxs(ss,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(os,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(ns,{}),u(s.global.filter)]})}),e.jsx(ts,{children:e.jsx(ve,{children:e.jsx(es,{children:e.jsx("form",{noValidate:!0,onSubmit:o.handleSubmit,onReset:o.handleReset,children:e.jsxs(M,{container:!0,alignItems:"center",gap:2,children:[e.jsx(M,{item:!0,xs:12,md:5,sm:12,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(N,{id:"batiment-id",children:u(s.fournisseur.title)}),e.jsx(B,{labelId:"batiment-id",id:"demo-simple-select",onBlur:o.handleBlur,fullWidth:!0,name:"eggsource",onChange:o.handleChange,value:o.values.eggsource,label:u(s.fournisseur.title),children:p==null?void 0:p.map(d=>e.jsx(S,{value:d.id,children:d.name}))})]})}),e.jsx(M,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Y,{value:o.values.date1,onChange:d=>o.setFieldValue("date1",d),onBlur:o.handleBlur,label:u(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(o.touched.date1&&o.errors.date1),helperText:o.touched.date1&&o.errors.date1}}})}),e.jsx(M,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Y,{value:o.values.date2,onChange:d=>o.setFieldValue("date2",d),onBlur:o.handleBlur,label:u(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(o.touched.date2&&o.errors.date2),helperText:o.touched.date2&&o.errors.date2}}})}),e.jsxs(M,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(M,{items:!0,children:e.jsx(G,{variant:"contained",type:"reset",children:u(s.global.reset)})}),e.jsx(M,{items:!0,children:e.jsx(G,{type:"submit",variant:"contained",children:u(s.global.filter)})})]})]})})})})})]})}function ds({fournisseur:p}){const{t:u,i18n:t}=O(),a=_(),o=z("paimentsF",J.fetchPaimentFournisseur),{paimentF:d}=U(h=>h.paimentFournisseur);return j.useEffect(()=>{o.status=="success"&&a(r.actions.fetchPaimentF(o.data))},[o.status]),e.jsx(We,{maxWidth:"xl",children:e.jsxs(V,{spacing:4,children:[e.jsxs(V,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(V,{spacing:1,children:e.jsx(Q,{variant:"h4",children:u(s.paimentF.title)})}),e.jsx(V,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(G,{startIcon:e.jsx(T,{children:e.jsx(Ve,{})}),variant:"contained",onClick:()=>a(r.actions.openCloseModalAdd()),children:u(s.global.ajouter)})})]}),e.jsxs(ve,{children:[e.jsx(ls,{fournisseur:p}),e.jsx(is,{items:d,count:d.length,rowsPerPage:25,isLoading:o.isLoading,isError:o.isError})]})]})})}function ne({confirmed:p}){const{currentData:u,isConfirm:t}=U(i=>i.paimentFournisseur),a=_(),{t:o,i18n:d}=O(),h=()=>{p()};return e.jsx(k,{open:t,onClose:()=>a(r.actions.openCloseConfirm()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(rs,{title:o(s.global.confirmOperation),message:o(s.global.confirmMessage),confirmFn:h,cancel:()=>a(r.actions.openCloseConfirm())})})}const cs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ms({fournisseur:p,paimentModes:u}){const t=_(),{t:a,i18n:o}=O(),{isModalAdd:d}=U(c=>c.paimentFournisseur),h=ae({eggsource:I().required(a(s.sortie.fournisseurRequired)),amount:I().required(a(s.paiment.amountRequired)),mode:I().required(a(s.paiment.typePaymentRequired))}),i=se({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:h,onSubmit:async(c,{resetForm:m,setErrors:E})=>{const R={...c};R.date=Z(c.date).format("YYYY-MM-DD"),y.post("/paymentsupplier/add/",R).then(f=>{t(r.actions.addPaimentF(f.data)),t(r.actions.openCloseModalAdd()),t(r.actions.openCloseConfirm()),P.success(a(s.paiment.toastAddSuccess)),m()}).catch(f=>{t(r.actions.openCloseConfirm()),P.error(a(s.global.toastError))})}}),n=async c=>{c.preventDefault();const m=await i.validateForm();Object.keys(m).length===0?t(r.actions.openCloseConfirm()):await i.submitForm()},D=()=>{i.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(k,{open:d,onClose:()=>t(r.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:cs,children:[e.jsxs(ge,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(Q,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>t(r.actions.openCloseModalAdd()),children:e.jsx(De,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:c=>n(c),children:[e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(i.touched.eggsource&&i.errors.eggsource),children:[e.jsx(N,{id:"batiment-id",children:a(s.fournisseur.title)}),e.jsx(B,{labelId:"batiment-id",id:"demo-simple-select",onBlur:i.handleBlur,fullWidth:!0,name:"eggsource",onChange:i.handleChange,value:i.values.eggsource,label:a(s.fournisseur.title),children:p.length>0?p.map(c=>e.jsx(S,{value:c.id,children:c.name})):e.jsx(S,{children:a(s.batiment.nothingToDisplay)})}),i.touched.eggsource&&i.errors.eggsource&&e.jsx(H,{children:i.errors.eggsource})]}),e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(i.touched.mode&&i.errors.mode),children:[e.jsx(N,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx(B,{labelId:"batiment-id",id:"demo-simple-select",onBlur:i.handleBlur,fullWidth:!0,name:"mode",onChange:i.handleChange,value:i.values.mode,label:a(s.paiment.typePayment),children:u.map(c=>e.jsx(S,{value:c.id,children:c.value}))}),i.touched.mode&&i.errors.mode&&e.jsx(H,{children:i.errors.mode})]}),e.jsx(Ce,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:i.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:i.handleChange,value:i.values.amount,error:!!(i.touched.amount&&i.errors.amount),helperText:i.touched.amount&&i.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Y,{label:a(s.entrer.date),value:i.values.date,onChange:c=>i.setFieldValue("date",c),onBlur:i.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(ne,{confirmed:D})]})}const us={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ps({fournisseur:p,paimentModes:u}){const t=_(),{t:a,i18n:o}=O(),{currentData:d,isModalUpdate:h}=U(m=>m.paimentFournisseur),i=ae({eggsource:I().required(a(s.sortie.fournisseurRequired)),amount:I().required(a(s.paiment.amountRequired)),mode:I().required(a(s.paiment.typePaymentRequired))}),n=se({initialValues:{eggsource:"",amount:"",mode:"",date:new Date},validationSchema:i,onSubmit:async(m,{resetForm:E,setErrors:R})=>{const f={...m};f.date=Z(m.date).format("YYYY-MM-DD"),y.put("/paymentsupplier/update/",f).then(A=>{t(r.actions.editPaimentF(A.data)),t(r.actions.openCloseModalUpdate()),t(r.actions.openCloseConfirm()),P.success(a(s.paiment.toastAddSuccess)),E()}).catch(A=>{t(r.actions.openCloseConfirm()),P.error(a(s.global.toastError))})}}),D=async m=>{m.preventDefault();const E=await n.validateForm();Object.keys(E).length===0?t(r.actions.openCloseConfirm()):await n.submitForm()},c=()=>{n.handleSubmit()};return j.useEffect(()=>{let m={...d};m.date=new Date(m.date),n.setValues(m)},[]),e.jsxs(e.Fragment,{children:[e.jsx(k,{open:h,onClose:()=>t(r.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:us,children:[e.jsxs(ge,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(Q,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>t(r.actions.openCloseModalUpdate()),children:e.jsx(De,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:m=>D(m),children:[e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.eggsource&&n.errors.eggsource),children:[e.jsx(N,{id:"batiment-id",children:a(s.fournisseur.title)}),e.jsx(B,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"eggsource",onChange:n.handleChange,value:n.values.eggsource,label:a(s.fournisseur.title),children:p.length>0?p.map(m=>e.jsx(S,{value:m.id,children:m.name})):e.jsx(S,{children:a(s.batiment.nothingToDisplay)})}),n.touched.eggsource&&n.errors.eggsource&&e.jsx(H,{children:n.errors.eggsource})]}),e.jsxs(W,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(n.touched.mode&&n.errors.mode),children:[e.jsx(N,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx(B,{labelId:"batiment-id",id:"demo-simple-select",onBlur:n.handleBlur,fullWidth:!0,name:"mode",onChange:n.handleChange,value:n.values.mode,label:a(s.paiment.typePayment),children:u.map(m=>e.jsx(S,{value:m.id,children:m.value}))}),n.touched.mode&&n.errors.mode&&e.jsx(H,{children:n.errors.mode})]}),e.jsx(Ce,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:n.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:n.handleChange,value:n.values.amount,error:!!(n.touched.amount&&n.errors.amount),helperText:n.touched.amount&&n.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Y,{label:a(s.entrer.date),value:n.values.date,onChange:m=>n.setFieldValue("date",m),onBlur:n.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(ne,{confirmed:c})]})}function hs(){const{currentData:p,isModalDelete:u}=U(h=>h.paimentFournisseur),t=_(),{t:a,i18n:o}=O(),d=()=>{y.delete(`/paymentsupplier/delete/${p.id}`).then(h=>{t(r.actions.deletePaimentF()),t(r.actions.openCloseModalDelete()),P.success(a(s.paiment.toastDeleteSuccess))}).catch(h=>{t(r.actions.openCloseModalDelete()),P.error(a(s.global.toastError))})};return e.jsx(k,{open:u,onClose:()=>t(r.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(xe,{title:a(s.paiment.deleteTitle),message:a(s.paiment.deleteDescription),deleteFn:d,cancel:()=>t(r.actions.openCloseModalDelete())})})}function Cs(){const{currentData:p,isModalDeleteProof:u}=U(h=>h.paimentFournisseur),t=_(),{t:a,i18n:o}=O(),d=()=>{y.delete(`/paymentsupplier/proof/delete/${p.idFile}`).then(h=>{t(r.actions.deletePaimentFProof()),t(r.actions.openCloseConfirmDeleteProof()),P.success(a(s.global.toastSuccessDeleteFile))}).catch(h=>{t(r.actions.openCloseConfirmDeleteProof()),P.error(a(s.global.toastError))})};return e.jsx(k,{open:u,onClose:()=>t(r.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(xe,{title:a(s.paiment.deleteTitleFile),message:a(s.paiment.deleteDescriptionFile),deleteFn:d,cancel:()=>t(r.actions.openCloseConfirmDeleteProof())})})}function gs(){const{isModalAdd:p,isModalUpdate:u,isModalDelete:t}=U(d=>d.paimentFournisseur),a=z("paymentMethod",J.paymentMode),o=z("fournisseur",J.getBatimentSelect);return e.jsxs(e.Fragment,{children:[" ",e.jsx(ee,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(ds,{fournisseur:o.data})}),e.jsx(ne,{}),p&&e.jsx(ms,{fournisseur:o.data,paimentModes:a.data}),u&&e.jsx(ps,{fournisseur:o.data,paimentModes:a.data}),t&&e.jsx(hs,{}),e.jsx(Cs,{})]})}function Ts(){return e.jsx(e.Fragment,{children:e.jsx(Be,{children:e.jsx(gs,{})})})}export{Ts as default};
