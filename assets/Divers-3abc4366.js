import{aa as A,aA as Pe,ae as w,d as M,r as C,j as e,af as $,a4 as Ee,a9 as P,l as s,a as W,h as T,bG as r,a5 as f,au as Ue,T as q,B as Ae,ab as oe,a2 as N,as as Me,k as me,aj as pe,ak as ue,al as he,am as z,F as xe}from"./index-5b79c039.js";import{E as ye,P as we,M as Ce}from"./ModalDelete-04bd8acd.js";import{u as Te,C as ve,T as Re}from"./index-be556e9b.js";import{B as H,e as re,T as ie,a as le,b as G,c as D,d as de,f as Q,G as L,u as De,S as k,h as Fe,E as Ie}from"./moment-864131f4.js";import{C as V,T as Ge}from"./TableRowsLoader-23cb4167.js";import{E as Le}from"./Eye-655a27ed.js";import{A as Ne,T as ke,K as We,a as Be}from"./KeyboardArrowUp-c6409d2a.js";import{A as He}from"./AlertError-96b329d4.js";import{D as Ve}from"./DeleteOutlineOutlined-32598299.js";import{u as ee,c as se,e as ce,C as ge,b as $e,d as fe,a as je}from"./formik.esm-f8b1f355.js";import"./fr-4efeb1d7.js";import{D as X}from"./DatePicker-9add668e.js";import{M as Se}from"./ModalConfirm-575c2085.js";const Ye=l=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",boxShadow:24,p:4,[l.breakpoints.down("md")]:{width:"95%"}}),Ke=["application/pdf","image/jpg","image/jpeg","image/png"];function ze({isModalUpload:l,close:o,isFournisseur:t}){var Y;const n=A(),m=Pe(),{currentData:i}=w(x=>x.divers),{t:c,i18n:d}=M(),[a,g]=C.useState([]),[u,p]=C.useState(4-((Y=i==null?void 0:i.expenses_proof)==null?void 0:Y.length)-a.length),[j,S]=C.useState(!1),{acceptedFiles:b,getRootProps:R,getInputProps:te}=Te({onDrop:(x,v)=>{var _;if(v.length>0){if(v[0].errors[0].code=="too-many-files"){f.error(c(s.paiment.uploadLimitFile)+` ${4-((_=i==null?void 0:i.expenses_proof)==null?void 0:_.length)}`);return}else if(v[0].errors[0].code=="file-invalid-type"){f.error(c(s.paiment.fileSupported));return}f.error(v[0].errors[0].message)}g(F=>[...F,...x])},multiple:!0,maxFiles:u,validator:J,accept:{"application/pdf":[],"image/jpeg":[],"image/jpg":[],"image/png":[]}}),E=()=>{S(!0);const x=new FormData;x.append("id",i.id),a.map(v=>{x.append("files",v)}),T.post("/otherexpenses/proof/add/",x).then(v=>{n(r.actions.addProofDivers(v.data)),f.success(c(s.paiment.toastUploadFile)),S(!1),o(),g([])})},ne=x=>{const v=a.findIndex(F=>F.path==x),_=a.filter((F,U)=>U!==v);g(_)};function J(x){var _;if(!Ke.includes(x.type))return{code:"extension-supported",message:c(s.paiment.fileSupported)};const v=5*1024*1024;return x.size>v?{code:"max-size",message:c(s.paiment.uploadMaxSize)}:u<=0?{code:"max-file",message:`${c(s.paiment.uploadLimitFile)} ${4-((_=i==null?void 0:i.expenses_proof)==null?void 0:_.length)}`}:null}return C.useEffect(()=>{var x;a.length>0&&p(4-((x=i==null?void 0:i.expenses_proof)==null?void 0:x.length)-a.length)},[a.length]),e.jsx(e.Fragment,{children:e.jsx($,{open:l,onClose:o,children:e.jsxs(H,{sx:Ye(m),children:[j&&e.jsx(Ee,{}),e.jsx(H,{sx:{position:"absolute",right:0,top:0},children:e.jsx(P,{onClick:o,children:e.jsx(V,{})})}),e.jsx("h3",{className:"text-center font-semibold text-lg",children:c(s.paiment.uploadTitle)}),e.jsxs("div",{className:"flex flex-col items-center my-4 border-2 border-dashed border-purple-500 p-4",...R(),children:[e.jsx("input",{...te()}),e.jsx(ve,{color:"primary",fontSize:"large"}),e.jsx("p",{children:c(s.paiment.uploadTitle)}),e.jsxs("p",{children:[c(s.paiment.uploadMessage)," PNG, JPG, JPEG, PDF"]})]}),e.jsx("div",{children:a.map((x,v)=>e.jsxs("p",{children:[x.path," ",e.jsx(P,{onClick:()=>ne(x.path),children:e.jsx(V,{color:"error"})})]},v))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{onClick:E,variant:"contained",color:"primary",children:c(s.paiment.upload)})})]})})})}function Xe({close:l,isPreview:o,file:t}){const[n,m]=C.useState(null);return C.useEffect(()=>(console.log(t),(async()=>{try{console.log(t.file);const c=await T.get(t.file,{responseType:"blob"}),d=URL.createObjectURL(c.data);console.log(d),m(d)}catch(c){console.error("Error fetching PDF:",c)}})(),()=>{n&&URL.revokeObjectURL(n)}),[]),e.jsxs(Ue,{fullScreen:!0,open:o,children:[e.jsx(Ne,{sx:{position:"relative"},children:e.jsxs(ke,{children:[e.jsx(P,{edge:"start",color:"inherit","aria-label":"close",onClick:()=>l(),children:e.jsx(V,{})}),e.jsx(q,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Preview File"})]})}),e.jsx("iframe",{src:n,height:"100%"})]})}const qe=C.memo(l=>{const o=A();let{count:t=0,items:n=[],onDeselectAll:m,onDeselectOne:i,onSelectAll:c,onSelectOne:d,selected:a=[],isLoading:g,isError:u}=l;const[p,j]=C.useState(1),[S,b]=C.useState(!1),[R,te]=C.useState(25),{t:E,i18n:ne}=M(),[J,Y]=C.useState({}),[x,v]=C.useState(!1),[_,F]=C.useState();C.useState(null);const U=C.useRef(null),be=h=>{Y(O=>({...O,[h]:!O[h]}))},Z=(h,O)=>{const y=n.filter(B=>B.id==h);o(r.actions.setCurrentData(y[0])),O=="update"?o(r.actions.openCloseModalUpdate()):O=="delete"?o(r.actions.openCloseModalDelete()):b(!0)},ae=()=>{const h=U.current;h&&h.scrollHeight===h.scrollTop+h.clientHeight&&!g&&j(y=>y+1)};C.useEffect(()=>(U.current&&U.current.addEventListener("scroll",ae),()=>{U.current&&U.current.removeEventListener("scroll",ae)}),[g]);const I=n==null?void 0:n.slice(0,p*R);return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{sx:{position:"relative"},children:[e.jsx(re,{component:oe,sx:{maxHeight:"60vh"},ref:U,children:e.jsxs(ie,{sx:{minWidth:700},children:[e.jsx(le,{children:e.jsxs(G,{children:[e.jsx(D,{align:"left"}),e.jsxs(D,{children:[E(s.paiment.amount)," ",E(s.global.mad)]}),e.jsx(D,{children:E(s.entrer.date)}),e.jsx(D,{children:E(s.depense.addlabel)}),e.jsx(D,{})]})}),g?e.jsx(Ge,{rowsNum:10}):e.jsx(de,{children:(I==null?void 0:I.length)>0?I==null?void 0:I.map(h=>{const O=J[h.id]||!1;let y=new Date(h.date),B={year:y.getFullYear(),month:`${y.getMonth()+1}`,day:`${y.getDate()}`};const _e=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(G,{hover:!0,children:[e.jsx(D,{sx:{width:"5%"},children:h.expenses_proof.length!==0&&e.jsx(P,{"aria-label":"expand row",size:"small",onClick:()=>be(h.id),children:O?e.jsx(We,{}):e.jsx(Be,{})})}),e.jsx(D,{sx:{direction:"initial",whiteSpace:"nowrap"},children:_e.format(h.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(D,{children:[" ",B.day.padStart(2,0),"/",B.month.padStart(2,0),"/",B.year]}),e.jsx(D,{children:h.type_name}),e.jsxs(D,{children:[e.jsx(P,{color:"warning",onClick:()=>Z(h.id,"update"),children:e.jsx(N,{children:e.jsx(ye,{})})}),e.jsx(P,{color:"error",onClick:()=>Z(h.id,"delete"),children:e.jsx(N,{children:e.jsx(Ve,{})})}),h.expenses_proof.length!==4&&e.jsx(P,{color:"success",onClick:()=>Z(h.id,"upload"),children:e.jsx(N,{children:e.jsx(ve,{})})})]})]},h.id),e.jsx(G,{children:e.jsx(D,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Me,{in:O,timeout:"auto",unmountOnExit:!0,children:e.jsx(re,{sx:{width:"100%"},component:oe,children:e.jsxs(ie,{sx:{width:"100%"},children:[e.jsx(le,{children:e.jsxs(G,{children:[e.jsx(D,{children:E(s.paiment.fileName)}),e.jsx(D,{})]})}),e.jsx(de,{children:h.expenses_proof.map((K,Oe)=>e.jsxs(G,{children:[e.jsx(D,{children:K.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(D,{children:[" ",e.jsx(P,{color:"inherit",onClick:()=>{o(r.actions.openCloseConfirmDeleteProof()),o(r.actions.setCurrentData({id:h.id,idFile:K.id}))},children:e.jsx(N,{children:e.jsx(Re,{})})}),e.jsx(P,{color:"secondary",onClick:()=>{F({file:K.file,extension:K.extension}),v(!0)},children:e.jsx(N,{children:e.jsx(Le,{})})})]})]},Oe))})]})})})})})]})}):e.jsx(G,{children:e.jsx(D,{colSpan:5,sx:{textAlign:"center"},children:E(s.batiment.nothingToDisplay)})})})]})}),u&&e.jsx(He,{})]}),S&&e.jsx(ze,{isModalUpload:S,close:()=>b(!1)}),x&&e.jsx(Xe,{isPreview:x,close:()=>v(!1),file:_})]})});function Je(){Q.locale("fr");const{t:l,i18n:o}=M(),t=A(),n=ee({initialValues:{date1:null,date2:null,client:""},validationSchema:se({date1:ce().nullable().test("is-before-date2",l(s.global.date2Greather),function(m){const{date2:i}=this.parent;return m<=i}),date2:ce().nullable().test("is-after-date1",l(s.global.date2Greather),function(m){const{date1:i}=this.parent;return m>=i})}),onSubmit:async(m,{resetForm:i,setErrors:c})=>{let d="";for(let a in m)if(m[a]!==""&&m[a]!==null){let g=new Date(m[a]),u=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`;d==""?d+=`?${a}=${u}`:d+=`&${a}=${u}`}t(r.actions.setLink(d))},onReset:()=>{t(r.actions.setLink(""))}});return e.jsx(ge,{children:e.jsx($e,{children:e.jsx("form",{noValidate:!0,onSubmit:n.handleSubmit,onReset:n.handleReset,children:e.jsxs(L,{container:!0,alignItems:"center",gap:2,children:[e.jsx(L,{item:!0,xs:12,md:4,children:e.jsx(X,{value:n.values.date1,onChange:m=>n.setFieldValue("date1",m),onBlur:n.handleBlur,label:l(s.global.date1),name:"date",size:"small",slotProps:{textField:{size:"small",variant:"outlined",error:!!(n.touched.date1&&n.errors.date1),helperText:n.touched.date1&&n.errors.date1}},sx:{width:"100%"}})}),e.jsx(L,{item:!0,xs:12,md:4,children:e.jsx(X,{value:n.values.date2,onChange:m=>n.setFieldValue("date2",m),onBlur:n.handleBlur,label:l(s.global.date2),name:"date",slotProps:{textField:{size:"small",variant:"outlined",error:!!(n.touched.date2&&n.errors.date2),helperText:n.touched.date2&&n.errors.date2}},sx:{width:"100%"}})}),e.jsxs(L,{item:!0,container:!0,xs:12,md:3,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(L,{items:!0,children:e.jsx(W,{variant:"contained",type:"reset",children:l(s.global.reset)})}),e.jsx(L,{items:!0,children:e.jsx(W,{type:"submit",variant:"contained",children:l(s.global.filter)})})]})]})})})})}function Ze(){const l=A(),{t:o,i18n:t}=M(),{divers:n,link:m}=w(c=>c.divers),i=De(["divers",m],()=>Fe.fetchDivers(m));return C.useEffect(()=>{i.status=="success"&&l(r.actions.fetchDivers(i.data))},[i.status,m]),e.jsxs(k,{spacing:4,children:[e.jsxs(k,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(k,{spacing:1,children:e.jsx(q,{variant:"h4",children:o(s.divers.title)})}),e.jsx(k,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(W,{startIcon:e.jsx(N,{children:e.jsx(we,{})}),variant:"contained",onClick:()=>l(r.actions.openCloseModalAdd()),children:o(s.global.ajouter)})})]}),e.jsxs(ge,{children:[e.jsx(Je,{}),e.jsx(qe,{items:n,count:n.length,rowsPerPage:25,isLoading:i.isLoading,isError:i.isError})]})]})}const Qe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function es({typeDepense:l}){const o=A(),{t,i18n:n}=M(),{currentData:m,isModalUpdate:i,isConfirm:c}=w(p=>p.divers),d=se({amount:fe().required(t(s.paiment.amountRequired)),type:je().required()}),a=ee({initialValues:{amount:0,type:"",date:new Date},validationSchema:d,onSubmit:async(p,{resetForm:j,setErrors:S})=>{const b={...p};b.date=Q(p.date).format("YYYY-MM-DD"),T.put("/otherexpenses/update/",b).then(R=>{o(r.actions.editDivers(R.data)),o(r.actions.openCloseModalUpdate()),o(r.actions.openCloseConfirm()),f.success(t(s.divers.toastUpdateSuccess)),j()}).catch(R=>{o(r.actions.openCloseConfirm()),f.error(t(s.global.toastError))})}}),g=async p=>{p.preventDefault();const j=await a.validateForm();console.log(j),Object.keys(j).length===0?o(r.actions.openCloseConfirm()):await a.submitForm()},u=()=>{a.handleSubmit()};return C.useEffect(()=>{const p={...m};p.date=new Date(p.date),a.setValues(p)},[]),e.jsxs(e.Fragment,{children:[e.jsx($,{open:i,onClose:()=>o(r.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(H,{sx:Qe,children:[e.jsxs(k,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(q,{id:"modal-modal-title",variant:"h6",component:"h2",children:t(s.divers.updateTitle)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(r.actions.openCloseModalUpdate()),children:e.jsx(V,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:p=>g(p),children:[e.jsx(me,{id:"outlined-basic",label:t(s.paiment.amount),variant:"outlined",onBlur:a.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:a.handleChange,value:a.values.amount,error:!!(a.touched.amount&&a.errors.amount),helperText:a.touched.amount&&a.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(pe,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(a.touched.type&&a.errors.type),children:[e.jsx(ue,{id:"batiment-id",children:t(s.depense.addlabel)}),e.jsx(he,{labelId:"batiment-id",id:"demo-simple-select",onBlur:a.handleBlur,fullWidth:!0,name:"type",onChange:a.handleChange,value:a.values.type,label:t(s.depense.addlabel),children:l.length>0?l.map(p=>e.jsx(z,{value:p.id,children:p.type})):e.jsx(z,{children:t(s.batiment.nothingToDisplay)})}),a.touched.type&&a.errors.type&&e.jsx(xe,{children:a.errors.type})]}),e.jsx(X,{label:t(s.entrer.date),value:a.values.date,onChange:p=>a.setFieldValue("date",p),onBlur:a.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(W,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:t(s.global.modifier)})]})]})}),e.jsx(Se,{confirmed:u,cancel:()=>o(r.actions.openCloseConfirm()),isConfirm:c})]})}const ss={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ts({typeDepense:l}){const o=A(),{t,i18n:n}=M(),{isModalAdd:m,isConfirm:i}=w(u=>u.divers),c=se({amount:fe().required(t(s.paiment.amountRequired)),type:je().required()}),d=ee({initialValues:{amount:0,type:"",date:new Date},validationSchema:c,onSubmit:async(u,{resetForm:p,setErrors:j})=>{const S={...u};S.date=Q(u.date).format("YYYY-MM-DD"),T.post("/otherexpenses/add/",S).then(b=>{o(r.actions.addDivers(b.data)),o(r.actions.openCloseModalAdd()),o(r.actions.openCloseConfirm()),f.success(t(s.divers.toastAddSuccess)),p()}).catch(b=>{o(r.actions.openCloseConfirm()),f.error(t(s.global.toastError))})}}),a=async u=>{u.preventDefault();const p=await d.validateForm();console.log(p),Object.keys(p).length===0?o(r.actions.openCloseConfirm()):await d.submitForm()},g=()=>{d.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx($,{open:m,onClose:()=>o(r.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(H,{sx:ss,children:[e.jsxs(k,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(q,{id:"modal-modal-title",variant:"h6",component:"h2",children:t(s.divers.addTitle)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(r.actions.openCloseModalAdd()),children:e.jsx(V,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:u=>a(u),children:[e.jsx(me,{id:"outlined-basic",label:t(s.paiment.amount),variant:"outlined",onBlur:d.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:d.handleChange,value:d.values.amount,error:!!(d.touched.amount&&d.errors.amount),helperText:d.touched.amount&&d.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(pe,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(d.touched.type&&d.errors.type),children:[e.jsx(ue,{id:"batiment-id",children:t(s.depense.addlabel)}),e.jsx(he,{labelId:"batiment-id",id:"demo-simple-select",onBlur:d.handleBlur,fullWidth:!0,name:"type",onChange:d.handleChange,value:d.values.type,label:t(s.depense.addlabel),children:l.length>0?l.map(u=>e.jsx(z,{value:u.id,children:u.type})):e.jsx(z,{children:t(s.batiment.nothingToDisplay)})}),d.touched.type&&d.errors.type&&e.jsx(xe,{children:d.errors.type})]}),e.jsx(X,{label:t(s.entrer.date),value:d.values.date,onChange:u=>d.setFieldValue("date",u),onBlur:d.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(W,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:t(s.global.ajouter)})]})]})}),e.jsx(Se,{confirmed:g,cancel:()=>o(r.actions.openCloseConfirm()),isConfirm:i})]})}function ns(){const{currentData:l,isModalDelete:o}=w(c=>c.divers),t=A(),{t:n,i18n:m}=M(),i=()=>{T.delete(`/otherexpenses/delete/${l.id}`).then(c=>{t(r.actions.deleteDivers()),t(r.actions.openCloseModalDelete()),f.success(n(s.divers.toastDeleteSuccess))}).catch(c=>{t(r.actions.openCloseModalDelete()),f.error(n(s.global.toastError))})};return e.jsx($,{open:o,onClose:()=>t(r.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Ce,{title:n(s.divers.deletetitle),message:n(s.divers.deletemessage),deleteFn:i,cancel:()=>t(r.actions.openCloseModalDelete())})})}function as(){const{currentData:l,isModalDeleteProof:o}=w(c=>c.divers),t=A(),{t:n,i18n:m}=M(),i=()=>{T.delete(`/otherexpenses/proof/delete/${l.idFile}`).then(c=>{t(r.actions.deleteDiversProof()),t(r.actions.openCloseConfirmDeleteProof()),f.success(n(s.global.toastSuccessDeleteFile))}).catch(c=>{console.log(c),t(r.actions.openCloseConfirmDeleteProof()),f.error(n(s.global.toastError))})};return e.jsx($,{open:o,onClose:()=>t(r.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Ce,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:i,cancel:()=>t(r.actions.openCloseConfirmDeleteProof())})})}const os=async()=>{try{const{data:l}=await T.get("/otherexpensestype/list/");return l}catch(l){throw new Error(l)}};function rs(){const{isModalAdd:l,isModalUpdate:o}=w(n=>n.divers),t=De("typeDepenseDivers",os);return e.jsxs(H,{component:"main",sx:{flexGrow:1,p:3},children:[e.jsx(Ie,{children:e.jsx(Ze,{})}),l&&e.jsx(ts,{typeDepense:t.data}),o&&e.jsx(es,{typeDepense:t.data}),e.jsx(ns,{}),e.jsx(as,{})]})}function fs(){return e.jsx(e.Fragment,{children:e.jsx(rs,{})})}export{fs as default};
