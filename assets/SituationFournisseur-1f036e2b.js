import{d as w,a2 as T,r as j,a6 as $,l as a,j as e,an as R,b2 as p,a1 as S,a as k,a3 as V,$ as N,T as B,V as A,bw as W,X as H}from"./index-5da57776.js";import{G as y,B as P,e as q,T as z,a as O,b as D,c as l,d as Q,S as F,u as M,E as G,h as _}from"./moment-60dfa4f6.js";import{E as U}from"./Eye-20102d8d.js";import{C as X,T as Y}from"./TableRowsLoader-2200d224.js";import{u as J,c as K,e as L,C as I,b as Z}from"./formik.esm-ec72eb0c.js";import{F as ee}from"./FilePreview-2f1e1ec7.js";import{C as te}from"./CardHeader-6426d2db.js";import{C as ae}from"./CardActions-04248a3c.js";import{D as E}from"./DatePicker-598a5ad6.js";import{A as se}from"./AlertError-dc33b758.js";import{T as ie}from"./TextSnippet-87faa052.js";import{M as ne}from"./ModalDetails-7aa93f73.js";import{C as re}from"./Container-45fc29ac.js";import"./KeyboardArrowUp-7956d9eb.js";import"./fr-f51f55a1.js";import"./ExpandMore-5c6293d0.js";import"./Tabs-d5cb80ae.js";function oe({id:u}){const{t:o,i18n:f}=w(),d=T(),[n,h]=j.useState(!1),[r,g]=j.useState(""),{isModalDisplayDoc:b}=$(i=>i.situationFournisseur),s=J({initialValues:{date1:null,date2:null},validationSchema:K({date1:L().nullable().test("is-before-date2",o(a.global.date2Greather),function(i){const{date2:x}=this.parent;return i<=x}),date2:L().nullable().test("is-after-date1",o(a.global.date2Greather),function(i){const{date1:x}=this.parent;return i>=x})}),onSubmit:async(i,{resetForm:x,setErrors:t})=>{let c="";for(let m in i)if(i[m]!==""&&i[m]!==null){let C=new Date(i[m]),v=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;c==""?c+=`?${m}=${v}`:c+=`&${m}=${v}`}g(`/suppliersituation/report/${u}/${c}`),h(!0)}});return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:b,onClose:()=>d(p.actions.openCloseModalDoc()),children:e.jsxs(I,{children:[e.jsx(te,{title:o(a.situationCliente.docTitle),sx:{borderBottom:i=>`0.5px solid ${i.palette.mode=="dark"?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,padding:2},action:e.jsx(S,{onClick:()=>d(p.actions.openCloseModalDoc()),children:e.jsx(X,{})})}),e.jsxs("form",{onSubmit:s.handleSubmit,children:[e.jsx(Z,{children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date1,onChange:i=>s.setFieldValue("date1",i),onBlur:s.handleBlur,label:o(a.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date1&&s.errors.date1),helperText:s.touched.date1&&s.errors.date1}}})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date2,onChange:i=>s.setFieldValue("date2",i),onBlur:s.handleBlur,label:o(a.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date2&&s.errors.date2),helperText:s.touched.date2&&s.errors.date2}}})})]})}),e.jsxs(ae,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(k,{variant:"outlined",color:"error",onClick:()=>d(p.actions.openCloseModalDoc()),children:o(a.client.deleteCancel)}),e.jsx(k,{variant:"contained",type:"submit",children:o(a.situationCliente.afficher)})]})]})]})}),n&&e.jsx(ee,{close:()=>h(!1),isPreview:n,file:{file:r}})]})}function le({isLoading:u,setData:o,setLink:f,isError:d}){const{t:n,i18n:h}=w(),{situationFournisseur:r}=$(t=>t.situationFournisseur),g=T(),[b,s]=j.useState(),i=t=>{console.log(t),o(t),g(p.actions.setCurrentData(t))},x=t=>{s(t),g(p.actions.openCloseModalDoc())};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(I,{children:e.jsx(q,{component:V,children:e.jsxs(z,{children:[e.jsx(O,{children:e.jsxs(D,{children:[e.jsx(l,{children:n(a.fournisseur.title)}),e.jsxs(l,{children:[n(a.situationFournisseur.totalEntrees)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.totalPaiment)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.paymentProgress)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.paymentEchec)," ",n(a.global.mad)]}),e.jsxs(l,{children:[n(a.situationCliente.debt)," ",n(a.global.mad)]}),e.jsx(l,{})]})}),u?e.jsx(Y,{rowsNum:10}):e.jsx(Q,{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map(t=>{const c=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(l,{children:e.jsxs(F,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(N,{sx:{bgcolor:"rgb(19, 194, 194)",color:"white",width:45,height:45},children:t.first_name[0]+" "+t.last_name[0]}),e.jsxs("div",{children:[t.first_name+" "+t.last_name,e.jsx(B,{color:"text.secondary",variant:"body2",children:t.email})]})]})}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:c.format(t.sum_inbound_price).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{style:{fontWeight:"bold"},sx:{direction:"initial",whiteSpace:"nowrap"},children:c.format(t.sum_payment_payed).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{sx:{color:m=>m.palette.warning.main,fontWeight:"600",direction:"initial",whiteSpace:"nowrap",whiteSpace:"nowrap"},children:c.format(t.sum_payment_in_progress).replaceAll(","," ").replace("MAD","")}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:t.sum_payment_invalid>0?"red":"green"},children:c.format(t.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(l,{sx:{direction:"initial",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:t.solde>=0?"green":"red"},children:c.format(t.solde).replaceAll(","," ").replace("MAD","")})}),e.jsxs(l,{children:[e.jsx(S,{color:"info",onClick:()=>i(t.eggsource),children:e.jsx(A,{children:e.jsx(U,{})})}),e.jsx(W,{title:"Telecharger document du situation fournisseur",children:e.jsx(S,{color:"primary",onClick:()=>x(t.eggsource),children:e.jsx(A,{children:e.jsx(ie,{})})})})]})]})})}):e.jsx(D,{children:e.jsx(l,{colSpan:5,sx:{textAlign:"center"},children:n(a.magazin.nothingToDisplay)})})})]})})}),d&&e.jsx(se,{})]}),e.jsx(oe,{id:b})]})}function ce(){const u=T(),[o,f]=j.useState(),[d,n]=j.useState(""),h=M("clients",_.getClientFournisseur),r=M(["client",o,d],()=>_.getFournisseurSituationDetails(o,d)),[g,b]=j.useState(),{t:s,i18n:i}=w(),x=c=>{f(c)},t=c=>n(c);return j.useEffect(()=>{!h.isLoading&&r.data==0&&u(p.actions.fetchSituationFournisseur(h.data)),r.status=="success"&&r.data!==0&&o!==""&&(u(p.actions.setFournisseurSituationForOneFournisseur({id:o})),u(p.actions.fetchFournisseurSituationDetails({data:r.data})),f(void 0))},[h.isLoading,r.isLoading,o,d]),e.jsx(e.Fragment,{children:e.jsxs(G,{children:[r.isLoading&&e.jsx(H,{}),e.jsx(P,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(re,{maxWidth:"xl",children:e.jsxs(F,{spacing:4,children:[e.jsx(F,{spacing:1,children:e.jsx(B,{variant:"h4",children:s(a.situationFournisseur.title)})}),e.jsx(le,{isLoading:h.isLoading,isError:h.isError,details:g,setData:x,setLink:t,isLoadingDetails:r.isLoading})]})})}),e.jsx(ne,{})]})})}function ve(){return e.jsx(e.Fragment,{children:e.jsx(G,{children:e.jsx(ce,{})})})}export{ve as default};
