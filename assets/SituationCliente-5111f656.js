import{d as S,a2 as w,r as m,a6 as E,l as s,j as e,b3 as R,b4 as p,a1 as _,a as F,a3 as V,a4 as W,$ as z,T as L,V as M,bC as N,X as H,S as O}from"./index-28be1d4d.js";import{G as D,B as P,e as q,T as Q,a as U,b as y,c as o,d as X,S as v,u as k,E as I,h as A}from"./moment-3f0f7cd7.js";import{E as Y}from"./Eye-23aad4cf.js";import{C as J,T as K}from"./TableRowsLoader-dad3b961.js";import{u as Z,c as ee,e as $,C as G,b as te}from"./formik.esm-afb92aee.js";import{F as ae}from"./FilePreview-3d1f96d6.js";import{C as se}from"./CardHeader-9693badb.js";import{C as ie}from"./CardActions-678cf1dc.js";import{D as B}from"./DatePicker-9ed1f95c.js";import{A as ne}from"./AlertError-c75603c1.js";import{T as re}from"./TextSnippet-b2170d8f.js";import{M as oe}from"./ModalDetails-093c89f5.js";import{C as le}from"./Container-55cf76ab.js";import"./KeyboardArrowUp-95289860.js";import"./fr-7f09f739.js";import"./ExpandMore-d20dac84.js";import"./Tabs-605999c5.js";function de({id:h}){const{t:r,i18n:C}=S(),u=w(),[j,a]=m.useState(!1),[l,c]=m.useState(""),{isModalDisplayDoc:g}=E(i=>i.situationClient),n=Z({initialValues:{date1:null,date2:null},validationSchema:ee({date1:$().nullable().test("is-before-date2",r(s.global.date2Greather),function(i){const{date2:x}=this.parent;return i<=x}),date2:$().nullable().test("is-after-date1",r(s.global.date2Greather),function(i){const{date1:x}=this.parent;return i>=x})}),onSubmit:async(i,{resetForm:x,setErrors:b})=>{console.log(i);let t="";for(let d in i)if(i[d]!==""&&i[d]!==null){let f=new Date(i[d]),T=`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}-${String(f.getDate()).padStart(2,"0")}`;t==""?t+=`?${d}=${T}`:t+=`&${d}=${T}`}c(`/clientsituation/report/${h}/${t}`),a(!0)}});return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:g,onClose:()=>u(p.actions.openCloseModalDoc()),children:e.jsxs(G,{children:[e.jsx(se,{title:r(s.situationCliente.docTitle),sx:{borderBottom:i=>`0.5px solid ${i.palette.mode=="dark"?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,padding:2},action:e.jsx(_,{onClick:()=>u(p.actions.openCloseModalDoc()),children:e.jsx(J,{})})}),e.jsxs("form",{onSubmit:n.handleSubmit,children:[e.jsx(te,{children:e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(B,{value:n.values.date1,onChange:i=>n.setFieldValue("date1",i),onBlur:n.handleBlur,label:r(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(n.touched.date1&&n.errors.date1),helperText:n.touched.date1&&n.errors.date1}}})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(B,{value:n.values.date2,onChange:i=>n.setFieldValue("date2",i),onBlur:n.handleBlur,label:r(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(n.touched.date2&&n.errors.date2),helperText:n.touched.date2&&n.errors.date2}}})})]})}),e.jsxs(ie,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(F,{variant:"outlined",color:"error",onClick:()=>u(p.actions.openCloseModalDoc()),children:r(s.client.deleteCancel)}),e.jsx(F,{variant:"contained",type:"submit",children:r(s.situationCliente.afficher)})]})]})]})}),j&&e.jsx(ae,{close:()=>a(!1),isPreview:j,file:{file:l}})]})}function ce({isLoading:h,setData:r,setLink:C,isLoadingDetails:u,isError:j}){const{t:a,i18n:l}=S(),{situationCLient:c}=E(t=>t.situationClient),g=w(),[n,i]=m.useState(),x=t=>{r(t),g(p.actions.setCurrentData(t))},b=t=>{i(t),g(p.actions.openCloseModalDoc())};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(G,{children:e.jsx(q,{component:V,children:e.jsxs(Q,{children:[e.jsx(U,{children:e.jsxs(y,{children:[e.jsx(o,{children:a(s.client.title)}),e.jsxs(o,{children:[a(s.situationCliente.totalSortie)," ",a(s.global.mad)]}),e.jsxs(o,{children:[a(s.situationCliente.totalPaiment)," ",a(s.global.mad)]}),e.jsxs(o,{children:[a(s.situationCliente.paymentProgress)," ",a(s.global.mad)]}),e.jsxs(o,{children:[a(s.situationCliente.paymentEchec)," ",a(s.global.mad)]}),e.jsxs(o,{children:[a(s.situationCliente.debt)," ",a(s.global.mad)]}),e.jsx(o,{})]})}),h?e.jsx(K,{rowsNum:10}):e.jsx(X,{children:(c==null?void 0:c.length)>0?c==null?void 0:c.map(t=>{const d=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsx(e.Fragment,{children:e.jsxs(y,{children:[e.jsx(o,{children:e.jsxs(v,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(W,{variant:"dot",color:t.is_active?"success":"error",anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",badgeContent:" ",sx:{"& .MuiBadge-badge":{minWidth:"14px",height:"14px",fontSize:"0.75rem",borderRadius:"100%",border:"2px solid #fff"}},children:e.jsx(z,{sx:{bgcolor:t.is_active?"rgb(19, 194, 194)":"",color:"white",width:45,height:45},children:(t==null?void 0:t.client_f_n[0])+" "+(t==null?void 0:t.client_l_n[0])})}),e.jsxs("div",{children:[t.client_f_n+" "+t.client_l_n,e.jsx(L,{color:"text.secondary",variant:"body2",children:t.client_email})]})]})}),e.jsx(o,{sx:{direction:l.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:d.format(t.sum_outbound_price).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{sx:{direction:l.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},style:{fontWeight:"bold"},children:d.format(t.sum_payment_cashed_in).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{sx:{color:f=>f.palette.warning.main,fontWeight:"600",direction:l.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap",whiteSpace:"nowrap"},children:d.format(t.sum_payment_in_progress).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{sx:{direction:l.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:t.sum_payment_invalid>0?"red":"green"},children:d.format(t.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(o,{sx:{direction:l.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:t.final_confirmed_sold>=0?"green":"red"},children:d.format(t.final_confirmed_sold).replaceAll(","," ").replace("MAD","")})}),e.jsxs(o,{children:[e.jsx(_,{color:"info",onClick:()=>x(t.client),children:e.jsx(M,{children:e.jsx(Y,{})})}),e.jsx(N,{title:"Telecharger document du situation client",children:e.jsx(_,{color:"primary",onClick:()=>b(t.client),children:e.jsx(M,{children:e.jsx(re,{})})})})]})]})})}):e.jsx(y,{children:e.jsx(o,{colSpan:5,sx:{textAlign:"center"},children:a(s.magazin.nothingToDisplay)})})})]})})}),j&&e.jsx(ne,{})]}),e.jsx(de,{id:n})]})}function he(){const h=w(),[r,C]=m.useState(),[u,j]=m.useState(""),a=k("clients",A.getClientSituation),l=k(["client",r,u],()=>A.getClientSituationDetails(r,u)),[c,g]=m.useState(),{t:n,i18n:i}=S(),x=t=>{C(t)},b=t=>j(t);return m.useEffect(()=>{!a.isLoading&&l.data==0&&h(p.actions.fetchSituationCLient(a.data)),l.status=="success"&&l.data!==0&&r!==""&&(h(p.actions.setClientSituationForOneClient({id:r})),h(p.actions.fetchClientSituationDetails({data:l.data})),C(void 0))},[a.isLoading,l.isLoading,r,u]),e.jsx(e.Fragment,{children:e.jsxs(I,{children:[l.isLoading&&e.jsx(H,{}),e.jsx(P,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(le,{maxWidth:"xl",children:e.jsxs(v,{spacing:4,children:[e.jsx(v,{spacing:1,children:e.jsx(L,{variant:"h4",children:n(s.situationCliente.title)})}),e.jsx(ce,{isLoading:a.isLoading,isError:a.isError,details:c,setData:x,setLink:b})]})})}),e.jsx(oe,{})]})})}function Me(){const{t:h,i18n:r}=S();return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:`ESM | ${h(s.nav.situationCliente)}`}),e.jsx(I,{children:e.jsx(he,{})})]})}export{Me as default};
