import{d as w,a2 as T,r as j,a6 as $,l as a,j as e,b3 as R,b8 as x,a1 as S,a as k,a3 as V,$ as N,T as B,V as A,bC as W,X as H}from"./index-5221874e.js";import{G as y,B as P,e as q,T as z,a as O,b as D,c as o,d as Q,S as F,u as M,E as G,h as _}from"./moment-95a9c38c.js";import{E as U}from"./Eye-d8af3996.js";import{C as X,T as Y}from"./TableRowsLoader-ee514eef.js";import{u as J,c as K,e as L,C as I,b as Z}from"./formik.esm-288cd6c1.js";import{F as ee}from"./FilePreview-5792ef2a.js";import{C as te}from"./CardHeader-2cc936da.js";import{C as ae}from"./CardActions-000f437c.js";import{D as E}from"./DatePicker-97870438.js";import{A as se}from"./AlertError-c792a5f9.js";import{T as ne}from"./TextSnippet-14af607d.js";import{M as re}from"./ModalDetails-11b57ce2.js";import{C as ie}from"./Container-85c02ec2.js";import"./KeyboardArrowUp-8e02e11b.js";import"./fr-5577b27f.js";import"./ExpandMore-c9ce65e8.js";import"./Tabs-8d8e92c9.js";function le({id:p}){const{t:l,i18n:b}=w(),h=T(),[r,c]=j.useState(!1),[i,g]=j.useState(""),{isModalDisplayDoc:f}=$(n=>n.situationFournisseur),s=J({initialValues:{date1:null,date2:null},validationSchema:K({date1:L().nullable().test("is-before-date2",l(a.global.date2Greather),function(n){const{date2:u}=this.parent;return n<=u}),date2:L().nullable().test("is-after-date1",l(a.global.date2Greather),function(n){const{date1:u}=this.parent;return n>=u})}),onSubmit:async(n,{resetForm:u,setErrors:t})=>{let d="";for(let m in n)if(n[m]!==""&&n[m]!==null){let C=new Date(n[m]),v=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;d==""?d+=`?${m}=${v}`:d+=`&${m}=${v}`}g(`/suppliersituation/report/${p}/${d}`),c(!0)}});return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:f,onClose:()=>h(x.actions.openCloseModalDoc()),children:e.jsxs(I,{children:[e.jsx(te,{title:l(a.situationCliente.docTitle),sx:{borderBottom:n=>`0.5px solid ${n.palette.mode=="dark"?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"}`,padding:2},action:e.jsx(S,{onClick:()=>h(x.actions.openCloseModalDoc()),children:e.jsx(X,{})})}),e.jsxs("form",{onSubmit:s.handleSubmit,children:[e.jsx(Z,{children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date1,onChange:n=>s.setFieldValue("date1",n),onBlur:s.handleBlur,label:l(a.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date1&&s.errors.date1),helperText:s.touched.date1&&s.errors.date1}}})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(E,{value:s.values.date2,onChange:n=>s.setFieldValue("date2",n),onBlur:s.handleBlur,label:l(a.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(s.touched.date2&&s.errors.date2),helperText:s.touched.date2&&s.errors.date2}}})})]})}),e.jsxs(ae,{sx:{display:"flex",justifyContent:"end"},children:[e.jsx(k,{variant:"outlined",color:"error",onClick:()=>h(x.actions.openCloseModalDoc()),children:l(a.client.deleteCancel)}),e.jsx(k,{variant:"contained",type:"submit",children:l(a.situationCliente.afficher)})]})]})]})}),r&&e.jsx(ee,{close:()=>c(!1),isPreview:r,file:{file:i}})]})}function oe({isLoading:p,setData:l,setLink:b,isError:h}){const{t:r,i18n:c}=w(),{situationFournisseur:i}=$(t=>t.situationFournisseur),g=T(),[f,s]=j.useState(),n=t=>{console.log(t),l(t),g(x.actions.setCurrentData(t))},u=t=>{s(t),g(x.actions.openCloseModalDoc())};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(I,{children:e.jsx(q,{component:V,children:e.jsxs(z,{children:[e.jsx(O,{children:e.jsxs(D,{children:[e.jsx(o,{children:r(a.fournisseur.title)}),e.jsxs(o,{children:[r(a.situationFournisseur.totalEntrees)," ",r(a.global.mad)]}),e.jsxs(o,{children:[r(a.situationCliente.totalPaiment)," ",r(a.global.mad)]}),e.jsxs(o,{children:[r(a.situationCliente.paymentProgress)," ",r(a.global.mad)]}),e.jsxs(o,{children:[r(a.situationCliente.paymentEchec)," ",r(a.global.mad)]}),e.jsxs(o,{children:[r(a.situationCliente.debt)," ",r(a.global.mad)]}),e.jsx(o,{})]})}),p?e.jsx(Y,{rowsNum:10}):e.jsx(Q,{children:(i==null?void 0:i.length)>0?i==null?void 0:i.map(t=>{const d=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(o,{children:e.jsxs(F,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(N,{sx:{bgcolor:"rgb(19, 194, 194)",color:"white",width:45,height:45},children:t.first_name[0]+" "+t.last_name[0]}),e.jsxs("div",{children:[t.first_name+" "+t.last_name,e.jsx(B,{color:"text.secondary",variant:"body2",children:t.email})]})]})}),e.jsx(o,{sx:{direction:c.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:d.format(t.sum_inbound_price).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{style:{fontWeight:"bold"},sx:{direction:c.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:d.format(t.sum_payment_payed).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{sx:{color:m=>m.palette.warning.main,fontWeight:"600",direction:c.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap",whiteSpace:"nowrap"},children:d.format(t.sum_payment_in_progress).replaceAll(","," ").replace("MAD","")}),e.jsx(o,{sx:{direction:c.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{style:{color:t.sum_payment_invalid>0?"red":"green"},children:d.format(t.sum_payment_invalid).replaceAll(","," ").replace("MAD","")})}),e.jsx(o,{sx:{direction:c.language=="ar"?"rtl":"ltr",whiteSpace:"nowrap"},children:e.jsx("p",{className:"font-bold",style:{color:t.solde>=0?"green":"red"},children:d.format(t.solde).replaceAll(","," ").replace("MAD","")})}),e.jsxs(o,{children:[e.jsx(S,{color:"info",onClick:()=>n(t.eggsource),children:e.jsx(A,{children:e.jsx(U,{})})}),e.jsx(W,{title:"Telecharger document du situation fournisseur",children:e.jsx(S,{color:"primary",onClick:()=>u(t.eggsource),children:e.jsx(A,{children:e.jsx(ne,{})})})})]})]})})}):e.jsx(D,{children:e.jsx(o,{colSpan:5,sx:{textAlign:"center"},children:r(a.magazin.nothingToDisplay)})})})]})})}),h&&e.jsx(se,{})]}),e.jsx(le,{id:f})]})}function ce(){const p=T(),[l,b]=j.useState(),[h,r]=j.useState(""),c=M("clients",_.getClientFournisseur),i=M(["client",l,h],()=>_.getFournisseurSituationDetails(l,h)),[g,f]=j.useState(),{t:s,i18n:n}=w(),u=d=>{b(d)},t=d=>r(d);return j.useEffect(()=>{!c.isLoading&&i.data==0&&p(x.actions.fetchSituationFournisseur(c.data)),i.status=="success"&&i.data!==0&&l!==""&&(p(x.actions.setFournisseurSituationForOneFournisseur({id:l})),p(x.actions.fetchFournisseurSituationDetails({data:i.data})),b(void 0))},[c.isLoading,i.isLoading,l,h]),e.jsx(e.Fragment,{children:e.jsxs(G,{children:[i.isLoading&&e.jsx(H,{}),e.jsx(P,{component:"main",sx:{flexGrow:1,py:8},children:e.jsx(ie,{maxWidth:"xl",children:e.jsxs(F,{spacing:4,children:[e.jsx(F,{spacing:1,children:e.jsx(B,{variant:"h4",children:s(a.situationFournisseur.title)})}),e.jsx(oe,{isLoading:c.isLoading,isError:c.isError,details:g,setData:u,setLink:t,isLoadingDetails:i.isLoading})]})})}),e.jsx(re,{})]})})}function ve(){return e.jsx(e.Fragment,{children:e.jsx(G,{children:e.jsx(ce,{})})})}export{ve as default};
