import{r as D,a2 as I,d as M,l as s,j as e,B as je,a3 as De,a1 as _,a as G,V as W,ak as Ae,ae as T,al as ke,am as i,h as A,ab as V,ac as Y,ad as $,a6 as k,T as te,a7 as X,F as ee,k as re,Y as R,O as We,u as Le,an as Ne,ao as Be,i as He,S as Ve}from"./index-6dfaf798.js";import{e as ge,T as ve,a as fe,b as F,c as p,d as be,P as Ye,f as se,G as B,u as oe,S as H,h as ie,B as le,E as Se}from"./moment-b22360b6.js";import{E as $e,P as qe,M as ye}from"./ModalDelete-26a071ca.js";import{I as Ke,m as we,U as ze,a as Xe,C as Je,D as Qe}from"./UploadFileModel-d3c7f3e5.js";import{E as Ze}from"./Eye-ddc0c46b.js";import{T as et}from"./index-913cdcd8.js";import{F as tt}from"./FilePreview-8e9663e6.js";import{T as st,C as de}from"./TableRowsLoader-e8443f2b.js";import{A as nt}from"./AlertError-202fc79f.js";import{K as at,a as ot}from"./KeyboardArrowUp-fbf656ad.js";import{D as it}from"./DeleteOutlineOutlined-c33c7e3c.js";import{A as rt}from"./Add-5aa9af27.js";import{u as ce,c as me,e as Ee,C as Ue,b as lt,d as L}from"./formik.esm-45b81460.js";import{A as dt,a as ct,F as mt,b as pt}from"./fr-dfeccf7c.js";import{E as ut}from"./ExpandMore-9a47559a.js";import{D as z}from"./DatePicker-c3bd6d5c.js";import{C as ht}from"./Container-2497af14.js";import{M as _e}from"./ModalConfirm-0866ad57.js";import{D as xt}from"./Delete-2e42fa1b.js";import{E as Ct}from"./Edit-2ba0063f.js";import{C as jt}from"./Check-be05b6d4.js";const Dt=D.memo(r=>{let{count:d=0,items:a=[],onDeselectAll:n,onDeselectOne:l,onSelectAll:c,onSelectOne:h,selected:S=[],isLoading:j,isError:C}=r;const t=I(),[g,P]=D.useState(1),[o,v]=D.useState(!1),[w,y]=D.useState(25),{t:x,i18n:Pe}=M(),[pe,ue]=D.useState({}),[ne,q]=D.useState(!1),[he,xe]=D.useState(),[u,f]=D.useState(),U=[{mode:1,text:x(s.global.oui)},{mode:2,text:x(s.global.enCours)},{mode:3,text:x(s.global.echec)}],J=[x(s.paiment.espece),x(s.paiment.virment),x(s.paiment.cheque),x(s.paiment.lcn)],[K,O]=D.useState(null),N=!!K,Oe=(m,b)=>{f(b),O(m.currentTarget)},Te=()=>{O(null)},Re=m=>{ue(b=>({...b,[m]:!b[m]}))},ae=(m,b)=>{const Q=a.filter(Z=>Z.id==m);t(i.actions.setCurrentData(Q[0])),b=="update"?t(i.actions.openCloseModalUpdate()):b=="delete"?t(i.actions.openCloseModalDelete()):b=="paimentHistory"?t(i.actions.openCloseModalHistory()):v(!0)},Ie=(m,b)=>{P(b)},Me=a==null?void 0:a.slice((g-1)*w,g*w);D.useEffect(()=>{P(1)},[a]);const Fe=m=>{A.put("/payment/payed/",{id:u,mode:m}).then(b=>{t(i.actions.handlePayed({id:u,data:b.data})),O(null)})};return D.useEffect(()=>{P(1)},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(je,{sx:{position:"relative"},children:[e.jsx(ge,{component:De,children:e.jsxs(ve,{sx:{minWidth:700},children:[e.jsx(fe,{children:e.jsxs(F,{children:[e.jsx(p,{align:"left"}),e.jsx(p,{children:x(s.client.title)}),e.jsxs(p,{children:[x(s.paiment.amount)," ",x(s.global.mad)]}),e.jsx(p,{children:x(s.entrer.date)}),e.jsx(p,{children:x(s.paiment.typePayment)}),e.jsx(p,{children:x(s.paiment.isPayed)}),e.jsx(p,{})]})}),j?e.jsx(st,{rowsNum:10}):e.jsx(be,{children:Me.length>0?Me.map(m=>{const b=pe[m.id]||!1;let Q=new Date(m.date),Z={year:Q.getFullYear(),month:`${Q.getMonth()+1}`,day:`${Q.getDate()}`};const Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(F,{hover:!0,children:[e.jsx(p,{children:m.payment_proof.length!==0&&e.jsx(_,{"aria-label":"expand row",size:"small",onClick:()=>Re(m.id),children:b?e.jsx(at,{}):e.jsx(ot,{})})}),e.jsxs(p,{children:[m.client_f_n," ",m.client_l_n]}),e.jsx(p,{sx:{direction:"initial",whiteSpace:"nowrap"},children:Ge.format(m.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(p,{children:[" ",Z.day.padStart(2,0),"/",Z.month.padStart(2,0),"/",Z.year]}),e.jsx(p,{children:J[m.mode-1]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":N?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":N?"true":void 0,onClick:E=>Oe(E,m.id),color:m.payed==1?"success":m.payed==2?"warning":"error",sx:{"&:disabled":{color:E=>E.palette.success.dark}},disabled:m.mode==1||m.mode==2,children:U[Number(m.payed)-1].text}),(m.payed==3||m.history)&&e.jsx(_,{color:"success",onClick:()=>ae(m.id,"paimentHistory"),children:e.jsx(W,{children:e.jsx(Ke,{path:we,size:1})})}),e.jsx(Ae,{id:"basic-menu",anchorEl:K,open:N,onClose:Te,MenuListProps:{"aria-labelledby":"basic-button"},children:U.map((E,Ce)=>e.jsx(T,{onClick:Tt=>Fe(E.mode),children:E.text},Ce))})]})}),e.jsxs(p,{children:[e.jsx(_,{color:"warning",onClick:()=>ae(m.id,"update"),children:e.jsx(W,{children:e.jsx($e,{})})}),e.jsx(_,{color:"error",onClick:()=>ae(m.id,"delete"),children:e.jsx(W,{children:e.jsx(it,{})})}),m.payment_proof.length!==4&&e.jsx(_,{color:"success",onClick:()=>ae(m.id,"upload"),children:e.jsx(W,{children:e.jsx(rt,{})})})]})]},m.id),e.jsx(F,{children:e.jsx(p,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(ke,{in:b,timeout:"auto",unmountOnExit:!0,children:e.jsx(ge,{sx:{width:"100%"},component:De,children:e.jsxs(ve,{sx:{width:"100%"},children:[e.jsx(fe,{children:e.jsxs(F,{children:[e.jsx(p,{children:x(s.paiment.fileName)}),e.jsx(p,{})]})}),e.jsx(be,{children:m.payment_proof.map((E,Ce)=>e.jsxs(F,{children:[e.jsx(p,{children:E.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(p,{children:[" ",e.jsx(_,{color:"inherit",onClick:()=>{t(i.actions.openCloseConfirmDeleteProof()),t(i.actions.setCurrentData({id:m.id,idFile:E.id}))},children:e.jsx(W,{children:e.jsx(et,{})})}),e.jsx(_,{color:"secondary",onClick:()=>{xe({file:E.file,extension:E.extension}),q(!0)},children:e.jsx(W,{children:e.jsx(Ze,{})})})]})]},Ce))})]})})})})})]})}):e.jsx(F,{children:e.jsx(p,{colSpan:5,sx:{textAlign:"center"},children:x(s.batiment.nothingToDisplay)})})})]})}),e.jsx(je,{sx:{display:"flex",justifyContent:"end",p:"5px"},children:e.jsx(Ye,{count:Math.ceil(d/w),defaultPage:g,onChange:Ie,color:"primary",size:"large"})}),C&&e.jsx(nt,{})]}),o&&e.jsx(ze,{isModalUpload:o,close:()=>v(!1)}),ne&&e.jsx(tt,{isPreview:ne,close:()=>q(!1),file:he})]})});function gt({clients:r}){se.locale("fr");const{t:d,i18n:a}=M(),n=I(),l=ce({initialValues:{date1:null,date2:null,client:""},validationSchema:me({date1:Ee().nullable().test("is-before-date2",d(s.global.date2Greather),function(c){const{date2:h}=this.parent;return c<=h}),date2:Ee().nullable().test("is-after-date1",d(s.global.date2Greather),function(c){const{date1:h}=this.parent;return c>=h})}),onSubmit:async(c,{resetForm:h,setErrors:S})=>{let j="";for(let C in c)if(c[C]!==""&&c[C]!==null){let t=new Date(c[C]),g=t.getFullYear()!==1970?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:c[C];j==""?j+=`?${C}=${g}`:j+=`&${C}=${g}`}A.get("/payment/list/"+j).then(C=>{n(i.actions.fetchPaiment(C.data))})},onReset:()=>{A.get("/payment/list/").then(c=>{n(i.actions.fetchPaiment(c.data))})}});return e.jsxs(dt,{defaultExpanded:!0,children:[e.jsx(ct,{expandIcon:e.jsx(ut,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(mt,{}),d(s.global.filter)]})}),e.jsx(pt,{children:e.jsx(Ue,{children:e.jsx(lt,{children:e.jsx("form",{noValidate:!0,onSubmit:l.handleSubmit,onReset:l.handleReset,children:e.jsxs(B,{container:!0,alignItems:"center",gap:2,children:[e.jsx(B,{item:!0,xs:12,md:5,sm:12,children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(Y,{id:"batiment-id",children:d(s.client.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:l.handleBlur,fullWidth:!0,name:"client",onChange:l.handleChange,value:l.values.client,label:d(s.client.title),children:r==null?void 0:r.map(c=>e.jsxs(T,{value:c.id,children:[c.first_name," ",c.last_name]}))})]})}),e.jsx(B,{item:!0,xs:12,md:2,sm:12,children:e.jsx(z,{value:l.values.date1,onChange:c=>l.setFieldValue("date1",c),onBlur:l.handleBlur,label:d(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(l.touched.date1&&l.errors.date1),helperText:l.touched.date1&&l.errors.date1}}})}),e.jsx(B,{item:!0,xs:12,md:2,sm:12,children:e.jsx(z,{value:l.values.date2,onChange:c=>l.setFieldValue("date2",c),onBlur:l.handleBlur,label:d(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(l.touched.date2&&l.errors.date2),helperText:l.touched.date2&&l.errors.date2}}})}),e.jsxs(B,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(B,{items:!0,children:e.jsx(G,{variant:"contained",type:"reset",children:d(s.global.reset)})}),e.jsx(B,{items:!0,children:e.jsx(G,{type:"submit",variant:"contained",children:d(s.global.filter)})})]})]})})})})})]})}function vt(){const r=I(),{t:d,i18n:a}=M(),{paiment:n}=k(h=>h.paiment),l=oe("paiment",ie.getPaiments),c=oe("clients",ie.getClientSelect);return D.useEffect(()=>{l.status=="success"&&r(i.actions.fetchPaiment(l.data))},[l.status]),e.jsx(ht,{maxWidth:"xl",children:e.jsxs(H,{spacing:4,children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(H,{spacing:1,children:e.jsx(te,{variant:"h4",children:d(s.paiment.title)})}),e.jsx(H,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(G,{startIcon:e.jsx(W,{children:e.jsx(qe,{})}),variant:"contained",onClick:()=>r(i.actions.openCloseModalAdd()),children:d(s.global.ajouter)})})]}),e.jsxs(Ue,{children:[e.jsx(gt,{clients:c.data}),e.jsx(Dt,{items:n,count:n.length,rowsPerPage:25,isLoading:l.isLoading,isError:l.isError})]})]})})}const ft={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function bt({clients:r,paimentModes:d}){const a=I(),{t:n,i18n:l}=M();JSON.parse(sessionStorage.getItem("user"));const{currentData:c,isModalUpdate:h,isConfirm:S}=k(o=>o.paiment),j=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],C=me({client:L().required(n(s.sortie.clientRequired)),amount:L().required(n(s.paiment.amountRequired)),mode:L().required(n(s.paiment.typePaymentRequired))}),t=ce({initialValues:{client:"",amount:"",mode:"",date:new Date},validationSchema:C,onSubmit:async(o,{resetForm:v,setErrors:w})=>{const y={...o};console.log(o),y.date=se(o.date).format("YYYY-MM-DD"),A.put("/payment/update/",y).then(x=>{a(i.actions.editPaiment(x.data)),a(i.actions.openCloseModalUpdate()),a(i.actions.openCloseConfirm()),R.success(n(s.paiment.toastUpdateSuccess)),v()}).catch(x=>{a(i.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),g=async o=>{o.preventDefault();const v=await t.validateForm();Object.keys(v).length===0?a(i.actions.openCloseConfirm()):await t.submitForm()},P=()=>{t.handleSubmit()};return D.useEffect(()=>{let o={...c};o.date=new Date(o.date),t.setValues(o)},[]),e.jsxs(e.Fragment,{children:[e.jsx(X,{open:h,onClose:()=>a(i.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:ft,children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.update)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(i.actions.openCloseModalUpdate()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>g(o),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.client&&t.errors.client),children:[e.jsx(Y,{id:"batiment-id",children:n(s.client.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"client",onChange:t.handleChange,value:t.values.client,label:n(s.client.title),children:r.map(o=>e.jsxs(T,{value:o.id,children:[o.first_name," ",o.last_name]}))}),t.touched.client&&t.errors.client&&e.jsx(ee,{children:t.errors.client})]}),e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:d.map(o=>e.jsx(T,{value:o.id,children:j[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(ee,{children:t.errors.mode})]}),e.jsx(re,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(z,{label:n(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(_e,{confirmed:P,cancel:()=>a(i.actions.openCloseConfirm()),isConfirm:S})]})}const St={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function yt({clients:r,paimentModes:d}){const a=I(),{t:n,i18n:l}=M();JSON.parse(sessionStorage.getItem("user"));const{paiment:c,isModalAdd:h,isConfirm:S}=k(o=>o.paiment),j=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],C=me({client:L().required(n(s.sortie.clientRequired)),amount:L().required(n(s.paiment.amountRequired)),mode:L().required(n(s.paiment.typePaymentRequired))}),t=ce({initialValues:{client:"",amount:"",mode:"",date:new Date},validationSchema:C,onSubmit:async(o,{resetForm:v,setErrors:w})=>{const y={...o};y.date=se(o.date).format("YYYY-MM-DD"),A.post("/payment/add/",y).then(x=>{a(i.actions.addPaiment(x.data)),a(i.actions.openCloseModalAdd()),a(i.actions.openCloseConfirm()),R.success(n(s.paiment.toastAddSuccess)),v()}).catch(x=>{a(i.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),g=async o=>{o.preventDefault();const v=await t.validateForm();Object.keys(v).length===0?a(i.actions.openCloseConfirm()):await t.submitForm()},P=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{open:h,onClose:()=>a(i.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:St,children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(i.actions.openCloseModalAdd()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>g(o),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.client&&t.errors.client),children:[e.jsx(Y,{id:"batiment-id",children:n(s.client.title)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"client",onChange:t.handleChange,value:t.values.client,label:n(s.client.title),children:r.length>0?r.map(o=>e.jsxs(T,{value:o.id,children:[o.first_name," ",o.last_name]})):e.jsx(T,{children:n(s.batiment.nothingToDisplay)})}),t.touched.client&&t.errors.client&&e.jsx(ee,{children:t.errors.client})]}),e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:d.map(o=>e.jsx(T,{value:o.id,children:j[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(ee,{children:t.errors.mode})]}),e.jsx(re,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(z,{label:n(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(_e,{confirmed:P,cancel:()=>a(i.actions.openCloseConfirm()),isConfirm:S})]})}function _t(){const{currentData:r,isModalDelete:d}=k(h=>h.paiment),a=I(),{t:n,i18n:l}=M();JSON.parse(sessionStorage.getItem("user"));const c=()=>{A.delete(`/payment/delete/${r.id}`).then(h=>{a(i.actions.deletePaiment()),a(i.actions.openCloseModalDelete()),R.success(n(s.paiment.toastDeleteSuccess))}).catch(h=>{a(i.actions.openCloseModalDelete()),R.error(n(s.global.toastError))})};return e.jsx(X,{open:d,onClose:()=>a(i.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(ye,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:c,cancel:()=>a(i.actions.openCloseModalDelete())})})}function Pt(){const{currentData:r,isModalDeleteProof:d}=k(h=>h.paiment),a=I(),{t:n,i18n:l}=M(),c=()=>{A.delete(`/payment/proof/delete/${r.idFile}`).then(h=>{a(i.actions.deletePaimentProof()),a(i.actions.openCloseConfirmDeleteProof()),R.success(n(s.global.toastSuccessDeleteFile))}).catch(h=>{a(i.actions.openCloseConfirmDeleteProof()),R.error(n(s.global.toastError))})};return e.jsx(X,{open:d,onClose:()=>a(i.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(ye,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:c,cancel:()=>a(i.actions.openCloseConfirmDeleteProof())})})}function Ot({isOpen:r,close:d,handleDelete:a}){const{t:n,i18n:l}=M();return e.jsx(X,{open:r,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(ye,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:a,cancel:d})})}function Mt(){const{t:r,i18n:d}=M(),{currentData:a}=k(u=>u.paiment),[n,l]=D.useState(),c=I(),[h,S]=D.useState(!1),[j,C]=D.useState(!1),[t,g]=D.useState(),P=[{mode:1,text:r(s.global.oui)},{mode:2,text:r(s.global.enCours)},{mode:3,text:r(s.global.echec)}],o=[r(s.paiment.espece),r(s.paiment.virment),r(s.paiment.cheque),r(s.paiment.lcn)],[v,w]=D.useState(null),y=!!v,x=(u,f)=>{l(f),w(u.currentTarget)},Pe=()=>{w(null)},pe=u=>{A.put("/payment/payedcorrection/",{id:n,mode:u}).then(f=>{c(i.actions.handlePayedCorrection({id:n,data:f.data})),w(null)})},ue=(u,f)=>{g(f),S(!0),l(u)},ne=u=>{C(!0),l(u)},q=u=>{const f=u.target.name;g(f?U=>({...U,date:new Date(U.date),[f]:Number(u.target.value)}):U=>({...U,date:new Date(U.date)}))},he=()=>{let u={...t,date:se(t.date).format("YYYY-MM-DD")};A.put("/payment/updatecorrection/",u).then(f=>{c(i.actions.handlePayedCorrection({id:n,data:f.data})),S(!1)})},xe=()=>{A.delete(`/payment/deletecorrection/${n}`).then(u=>{c(i.actions.deletePaimentHistory()),C(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(je,{sx:{position:"relative"},children:e.jsx(ge,{component:De,children:e.jsxs(ve,{sx:{minWidth:700},children:[e.jsx(fe,{children:e.jsxs(F,{children:[e.jsxs(p,{children:[r(s.paiment.amount)," ",r(s.global.mad)]}),e.jsx(p,{children:r(s.entrer.date)}),e.jsx(p,{children:r(s.paiment.typePayment)}),e.jsx(p,{children:r(s.paiment.isPayed)}),e.jsx(p,{})]})}),e.jsx(be,{children:a.payment_correction.map((u,f)=>{const U=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});let J=new Date(u.date),K={year:J.getFullYear(),month:`${J.getMonth()+1}`,day:`${J.getDate()}`};return!h||a.payment_correction.length-1!==f?e.jsxs(F,{children:[e.jsxs(p,{sx:{direction:"initial"},children:[" ",U.format(u.amount).replaceAll(","," ").replace("MAD","")]}),e.jsxs(p,{children:[" ",K.day.padStart(2,0),"/",K.month.padStart(2,0),"/",K.year]}),e.jsx(p,{children:o[u.mode-1]}),e.jsxs(p,{children:[" ",e.jsxs("div",{children:[e.jsx(G,{id:"basic-button","aria-controls":y?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":y?"true":void 0,onClick:O=>x(O,u.id),color:u.payed==1?"success":u.payed==2?"warning":"error",sx:{"&:disabled":{color:O=>O.palette.success.dark}},disabled:u.mode==1||u.mode==2?!0:f==0,children:P[Number(u.payed)-1].text}),u.payed==3&&e.jsx(_,{color:"success",onClick:()=>openModal(u.id,"paimentHistory"),children:e.jsx(W,{children:e.jsx(Xe,{path:we,size:1})})}),e.jsx(Ae,{id:"basic-menu",anchorEl:v,open:y,onClose:Pe,MenuListProps:{"aria-labelledby":"basic-button"},children:P.map((O,N)=>e.jsx(T,{onClick:Oe=>pe(O.mode),children:O.text},N))})]})]}),a.payment_correction.length-1==f&&f!==0&&e.jsxs(p,{children:[e.jsx(_,{color:"error",onClick:()=>ne(u.id),children:e.jsx(xt,{})}),e.jsx(_,{color:"warning",onClick:()=>ue(u.id,u),children:e.jsx(Ct,{})})]})]}):e.jsxs(F,{children:[e.jsx(p,{sx:{direction:"initial"},children:e.jsx(re,{value:t.amount,fullWidth:!0,label:r(s.paiment.amount),type:"number",name:"amount",onChange:q})}),e.jsxs(p,{children:[" ",e.jsx(z,{value:new Date(t.date),name:"date",onChange:q,label:r(s.entrer.date)})]}),e.jsx(p,{children:e.jsxs(V,{fullWidth:!0,children:[e.jsx(Y,{id:"demo-simple-select-label",children:r(s.paiment.typePayment)}),e.jsx($,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:t.mode,label:r(s.paiment.typePayment),onChange:q,name:"mode",children:o.map((O,N)=>e.jsx(T,{value:N+1,children:O}))})]})}),e.jsxs(p,{children:[e.jsx(_,{color:"success",onClick:he,children:e.jsx(jt,{})}),e.jsx(_,{color:"error",onClick:()=>S(!1),children:e.jsx(Je,{})})]})]})})})]})})}),e.jsx(Ot,{isOpen:j,close:()=>C(!1),handleDelete:xe})]})}function Et(){const r=I(),d=We(),{t:a}=M(),{currentData:n,isModalHistory:l}=k(j=>j.paiment),c=Le(d.breakpoints.down("md")),[h,S]=D.useState(!0);return D.useEffect(()=>{let j=n.payment_correction[0].amount;n.payment_correction.slice(1,n.payment_correction.length).reduce((t,g)=>g.payed==1?t+g.amount:t,0)>=j&&S(!1)},[n]),e.jsxs(Ne,{onClose:()=>r(i.actions.openCloseModalHistory()),fullScreen:c,open:l,maxWidth:"lg",children:[e.jsxs(Qe,{sx:{m:0,p:2.5},id:"customized-dialog-title",children:[a(s.paiment.titleHistory)," ",n.client_f_n," ",n.client_l_n]}),e.jsx(_,{"aria-label":"close",onClick:()=>r(i.actions.openCloseModalHistory()),sx:j=>({position:"absolute",right:8,top:8,color:j.palette.grey[500]}),children:e.jsx(de,{})}),e.jsxs(Be,{children:[e.jsxs(He,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:1.5,children:[e.jsx(te,{variant:"h6"}),h&&e.jsx(G,{variant:"contained",onClick:()=>r(i.actions.openCloseModalAddHistory()),children:a(s.global.ajouter)})]}),e.jsx(Mt,{})]})]})}const At={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function wt({paimentModes:r}){const d=I(),{t:a,i18n:n}=M(),l=[a(s.paiment.espece),a(s.paiment.virment),a(s.paiment.cheque),a(s.paiment.lcn)],{paiment:c,isModalAddHistory:h,currentData:S,isConfirm:j}=k(o=>o.paiment),C=me({amount:L().required(a(s.paiment.amountRequired)),mode:L().required(a(s.paiment.typePaymentRequired))}),t=ce({initialValues:{amount:"",mode:"",date:new Date,payment:S.id},validationSchema:C,onSubmit:async(o,{resetForm:v,setErrors:w})=>{const y={...o};y.date=se(o.date).format("YYYY-MM-DD"),A.post("/payment/addcorrection/",y).then(x=>{d(i.actions.addPaimentHistory(x.data)),d(i.actions.openCloseModalAddHistory()),d(i.actions.openCloseConfirm()),R.success(a(s.paiment.toastAddSuccess)),v()}).catch(x=>{d(i.actions.openCloseConfirm()),R.error(a(s.global.toastError))})}}),g=async o=>{o.preventDefault();const v=await t.validateForm();Object.keys(v).length===0?d(i.actions.openCloseConfirm()):await t.submitForm()},P=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{open:h,onClose:()=>d(i.actions.openCloseModalAddHistory()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(le,{sx:At,children:[e.jsxs(H,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(te,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>d(i.actions.openCloseModalAddHistory()),children:e.jsx(de,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>g(o),children:[e.jsxs(V,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(Y,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx($,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:a(s.paiment.typePayment),children:r.map(o=>e.jsx(T,{value:o.id,children:l[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(ee,{children:t.errors.mode})]}),e.jsx(re,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(z,{label:a(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(G,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(_e,{confirmed:P,cancel:()=>d(i.actions.openCloseConfirm()),isConfirm:j})]})}function Ut(){const{isModalAdd:r,isModalUpdate:d,isModalHistory:a,isModalAddHistory:n}=k(h=>h.paiment),l=oe("clients",ie.getClientSelect),c=oe("paimentsMode",ie.paymentMode);return e.jsxs(le,{component:"main",sx:{flexGrow:1,py:8},children:[e.jsx(Se,{children:e.jsx(vt,{})}),r&&e.jsx(yt,{clients:l.data,paimentModes:c.data}),d&&e.jsx(bt,{clients:l.data,paimentModes:c.data}),n&&e.jsx(wt,{paimentModes:c.data}),e.jsx(_t,{}),e.jsx(Pt,{}),a&&e.jsxs(Se,{children:[" ",e.jsx(Et,{})]})]})}function ts(){const{t:r,i18n:d}=M();return e.jsxs("div",{children:[e.jsx(Ve,{title:`ESM | ${r(s.nav.Paiment)}`}),e.jsx(Se,{children:e.jsx(Ut,{})})]})}export{ts as default};
