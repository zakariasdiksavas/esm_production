import{aa as U,aA as Pe,ae as w,d as A,r as C,j as e,af as $,a4 as Ee,a9 as O,l as s,a as W,h as k,bE as r,a5 as f,au as Me,T as J,B as Ue,ab as me,a2 as L,as as Ae,aj as ne,ak as te,al as ae,am as H,k as ve,F as ge}from"./index-5b79c039.js";import{E as ye,P as Te,M as De}from"./ModalDelete-04bd8acd.js";import{u as we,C as fe,T as Re}from"./index-be556e9b.js";import{B as V,e as pe,T as ue,a as he,b as G,c as D,d as xe,f as oe,G as T,u as ee,S as N,h as se,E as Fe}from"./moment-864131f4.js";import{C as Y,T as Ie}from"./TableRowsLoader-23cb4167.js";import{E as Ge}from"./Eye-655a27ed.js";import{A as Le,T as Ne,K as We,a as ke}from"./KeyboardArrowUp-c6409d2a.js";import{A as Be}from"./AlertError-96b329d4.js";import{D as He}from"./DeleteOutlineOutlined-32598299.js";import{u as re,c as ie,e as Ce,C as je,b as Ve,d as X}from"./formik.esm-f8b1f355.js";import"./fr-4efeb1d7.js";import{D as q}from"./DatePicker-9add668e.js";import{M as Se}from"./ModalConfirm-575c2085.js";const Ye=p=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",boxShadow:24,p:4,[p.breakpoints.down("md")]:{width:"95%"}}),$e=["application/pdf","image/jpg","image/jpeg","image/png"];function Ke({isModalUpload:p,close:n,isFournisseur:a}){var K;const c=U(),l=Pe(),{currentData:t}=w(x=>x.mensuel),{t:i,i18n:d}=A(),[o,v]=C.useState([]),[u,m]=C.useState(4-((K=t==null?void 0:t.expenses_proof)==null?void 0:K.length)-o.length),[P,j]=C.useState(!1),{acceptedFiles:S,getRootProps:R,getInputProps:le}=we({onDrop:(x,g)=>{var b;if(g.length>0){if(g[0].errors[0].code=="too-many-files"){f.error(i(s.paiment.uploadLimitFile)+` ${4-((b=t==null?void 0:t.expenses_proof)==null?void 0:b.length)}`);return}else if(g[0].errors[0].code=="file-invalid-type"){f.error(i(s.paiment.fileSupported));return}f.error(g[0].errors[0].message)}v(F=>[...F,...x])},multiple:!0,maxFiles:u,validator:Z,accept:{"application/pdf":[],"image/jpeg":[],"image/jpg":[],"image/png":[]}}),E=()=>{j(!0);const x=new FormData;x.append("id",t.id),o.map(g=>{x.append("files",g)}),k.post("/operatingexpenses/proof/add/",x).then(g=>{c(r.actions.addProofMensuel(g.data)),f.success(i(s.paiment.toastUploadFile)),j(!1),n(),v([])})},de=x=>{const g=o.findIndex(F=>F.path==x),b=o.filter((F,M)=>M!==g);v(b)};function Z(x){var b;if(!$e.includes(x.type))return{code:"extension-supported",message:i(s.paiment.fileSupported)};const g=5*1024*1024;return x.size>g?{code:"max-size",message:i(s.paiment.uploadMaxSize)}:u<=0?{code:"max-file",message:`${i(s.paiment.uploadLimitFile)} ${4-((b=t==null?void 0:t.expenses_proof)==null?void 0:b.length)}`}:null}return C.useEffect(()=>{var x;o.length>0&&m(4-((x=t==null?void 0:t.expenses_proof)==null?void 0:x.length)-o.length)},[o.length]),e.jsx(e.Fragment,{children:e.jsx($,{open:p,onClose:n,children:e.jsxs(V,{sx:Ye(l),children:[P&&e.jsx(Ee,{}),e.jsx(V,{sx:{position:"absolute",right:0,top:0},children:e.jsx(O,{onClick:n,children:e.jsx(Y,{})})}),e.jsx("h3",{className:"text-center font-semibold text-lg",children:i(s.paiment.uploadTitle)}),e.jsxs("div",{className:"flex flex-col items-center my-4 border-2 border-dashed border-purple-500 p-4",...R(),children:[e.jsx("input",{...le()}),e.jsx(fe,{color:"primary",fontSize:"large"}),e.jsx("p",{children:i(s.paiment.uploadTitle)}),e.jsxs("p",{children:[i(s.paiment.uploadMessage)," PNG, JPG, JPEG, PDF"]})]}),e.jsx("div",{children:o.map((x,g)=>e.jsxs("p",{children:[x.path," ",e.jsx(O,{onClick:()=>de(x.path),children:e.jsx(Y,{color:"error"})})]},g))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{onClick:E,variant:"contained",color:"primary",children:i(s.paiment.upload)})})]})})})}function ze({close:p,isPreview:n,file:a}){const[c,l]=C.useState(null);return C.useEffect(()=>(console.log(a),(async()=>{try{console.log(a.file);const i=await k.get(a.file,{responseType:"blob"}),d=URL.createObjectURL(i.data);console.log(d),l(d)}catch(i){console.error("Error fetching PDF:",i)}})(),()=>{c&&URL.revokeObjectURL(c)}),[]),e.jsxs(Me,{fullScreen:!0,open:n,children:[e.jsx(Le,{sx:{position:"relative"},children:e.jsxs(Ne,{children:[e.jsx(O,{edge:"start",color:"inherit","aria-label":"close",onClick:()=>p(),children:e.jsx(Y,{})}),e.jsx(J,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Preview File"})]})}),e.jsx("iframe",{src:c,height:"100%"})]})}const Xe=C.memo(p=>{const n=U();let{count:a=0,items:c=[],onDeselectAll:l,onDeselectOne:t,onSelectAll:i,onSelectOne:d,selected:o=[],isLoading:v,isError:u}=p;const[m,P]=C.useState(1),[j,S]=C.useState(!1),[R,le]=C.useState(25),{t:E,i18n:de}=A(),[Z,K]=C.useState({}),[x,g]=C.useState(!1),[b,F]=C.useState();C.useState(),C.useState(null);const M=C.useRef(null),be=h=>{K(_=>({..._,[h]:!_[h]}))},Q=(h,_)=>{const y=c.filter(B=>B.id==h);n(r.actions.setCurrentData(y[0])),_=="update"?n(r.actions.openCloseModalUpdate()):_=="delete"?n(r.actions.openCloseModalDelete()):S(!0)},ce=()=>{const h=M.current;h&&h.scrollHeight===h.scrollTop+h.clientHeight&&!v&&P(y=>y+1)};C.useEffect(()=>(M.current&&M.current.addEventListener("scroll",ce),()=>{M.current&&M.current.removeEventListener("scroll",ce)}),[v]);const I=c==null?void 0:c.slice(0,m*R);return e.jsxs(e.Fragment,{children:[e.jsxs(Ue,{sx:{position:"relative"},children:[e.jsx(pe,{component:me,sx:{maxHeight:"60vh"},ref:M,children:e.jsxs(ue,{sx:{minWidth:700},children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(D,{align:"left"}),e.jsxs(D,{children:[E(s.paiment.amount)," ",E(s.global.mad)]}),e.jsx(D,{children:E(s.entrer.date)}),e.jsx(D,{children:E(s.depense.addlabel)}),e.jsx(D,{})]})}),v?e.jsx(Ie,{rowsNum:10}):e.jsx(xe,{children:(I==null?void 0:I.length)>0?I==null?void 0:I.map(h=>{const _=Z[h.id]||!1;let y=new Date(h.date),B={year:y.getFullYear(),month:`${y.getMonth()+1}`,day:`${y.getDate()}`};const _e=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(G,{hover:!0,children:[e.jsx(D,{sx:{width:"5%"},children:h.expenses_proof.length!==0&&e.jsx(O,{"aria-label":"expand row",size:"small",onClick:()=>be(h.id),children:_?e.jsx(We,{}):e.jsx(ke,{})})}),e.jsx(D,{sx:{direction:"initial",whiteSpace:"nowrap"},children:_e.format(h.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(D,{children:[" ",B.day.padStart(2,0),"/",B.month.padStart(2,0),"/",B.year]}),e.jsx(D,{children:h.type_name}),e.jsxs(D,{children:[e.jsx(O,{color:"warning",onClick:()=>Q(h.id,"update"),children:e.jsx(L,{children:e.jsx(ye,{})})}),e.jsx(O,{color:"error",onClick:()=>Q(h.id,"delete"),children:e.jsx(L,{children:e.jsx(He,{})})}),h.expenses_proof.length!==4&&e.jsx(O,{color:"success",onClick:()=>Q(h.id,"upload"),children:e.jsx(L,{children:e.jsx(fe,{})})})]})]},h.id),e.jsx(G,{children:e.jsx(D,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Ae,{in:_,timeout:"auto",unmountOnExit:!0,children:e.jsx(pe,{sx:{width:"100%"},component:me,children:e.jsxs(ue,{sx:{width:"100%"},children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(D,{children:E(s.paiment.fileName)}),e.jsx(D,{})]})}),e.jsx(xe,{children:h.expenses_proof.map((z,Oe)=>e.jsxs(G,{children:[e.jsx(D,{children:z.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(D,{children:[" ",e.jsx(O,{color:"inherit",onClick:()=>{n(r.actions.openCloseConfirmDeleteProof()),n(r.actions.setCurrentData({id:h.id,idFile:z.id}))},children:e.jsx(L,{children:e.jsx(Re,{})})}),e.jsx(O,{color:"secondary",onClick:()=>{F({file:z.file,extension:z.extension}),g(!0)},children:e.jsx(L,{children:e.jsx(Ge,{})})})]})]},Oe))})]})})})})})]})}):e.jsx(G,{children:e.jsx(D,{colSpan:5,sx:{textAlign:"center"},children:E(s.batiment.nothingToDisplay)})})})]})}),u&&e.jsx(Be,{})]}),j&&e.jsx(Ke,{isModalUpload:j,close:()=>S(!1)}),x&&e.jsx(ze,{isPreview:x,close:()=>g(!1),file:b})]})});function qe({type:p}){oe.locale("fr");const{t:n,i18n:a}=A(),c=U(),l=re({initialValues:{date1:null,date2:null,type:""},validationSchema:ie({date1:Ce().nullable().test("is-before-date2",n(s.global.date2Greather),function(t){const{date2:i}=this.parent;return t<=i}),date2:Ce().nullable().test("is-after-date1",n(s.global.date2Greather),function(t){const{date1:i}=this.parent;return t>=i})}),onSubmit:async(t,{resetForm:i,setErrors:d})=>{let o="";for(let v in t)if(t[v]!==""&&t[v]!==null){let u=new Date(t[v]),m=u.getFullYear()!==1970?`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`:t[v];o==""?o+=`?${v}=${m}`:o+=`&${v}=${m}`}c(r.actions.setLink(o))},onReset:()=>{c(r.actions.setLink(""))}});return e.jsx(je,{children:e.jsx(Ve,{children:e.jsx("form",{noValidate:!0,onSubmit:l.handleSubmit,onReset:l.handleReset,children:e.jsxs(T,{container:!0,alignItems:"center",gap:2,children:[e.jsx(T,{item:!0,xs:12,md:3.8,children:e.jsxs(ne,{fullWidth:!0,children:[e.jsx(te,{id:"batiment-id",size:"small",children:n(s.depense.addlabel)}),e.jsx(ae,{labelId:"batiment-id",id:"demo-simple-select",onBlur:l.handleBlur,fullWidth:!0,name:"type",size:"small",onChange:l.handleChange,value:l.values.type,label:n(s.depense.addlabel),children:p==null?void 0:p.map(t=>e.jsx(H,{value:t.id,children:t.name}))})]})}),e.jsx(T,{item:!0,xs:12,md:3.8,children:e.jsx(q,{value:l.values.date1,onChange:t=>l.setFieldValue("date1",t),onBlur:l.handleBlur,label:n(s.global.date1),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",size:"small",error:!!(l.touched.date1&&l.errors.date1),helperText:l.touched.date1&&l.errors.date1}}})}),e.jsx(T,{item:!0,xs:12,md:3.8,children:e.jsx(q,{value:l.values.date2,onChange:t=>l.setFieldValue("date2",t),onBlur:l.handleBlur,label:n(s.global.date2),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",error:!!(l.touched.date2&&l.errors.date2),helperText:l.touched.date2&&l.errors.date2}}})}),e.jsxs(T,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(T,{items:!0,children:e.jsx(W,{variant:"contained",type:"reset",children:n(s.global.reset)})}),e.jsx(T,{items:!0,children:e.jsx(W,{type:"submit",variant:"contained",children:n(s.global.filter)})})]})]})})})})}function Je(){const p=U(),{t:n,i18n:a}=A(),{mensuel:c,link:l}=w(d=>d.mensuel),t=ee(["mensuel",l],()=>se.fetchMensuel(l)),i=ee("typeDePense",se.fetchExpenseType);return C.useEffect(()=>{t.status=="success"&&(console.log(t.data),p(r.actions.fetchMensuel(t.data)))},[t.status,l]),e.jsxs(N,{spacing:4,children:[e.jsxs(N,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(N,{spacing:1,children:e.jsx(J,{variant:"h4",children:n(s.depense.titleMensuel)})}),e.jsx(N,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(W,{startIcon:e.jsx(L,{children:e.jsx(Te,{})}),variant:"contained",onClick:()=>p(r.actions.openCloseModalAdd()),children:n(s.global.ajouter)})})]}),e.jsxs(je,{children:[e.jsx(qe,{type:i.data}),e.jsx(Xe,{items:c,count:c.length,rowsPerPage:25,isLoading:t.isLoading,isError:t.isError})]})]})}const Ze={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Qe({types:p}){const n=U(),{t:a,i18n:c}=A(),{currentData:l,isModalUpdate:t,isConfirm:i}=w(m=>m.mensuel),d=ie({amount:X().required(a(s.paiment.amountRequired)),type:X().required()}),o=re({initialValues:{amount:0,type:"",date:new Date},validationSchema:d,onSubmit:async(m,{resetForm:P,setErrors:j})=>{const S={...m};S.date=oe(m.date).format("YYYY-MM-DD"),k.put("/operatingexpenses/update/",S).then(R=>{n(r.actions.editMensuel(R.data)),n(r.actions.openCloseModalUpdate()),n(r.actions.openCloseConfirm()),f.success(a(s.depense.toastUpdateSuccess)),P()}).catch(R=>{n(r.actions.openCloseConfirm()),f.error(a(s.global.toastError))})}}),v=async m=>{m.preventDefault();const P=await o.validateForm();Object.keys(P).length===0?n(r.actions.openCloseConfirm()):await o.submitForm()},u=()=>{o.handleSubmit()};return C.useEffect(()=>{const m={...l};m.date=new Date(m.date),o.setValues(m)},[]),e.jsxs(e.Fragment,{children:[e.jsx($,{open:t,onClose:()=>n(r.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(V,{sx:Ze,children:[e.jsxs(N,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(J,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.depense.updatemensuel)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>n(r.actions.openCloseModalUpdate()),children:e.jsx(Y,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:m=>v(m),children:[e.jsx(ve,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:o.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:o.handleChange,value:o.values.amount,error:!!(o.touched.amount&&o.errors.amount),helperText:o.touched.amount&&o.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(ne,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(o.touched.type&&o.errors.type),children:[e.jsx(te,{id:"batiment-id",children:a(s.depense.addlabel)}),e.jsx(ae,{labelId:"batiment-id",id:"demo-simple-select",onBlur:o.handleBlur,fullWidth:!0,name:"type",onChange:o.handleChange,value:o.values.type,label:a(s.depense.addlabel),children:p.length>0?p.map(m=>e.jsx(H,{value:m.id,children:m.name})):e.jsx(H,{children:a(s.batiment.nothingToDisplay)})}),o.touched.type&&o.errors.type&&e.jsx(ge,{children:o.errors.type})]}),e.jsx(q,{label:a(s.entrer.date),value:o.values.date,onChange:m=>o.setFieldValue("date",m),onBlur:o.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(W,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.modifier)})]})]})}),e.jsx(Se,{confirmed:u,cancel:()=>n(r.actions.openCloseConfirm()),isConfirm:i})]})}const es={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ss({types:p}){const n=U(),{t:a,i18n:c}=A(),{isModalAdd:l,isConfirm:t}=w(u=>u.mensuel),i=ie({amount:X().required(a(s.paiment.amountRequired)),type:X().required()}),d=re({initialValues:{amount:0,type:"",date:new Date},validationSchema:i,onSubmit:async(u,{resetForm:m,setErrors:P})=>{const j={...u};j.date=oe(u.date).format("YYYY-MM-DD"),k.post("/operatingexpenses/add/",j).then(S=>{n(r.actions.addMensuel(S.data)),n(r.actions.openCloseModalAdd()),n(r.actions.openCloseConfirm()),f.success(a(s.depense.toastAddSuccess)),m()}).catch(S=>{n(r.actions.openCloseConfirm()),f.error(a(s.global.toastError))})}}),o=async u=>{u.preventDefault();const m=await d.validateForm();Object.keys(m).length===0?n(r.actions.openCloseConfirm()):await d.submitForm()},v=()=>{d.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx($,{open:l,onClose:()=>n(r.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(V,{sx:es,children:[e.jsxs(N,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(J,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.depense.addmensuel)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>n(r.actions.openCloseModalAdd()),children:e.jsx(Y,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:u=>o(u),children:[e.jsx(ve,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:d.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:d.handleChange,value:d.values.amount,error:!!(d.touched.amount&&d.errors.amount),helperText:d.touched.amount&&d.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(ne,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(d.touched.type&&d.errors.type),children:[e.jsx(te,{id:"batiment-id",children:a(s.depense.addlabel)}),e.jsx(ae,{labelId:"batiment-id",id:"demo-simple-select",onBlur:d.handleBlur,fullWidth:!0,name:"type",onChange:d.handleChange,value:d.values.type,label:a(s.depense.addlabel),children:p.length>0?p.map(u=>e.jsx(H,{value:u.id,children:u.name})):e.jsx(H,{children:a(s.batiment.nothingToDisplay)})}),d.touched.type&&d.errors.type&&e.jsx(ge,{children:d.errors.type})]}),e.jsx(q,{label:a(s.entrer.date),value:d.values.date,onChange:u=>d.setFieldValue("date",u),onBlur:d.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(W,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(Se,{confirmed:v,cancel:()=>n(r.actions.openCloseConfirm()),isConfirm:t})]})}function ns(){const{currentData:p,isModalDelete:n}=w(i=>i.mensuel),a=U(),{t:c,i18n:l}=A(),t=()=>{k.delete(`/operatingexpenses/delete/${p.id}`).then(i=>{a(r.actions.deleteMensuel()),a(r.actions.openCloseModalDelete()),f.success(c(s.depense.toastDeleteSuccess))}).catch(i=>{a(r.actions.openCloseModalDelete()),f.error(c(s.global.toastError))})};return e.jsx($,{open:n,onClose:()=>a(r.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(De,{title:c(s.depense.deletetitleMentuel),message:c(s.depense.deletemessageMentuel),deleteFn:t,cancel:()=>a(r.actions.openCloseModalDelete())})})}function ts(){const{currentData:p,isModalDeleteProof:n}=w(i=>i.mensuel),a=U(),{t:c,i18n:l}=A(),t=()=>{k.delete(`/operatingexpenses/proof/delete/${p.idFile}`).then(i=>{a(r.actions.deleteMensuelProof()),a(r.actions.openCloseConfirmDeleteProof()),f.success(c(s.global.toastSuccessDeleteFile))}).catch(i=>{console.log(i),a(r.actions.openCloseConfirmDeleteProof()),f.error(c(s.global.toastError))})};return e.jsx($,{open:n,onClose:()=>a(r.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(De,{title:c(s.paiment.deleteTitleFile),message:c(s.paiment.deleteDescriptionFile),deleteFn:t,cancel:()=>a(r.actions.openCloseConfirmDeleteProof())})})}function as(){const{isModalAdd:p,isModalUpdate:n}=w(c=>c.mensuel),a=ee("types",se.fetchExpenseType);return e.jsxs(V,{component:"main",sx:{flexGrow:1,p:3},children:[e.jsx(Fe,{children:e.jsx(Je,{})}),p&&e.jsx(ss,{types:a.data}),n&&e.jsx(Qe,{types:a.data}),e.jsx(ns,{}),e.jsx(ts,{})]})}function gs(){return e.jsx(e.Fragment,{children:e.jsx(as,{})})}export{gs as default};
