import{r as B,at as we,a2 as P,d as A,j as e,B as Se,a3 as Be,l as t,a1 as U,V as X,al as Ne,bn as c,h as O,ab as J,ac as G,ad as H,ae as W,a as q,a6 as V,T as K,a7 as Z,F as ie,Y as F,an as Te,ao as _e,U as le,bo as me,k as Y,S as ke}from"./index-b9aeea20.js";import{e as he,T as xe,a as pe,b as z,c as f,d as je,f as Me,g as Ee,G as N,u as se,S as M,h as re,B as ee,j as qe,E as ve}from"./moment-8bb476e3.js";import{E as ge,P as Fe,M as Ae}from"./ModalDelete-e666945f.js";import{T as Ie,C as te}from"./TableRowsLoader-c4300d5c.js";import{A as $e}from"./AlertError-9fdceddd.js";import{K as We,a as Pe,A as Oe}from"./KeyboardArrowUp-80820a8c.js";import{D as Ve}from"./DeleteOutlineOutlined-7644538f.js";import{A as Re}from"./Add-94c13e39.js";import{u as ae,c as de,e as be,C as ye,b as ze,d as oe}from"./formik.esm-799b94e8.js";import{A as Ue,a as Ye,F as Le,b as Je,m as L}from"./fr-3088b82b.js";import{E as Ge}from"./ExpandMore-6e3ae782.js";import{D as fe}from"./DatePicker-05f47eec.js";import{C as He}from"./Container-7ef0f39f.js";import{M as Ce}from"./ModalConfirm-37aae7aa.js";import{D as De}from"./DateTimePicker-e1425ffd.js";import"./Tabs-029752cf.js";const Ke=B.memo(o=>{const l=we(),a=P();let{count:r=0,items:m=[],onDeselectAll:h,onDeselectOne:i,onSelectAll:n,onSelectOne:g,selected:b=[],isLoading:x,isError:D}=o;const[s,T]=B.useState(0),[_,u]=B.useState(25),y=JSON.parse(sessionStorage.getItem("user")),{t:S,i18n:E}=A(),[k,ce]=B.useState({}),I=p=>{ce(d=>({...d,[p]:!d[p]}))},Q=(p,d)=>{const w=m.filter(C=>C.id==p)[0];switch(a(c.actions.setCurrentData(w)),d){case"update":a(c.actions.openCloseModalUpdate());break;case"delete":a(c.actions.openCloseModalDelete());break;case"addDetails":a(c.actions.openCloseModalAddDetails());break}},j=(p,d)=>{T(d)},ue=p=>{u(parseInt(p.target.value,10)),T(0)},ne=m==null?void 0:m.slice(s*_,s*_+_);return e.jsxs(Se,{sx:{position:"relative"},children:[e.jsx(he,{component:Be,children:e.jsxs(xe,{sx:{minWidth:700,"& .MuiTableCell-body":{padding:"2px 18px"}},size:"small","aria-label":"a dense table",children:[e.jsx(pe,{children:e.jsxs(z,{children:[e.jsx(f,{align:"left"}),e.jsx(f,{align:"left",children:y!=null&&y.is_eleveur?S(t.batiment.Nom):S(t.fournisseur.Nom)}),e.jsx(f,{align:"left",children:S(t.magazin.Nom)}),e.jsx(f,{align:"left",children:S(t.entrer.date)}),e.jsx(f,{align:"left",children:S(t.entrer.temps)}),e.jsx(f,{align:"left"})]})}),x?e.jsx(Ie,{rowsNum:10}):e.jsx(je,{children:ne.length>0?ne.map((p,d)=>{const w=k[p.id]||!1;let C=new Date(p.date),v={year:C.getFullYear(),month:`${C.getMonth()+1}`,day:`${C.getDate()}`};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{hover:!1,sx:{backgroundColor:d%2!==0?w?l.palette.mode=="dark"?l.palette.primary.dark:l.palette.primary.light:l.palette.mode==="dark"?l.palette.grey[900]:l.palette.grey[100]:w?l.palette.mode=="dark"?l.palette.primary.dark:l.palette.primary.light:"transparent"},children:[e.jsx(f,{children:p.inbound_details.length!==0&&e.jsx(U,{"aria-label":"expand row",size:"small",onClick:()=>I(p.id),children:w?e.jsx(We,{}):e.jsx(Pe,{})})}),e.jsxs(f,{align:"left",children:[p.eggsource_name," ",p.eggsource_lastname]}),e.jsx(f,{align:"left",children:p.warehouse_name}),e.jsxs(f,{align:"left",children:[v.day.padStart(2,0),"/",v.month.padStart(2,0),"/",v.year]}),e.jsx(f,{align:"left",children:p.time.substring(0,5)}),e.jsxs(f,{children:[e.jsx(U,{color:"warning",onClick:()=>Q(p.id,"update"),children:e.jsx(X,{children:e.jsx(ge,{})})}),e.jsx(U,{color:"error",onClick:()=>Q(p.id,"delete"),children:e.jsx(X,{children:e.jsx(Ve,{})})}),p.inbound_details.length==0&&e.jsx(U,{color:"success",onClick:()=>Q(p.id,"addDetails"),children:e.jsx(X,{children:e.jsx(Re,{})})})]})]},p.id),e.jsx(z,{children:e.jsx(f,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(Ne,{in:w,timeout:"auto",unmountOnExit:!0,children:e.jsx(he,{children:e.jsxs(xe,{children:[e.jsx(pe,{children:e.jsxs(z,{children:[e.jsxs(f,{children:[S(t.sortie.eggType)," "]}),e.jsx(f,{children:S(t.entrer.quantity)}),!(y!=null&&y.is_eleveur)&&e.jsxs(f,{children:[S(t.entrer.prix)," ",S(t.global.mad)]}),e.jsx(f,{})]})}),e.jsx(je,{children:p.inbound_details.map((R,$)=>e.jsxs(z,{sx:{backgroundColor:$%2!==0?l.palette.mode==="dark"?l.palette.grey[900]:l.palette.grey[100]:"transparent","&:hover":{backgroundColor:l.palette.mode==="dark"?l.palette.grey[800]:l.palette.grey[200]}},children:[e.jsx(f,{children:R.egg_class}),e.jsx(f,{children:R.quantity}),!(y!=null&&y.is_eleveur)&&e.jsx(f,{children:R.price}),e.jsxs(f,{children:[" ",e.jsx(U,{color:"info",onClick:()=>a(c.actions.setCurrentDetailData({id:p.id,id_details:R.id})),children:e.jsx(X,{children:e.jsx(ge,{})})})]})]},$))})]})})})})})]})}):e.jsx(z,{children:e.jsx(f,{colSpan:7,sx:{textAlign:"center"},children:S(t.magazin.nothingToDisplay)})})})]})}),e.jsx(Me,{component:"div",count:r,onPageChange:j,onRowsPerPageChange:ue,page:s,rowsPerPage:_,rowsPerPageOptions:[5,10,25],labelRowsPerPage:S(t.magazin.Lignes),labelDisplayedRows:({from:p,to:d,count:w})=>`${p}–${d} ${S(t.magazin.sur)} ${w}`}),D&&e.jsx($e,{})]})});function Qe({batiment:o,magazin:l}){Ee.locale("fr");const{t:a,i18n:r}=A(),m=P(),h=JSON.parse(sessionStorage.getItem("user")),i=ae({initialValues:{date1:null,date2:null,warehouse:"",eggsource:""},validationSchema:de({date1:be().nullable().test("is-before-date2",a(t.global.date2Greather),function(n){const{date2:g}=this.parent;return n<=g}),date2:be().nullable().test("is-after-date1",a(t.global.date2Greather),function(n){const{date1:g}=this.parent;return n>=g})}),onSubmit:async(n,{resetForm:g,setErrors:b})=>{let x="";for(let D in n)if(n[D]!==""&&n[D]!==null){let s=new Date(n[D]),T=s.getFullYear()!==1970?`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`:n[D];x==""?x+=`?${D}=${T}`:x+=`&${D}=${T}`}if(n.date1!==null&&n.date2==null){b({date2:a(t.global.date2Required)});return}else if(n.date1==null&&n.date2!==null){b({date1:a(t.global.date1Required)});return}O.get("/inbound/list/"+x).then(D=>{m(c.actions.fetchEntrer(D.data))})},onReset:()=>{O.get("/inbound/list/").then(n=>{m(c.actions.fetchEntrer(n.data))})}});return e.jsxs(Ue,{defaultExpanded:!0,children:[e.jsx(Ye,{expandIcon:e.jsx(Ge,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(Le,{}),a(t.global.filter)]})}),e.jsx(Je,{children:e.jsx(ye,{children:e.jsx(ze,{children:e.jsx("form",{noValidate:!0,onSubmit:i.handleSubmit,onReset:i.handleReset,children:e.jsxs(N,{container:!0,alignItems:"center",gap:2,children:[e.jsx(N,{item:!0,xs:12,md:2,sm:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(G,{id:"batiment-id",children:h!=null&&h.is_eleveur?a(t.batiment.Nom):a(t.fournisseur.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:i.handleBlur,fullWidth:!0,name:"eggsource",onChange:i.handleChange,value:i.values.eggsource,label:h!=null&&h.is_eleveur?a(t.batiment.Nom):a(t.fournisseur.Nom),children:o==null?void 0:o.map(n=>e.jsxs(W,{value:n.id,children:[n.name," ",n.last_name]}))})]})}),e.jsx(N,{items:!0,xs:12,md:2,sm:12,children:e.jsxs(J,{fullWidth:!0,children:[e.jsx(G,{id:"batiment-id",children:a(t.magazin.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:i.handleBlur,fullWidth:!0,name:"warehouse",onChange:i.handleChange,value:i.values.warehouse,label:a(t.batiment.Nom),children:l==null?void 0:l.map(n=>e.jsx(W,{value:n.id,children:n.name}))})]})}),e.jsx(N,{item:!0,xs:12,md:2,sm:12,children:e.jsx(fe,{value:i.values.date1,onChange:n=>i.setFieldValue("date1",n),onBlur:i.handleBlur,label:a(t.global.date1),name:"date1",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",error:!!(i.touched.date1&&i.errors.date1),helperText:i.touched.date1&&i.errors.date1}}})}),e.jsx(N,{item:!0,xs:12,md:2,sm:12,children:e.jsx(fe,{value:i.values.date2,onChange:n=>i.setFieldValue("date2",n),onBlur:i.handleBlur,label:a(t.global.date2),name:"date2",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",error:!!(i.touched.date2&&i.errors.date2),helperText:i.touched.date2&&i.errors.date2}}})}),e.jsxs(N,{item:!0,container:!0,xs:12,md:2,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(N,{items:!0,children:e.jsx(q,{variant:"contained",type:"reset",children:a(t.global.reset)})}),e.jsx(N,{items:!0,children:e.jsx(q,{type:"submit",variant:"contained",children:a(t.global.filter)})})]})]})})})})})]})}function Xe({batiment:o,magazin:l}){const a=P(),{t:r,i18n:m}=A(),{entrer:h}=V(g=>g.entrer),i=se("entrers",re.getEntrer),n=JSON.parse(sessionStorage.getItem("user"));return B.useEffect(()=>{i.status=="success"&&a(c.actions.fetchEntrer(i.data))},[i.status]),e.jsx(He,{maxWidth:"xl",children:e.jsxs(M,{spacing:4,children:[e.jsxs(M,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(M,{spacing:1,children:e.jsx(K,{variant:"h4",children:n!=null&&n.is_eleveur?r(t.entrer.titleBreeder):r(t.entrer.titleDealer)})}),e.jsx(M,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(q,{startIcon:e.jsx(X,{children:e.jsx(Fe,{})}),variant:"contained",onClick:()=>a(c.actions.openCloseModalAdd()),children:r(t.global.ajouter)})})]}),e.jsxs(ye,{children:[e.jsx(Qe,{batiment:o,magazin:l}),e.jsx(Ke,{items:h,isLoading:i.isLoading,count:h.length,rowsPerPage:25,isError:i.isError})]})]})})}const Ze={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function et({batiment:o,magazin:l}){L.locale("fr");const a=JSON.parse(sessionStorage.getItem("user")),r=P(),{t:m,i18n:h}=A(),{currentData:i,isModalUpdate:n,isConfirm:g}=V(u=>u.entrer),[b,x]=B.useState(new Date),D=de({warehouse:oe().required(),eggsource:oe().required()}),s=ae({initialValues:{warehouse:"",eggsource:"",dateTime:""},validationSchema:D,onSubmit:async(u,{resetForm:y,setErrors:S})=>{let E={...u};E.date=L(b).format("YYYY-MM-DD"),E.time=L(b).format("LT"),O.put("/inbound/update/",E).then(k=>{r(c.actions.editEntrer(k.data)),r(c.actions.openCloseModalUpdate()),r(c.actions.openCloseConfirm()),F.success(a!=null&&a.is_eleveur?m(t.entrer.toastUpdateSuccessBreeder):m(t.entrer.toastUpdateSuccessDealer)),y()}).catch(k=>{r(c.actions.openCloseConfirm()),F.error(m(t.global.toastError))})}}),T=async u=>{u.preventDefault();const y=await s.validateForm();Object.keys(y).length===0?r(c.actions.openCloseConfirm()):await s.submitForm()},_=()=>{s.handleSubmit()};return B.useEffect(()=>{s.setValues(i),x(new Date(`${i.date}T${i.time}`)),s.setFieldValue("dateTime",new Date,!1)},[s.errors]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:n,onClose:()=>r(c.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:Ze,children:[e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(K,{id:"modal-modal-title",variant:"h6",component:"h2",children:a!=null&&a.is_eleveur?m(t.entrer.updateBreeder):m(t.entrer.updateDealer)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>r(c.actions.openCloseModalUpdate()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:u=>T(u),children:[e.jsxs(J,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(s.touched.eggsource&&s.errors.eggsource),children:[e.jsx(G,{id:"batiment-id",children:a!=null&&a.is_eleveur?m(t.batiment.Nom):m(t.fournisseur.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:s.handleBlur,fullWidth:!0,name:"eggsource",onChange:s.handleChange,value:s.values.eggsource,label:a!=null&&a.is_eleveur?m(t.batiment.Nom):m(t.fournisseur.Nom),children:o.map(u=>e.jsxs(W,{value:u.id,children:[u.name," ",u.last_name]}))}),s.touched.eggsource&&s.errors.eggsource&&e.jsx(ie,{children:s.errors.eggsource})]}),e.jsxs(J,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(s.touched.warehouse&&s.errors.warehouse),children:[e.jsx(G,{id:"batiment-id",children:m(t.magazin.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:s.handleBlur,fullWidth:!0,name:"warehouse",onChange:s.handleChange,value:s.values.warehouse,label:m(t.batiment.Nom),children:l.map(u=>e.jsx(W,{value:u.id,children:u.name}))}),s.touched.warehouse&&s.errors.warehouse&&e.jsx(ie,{children:s.errors.warehouse})]}),e.jsx(De,{id:"outlined-basic",label:m(t.entrer.temps)+" "+m(t.entrer.date),variant:"outlined",onBlur:s.handleBlur,fullWidth:!0,name:"dateTime",value:b,onChange:u=>{s.setFieldValue("dateTime",u,!0),x(u)},slotProps:{textField:{variant:"outlined",error:!!(s.touched.dateTime&&s.errors.dateTime),helperText:!!(s.touched.dateTime&&s.errors.dateTime)}},sx:{marginBottom:"15px",width:"100%"}}),e.jsx(q,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:m(t.global.modifier)})]})]})}),e.jsx(Ce,{confirmed:_,cancel:()=>r(c.actions.openCloseConfirm()),isConfirm:g})]})}const tt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function at({batiment:o,magazin:l}){L.locale("fr");const a=P(),{t:r,i18n:m}=A(),{entrer:h,isModalAdd:i,isConfirm:n}=V(u=>u.entrer),[g,b]=B.useState(new Date),x=JSON.parse(sessionStorage.getItem("user")),D=de({warehouse:oe().required(r(t.sortie.magazinRequired)),eggsource:oe().required(x!=null&&x.is_eleveur?r(t.sortie.batimentRequired):r(t.sortie.fournisseurRequired))}),s=ae({initialValues:{warehouse:"",eggsource:"",dateTime:""},validationSchema:D,onSubmit:async(u,{resetForm:y,setErrors:S})=>{let E={...u};E.date=L(g).format("YYYY-MM-DD"),E.time=L(g).format("LT"),O.post("/inbound/add/",E).then(k=>{a(c.actions.addEntrer(k.data)),a(c.actions.openCloseModalAdd()),a(c.actions.openCloseConfirm()),F.success(x!=null&&x.is_eleveur?r(t.entrer.toastAddSuccessBreeder):r(t.entrer.toastAddSuccessDealer)),y()}).catch(k=>{a(c.actions.openCloseConfirm()),F.error(r(t.entrer.toastError))})}}),T=async u=>{u.preventDefault();const y=await s.validateForm();Object.keys(y).length===0?a(c.actions.openCloseConfirm()):await s.submitForm()},_=()=>{s.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:i,onClose:()=>a(c.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:tt,children:[e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(K,{id:"modal-modal-title",variant:"h6",component:"h2",children:x!=null&&x.is_eleveur?r(t.entrer.addBreeder):r(t.entrer.addDealer)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(c.actions.openCloseModalAdd()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:u=>T(u),children:[e.jsxs(J,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(s.touched.eggsource&&s.errors.eggsource),children:[e.jsx(G,{id:"batiment-id",children:x!=null&&x.is_eleveur?r(t.batiment.Nom):r(t.fournisseur.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:s.handleBlur,fullWidth:!0,name:"eggsource",onChange:s.handleChange,value:s.values.eggsource,label:x!=null&&x.is_eleveur?r(t.batiment.Nom):r(t.fournisseur.Nom),children:o.length>0?o.map(u=>e.jsxs(W,{value:u.id,children:[u.name," ",u.last_name]},u.id)):e.jsx(W,{children:r(t.batiment.nothingToDisplay)})}),s.touched.eggsource&&s.errors.eggsource&&e.jsx(ie,{children:s.errors.eggsource})]}),e.jsxs(J,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(s.touched.warehouse&&s.errors.warehouse),children:[e.jsx(G,{id:"batiment-id",children:r(t.magazin.Nom)}),e.jsx(H,{labelId:"batiment-id",id:"demo-simple-select",onBlur:s.handleBlur,fullWidth:!0,name:"warehouse",onChange:s.handleChange,value:s.values.warehouse,label:r(t.batiment.Nom),children:l.length>0?l.map(u=>e.jsx(W,{value:u.id,children:u.name},u.id)):e.jsx(W,{children:r(t.batiment.nothingToDisplay)})}),s.touched.warehouse&&s.errors.warehouse&&e.jsx(ie,{children:s.errors.warehouse})]}),e.jsx(De,{id:"outlined-basic",label:r(t.entrer.temps)+" "+r(t.entrer.date),variant:"outlined",onBlur:s.handleBlur,fullWidth:!0,name:"dateTime",value:g,onChange:u=>{s.setFieldValue("dateTime",u,!0),b(u)},slotProps:{textField:{variant:"outlined",error:!!(s.touched.dateTime&&s.errors.dateTime),helperText:!!(s.touched.dateTime&&s.errors.dateTime)}},sx:{marginBottom:"15px",width:"100%"}}),e.jsx(q,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:r(t.global.ajouter)})]})]})}),e.jsx(Ce,{confirmed:_,cancel:()=>a(c.actions.openCloseConfirm()),isConfirm:n})]})}function nt(){const{currentData:o,isModalDelete:l}=V(g=>g.entrer),a=P(),{t:r,i18n:m}=A(),h=JSON.parse(sessionStorage.getItem("user")),i=()=>{O.delete(`/inbound/delete/${o.id}`).then(g=>{a(c.actions.deleteEntrer()),a(c.actions.openCloseModalDelete()),F.success(h!=null&&h.is_eleveur?r(t.entrer.toastDeleteSuccessBreeder):r(t.entrer.toastDeleteSuccessDealer))}).catch(g=>{a(c.actions.openCloseModalDelete()),F.error(r(t.entrer.toastError))})},n=`${h!=null&&h.is_eleveur?r(t.entrer.deleteDescriptionBreeder):r(t.entrer.deleteDescriptionDealer)}`;return e.jsx(Z,{open:l,onClose:()=>a(c.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(Ae,{title:h!=null&&h.is_eleveur?r(t.entrer.deleteTitleBreeder):r(t.entrer.deleteTitleDealer),message:n,deleteFn:i,cancel:()=>a(c.actions.openCloseModalDelete())})})}function st({title:o,closeFunction:l}){return e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px",p:"1px"},children:[e.jsx(K,{id:"modal-modal-title",variant:"h6",component:"h2",children:o}),e.jsx("div",{className:"cursor-pointer",onClick:()=>l(),children:e.jsx(te,{})})]})}const rt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:800,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:2};function it({eggClass:o}){const l=P(),{t:a,i18n:r}=A(),{entrer:m,currentData:h,isModalAddDetails:i}=V(d=>d.entrer),n=JSON.parse(sessionStorage.getItem("user")),[g,b]=B.useState(0),[x,D]=B.useState(0),[s,T]=B.useState(0),[_,u]=B.useState({}),[y,S]=B.useState(0),[E,k]=B.useState(!1),ce=o==null?void 0:o.findIndex(d=>d.egg_class_id==10),[I,Q]=B.useState({Normaux:[],Declasse:[]}),j=ae({initialValues:{},validationSchema:"",onSubmit:async(d,{resetForm:w,setErrors:C})=>{const v=Object.keys(d).map($=>({option:d[$].option,price:d[$].pu,quantity:d[$].qte}));let R={id:h.id,values:v};O.post("/inbound/detail/add/",R).then($=>{l(c.actions.addDetailsEnter({details:$.data,id:h.id})),F.success(a(t.entrer.toastAddSuccess)),k(!1),w()}).catch($=>{l(c.actions.openCloseConfirm()),F.error(a(t.entrer.toastError))})}}),ue=d=>{d.preventDefault(),k(!0)},ne=()=>{j.handleSubmit()},p=d=>w=>{if(w.target.name.includes("qte")||w.target.name.includes("pu")){b(0),D(0),S(0);for(let C in j.values)n!=null&&n.is_eleveur||(S(v=>Number(v+j.values[C].pu*j.values[C].qte).toFixed(2)),u(v=>({...v,[C]:Number(j.values[C].pu*j.values[C].qte).toFixed(2)}))),j.values[C].option<=6?b(v=>v+j.values[C].qte):j.values[C].option==10?T(j.values[C].qte):D(v=>v+j.values[C].qte)}d(w)};return B.useEffect(()=>{let d={};o==null||o.map(v=>{d[v.id]={qte:0,pu:0,option:v.egg_class_id}});const w=o==null?void 0:o.filter(v=>v.egg_class_id<=6),C=o==null?void 0:o.filter(v=>v.egg_class_id>=7);Q({Normaux:w,Declasse:C}),j.setValues(d)},[]),e.jsxs(e.Fragment,{children:[Object.keys(j.values).length!==0&&e.jsxs(Te,{fullScreen:!0,open:i,onClose:()=>l(c.actions.openCloseModalAddDetails()),children:[e.jsx(Oe,{sx:{position:"relative"},children:e.jsxs(qe,{children:[e.jsx(U,{edge:"start",color:"inherit",onClick:()=>l(c.actions.openCloseModalAddDetails()),"aria-label":"close",children:e.jsx(te,{})}),e.jsx(K,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:n!=null&&n.is_eleveur?a(t.entrer.addDetailsBreeder):a(t.entrer.addDetailsDealer)})]})}),e.jsx(_e,{sx:{p:1},children:e.jsxs("form",{noValidate:!0,onSubmit:d=>ue(d),children:[e.jsxs(N,{container:!0,spacing:2,children:[I.Normaux.length>0&&e.jsxs(N,{item:!0,spacing:2,xs:12,md:6,children:[e.jsxs("h1",{className:"font-bold text-center text-lg",children:[a(t.entrer.nomeaux)," "]}),I.Normaux.map((d,w)=>e.jsxs(N,{item:!0,xs:12,mt:1,children:[e.jsx(le,{children:e.jsx(me,{label:d.value,size:"small"})}),e.jsxs(M,{direction:"row",alignItems:"center",justifyItems:"center",flexWrap:"wrap",gap:1,mt:2,children:[e.jsx(Y,{id:"outlined-basic",label:a(t.entrer.quantity),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.qte`,onBlur:p(j.handleBlur),onChange:j.handleChange,value:j.values[d.id].qte,style:{flexBasis:n!=null&&n.is_eleveur?"100%":"48%"}}),!(n!=null&&n.is_eleveur)&&e.jsx(Y,{id:"outlined-basic",label:a(t.entrer.prix),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.pu`,onBlur:p(j.handleBlur),onChange:j.handleChange,value:j.values[d.id].pu,style:{flexBasis:n!=null&&n.is_eleveur?"100%":"48%"}}),!(n!=null&&n.is_eleveur)&&e.jsxs("span",{style:{flexBasis:"100%",textAlign:r.language=="ar"?"right":"left"},children:[a(t.entrer.total)," ",_[d.id]]})]})]}))]}),e.jsxs(N,{item:!0,spacing:2,xs:12,md:6,children:[I.Declasse.length>0&&e.jsx("h1",{className:"font-bold text-center text-lg",children:a(t.entrer.declasse)}),I.Declasse.map((d,w)=>e.jsxs(N,{item:!0,xs:12,mt:1,children:[e.jsx(le,{children:e.jsx(me,{label:`${d.value}`,size:"small"})}),e.jsxs(M,{direction:"row",alignItems:"center",justifyItems:"center",flexWrap:"wrap",gap:1,mt:2,children:[e.jsx(Y,{id:"outlined-basic",label:d.egg_class_id==10?`${a(t.entrer.quantity)} (kg)`:a(t.entrer.quantity),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.qte`,onBlur:p(j.handleBlur),onChange:j.handleChange,value:j.values[d.id].qte,style:{flexBasis:n!=null&&n.is_eleveur?"100%":"48%"}}),!(n!=null&&n.is_eleveur)&&e.jsx(Y,{id:"outlined-basic",label:a(t.entrer.prix),variant:"outlined",fullWidth:!0,type:"number",name:`${d.id}.pu`,onBlur:p(j.handleBlur),onChange:j.handleChange,value:j.values[d.id].pu,style:{flexBasis:n!=null&&n.is_eleveur?"100%":"48%"}}),!(n!=null&&n.is_eleveur)&&e.jsxs("span",{style:{flexBasis:"100%",textAlign:r.language=="ar"?"right":"left"},children:[a(t.entrer.total)," ",_[d.id]]})]})]})),e.jsx(M,{sx:{backgroundColor:d=>d.palette.mode==="dark"?"neutral.800":"error.lightest",borderRadius:2.5,p:1,mt:3},children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-around mb-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[a(t.entrer.nomeaux)," : "]}),e.jsx("p",{children:g})]}),I.Declasse.length>0&&e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[a(t.entrer.declasse)," : "]}),e.jsx("p",{children:x})]}),ce!==-1&&e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[a(t.entrer.eliminer)," : "]}),e.jsxs("p",{children:[s,"kg"]})]}),e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:a(t.entrer.total)}),e.jsx("p",{children:g+x})]}),!(n!=null&&n.is_eleveur)&&e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:a(t.entrer.totalPrice)}),e.jsx("p",{children:y})]})]})]})}),I.Declasse.length==0&&e.jsx(q,{fullWidth:!0,size:"large",sx:{mt:2,mb:2},type:"submit",variant:"contained",children:n!=null&&n.is_eleveur?a(t.entrer.addDetailsBreeder):a(t.entrer.addDetailsDealer)})]})]}),I.Declasse.length>0&&e.jsx(q,{fullWidth:!0,size:"large",sx:{mt:1,mb:1},type:"submit",variant:"contained",children:a(t.global.ajouter)})]})})]}),e.jsx(lt,{isOpen:E,confirmed:ne,close:()=>{k(!1)},data:{type1:g,type2:x,weight:s}})]})}const lt=({isOpen:o,confirmed:l,close:a,data:r})=>{const{t:m,i18n:h}=A();return e.jsx(Z,{open:o,children:e.jsxs(ee,{sx:rt,children:[e.jsx(st,{title:m(t.client.confirmOperation),closeFunction:a}),e.jsxs("div",{className:"flex justify-around mb-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:"Normaux : "}),e.jsx("p",{children:r.type1})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-around my-2",children:[e.jsx("h3",{className:"w-28 font-bold",children:"Déclassés : "}),e.jsxs("p",{children:[r.type2," + ",r.weight," kg"]})]}),e.jsx(le,{}),e.jsxs("div",{className:"flex justify-around mt-2",children:[e.jsxs("h3",{className:"w-28 font-bold",children:[m(t.entrer.total)," "]}),e.jsx("p",{children:r.type1+r.type2})]}),e.jsxs(N,{container:!0,mt:3,spacing:2,children:[e.jsx(N,{item:!0,xs:6}),e.jsx(N,{item:!0,xs:3,children:e.jsx(q,{variant:"contained",color:"error",onClick:a,children:m(t.client.deleteCancel)})}),e.jsx(N,{item:!0,xs:3,children:e.jsx(q,{variant:"contained",color:"success",onClick:l,children:m(t.client.deleteConfirm)})})]})]})})},ot={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function dt(){const o=P(),{t:l,i18n:a}=A(),{currentDetailData:r,isModalUpdateDetails:m}=V(b=>b.entrer),h=de({}),i=ae({initialValues:{quantity:0,price:0},validationSchema:h,onSubmit:async(b,{resetForm:x,setErrors:D})=>{console.log(r),O.put("/inbound/detail/update/",b).then(s=>{o(c.actions.updateDetailsLignes({id:b.inbound,id_details:b.id,details:s.data})),o(c.actions.openCloseModalUpdateDetails()),o(c.actions.openCloseConfirm()),F.success(l(t.entrer.toastAddSuccess)),x()}).catch(s=>{o(c.actions.openCloseConfirm()),o(c.actions.openCloseConfirm()),F.error(l(t.entrer.toastError))})}}),n=b=>{b.preventDefault(),o(c.actions.openCloseConfirm())},g=()=>{i.handleSubmit()};return B.useEffect(()=>{console.log(r),i.setValues(r)},[r]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:m,onClose:()=>o(c.actions.openCloseModalUpdateDetails()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ee,{sx:ot,children:[e.jsxs(M,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(K,{id:"modal-modal-title",variant:"h6",component:"h2",children:l(t.entrer.updateTitleDetails)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(c.actions.openCloseModalUpdateDetails()),children:e.jsx(te,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:b=>n(b),children:[e.jsx(Y,{id:"outlined-basic",label:l(t.entrer.quantity),variant:"outlined",onBlur:i.handleBlur,fullWidth:!0,type:"number",name:"quantity",onChange:i.handleChange,value:i.values.quantity,error:!!(i.touched.quantity&&i.errors.quantity),helperText:i.touched.quantity&&i.errors.quantity,style:{marginBottom:"15px"}}),e.jsx(Y,{id:"outlined-basic",label:l(t.entrer.prix),variant:"outlined",onBlur:i.handleBlur,fullWidth:!0,type:"number",name:"price",onChange:i.handleChange,value:i.values.price,error:!!(i.touched.price&&i.errors.price),helperText:i.touched.price&&i.errors.price,style:{marginBottom:"15px"}}),e.jsx(q,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:l(t.entrer.updateTitleDetails)})]})]})}),e.jsx(Confirm,{confirmed:g})]})}function ct(){const{isModalAdd:o,isModalUpdate:l,isModalAddDetails:a,isModalUpdateDetails:r}=V(n=>n.entrer),m=se("batimens",re.getBatimentSelect),h=se("magazins",re.getWarehouseSelect),i=se("classLists",re.getClass);return e.jsxs(ee,{component:"main",sx:{flexGrow:1,py:8},children:[e.jsx(ve,{children:e.jsx(Xe,{batiment:m.data,magazin:h.data})}),o&&e.jsx(at,{batiment:m.data,magazin:h.data}),l&&e.jsx(et,{batiment:m.data,magazin:h.data}),a&&e.jsx(it,{eggClass:i.data}),r&&e.jsx(dt,{eggClass:i.data}),e.jsx(nt,{})]})}function Nt(){const o=JSON.parse(sessionStorage.getItem("user")),{t:l,i18n:a}=A(),r=o!=null&&o.is_eleveur?l(t.nav.production):l(t.nav.achat);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:`ESM | ${r}`}),e.jsx(ve,{children:e.jsx(ct,{})})]})}export{Nt as default};
