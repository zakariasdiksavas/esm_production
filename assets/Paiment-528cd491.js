import{r as j,aa as T,d as O,l as s,j as e,B as Ae,ab as De,a9 as _,a as F,a2 as k,ar as we,am as U,as as ke,at as r,h as E,aj as $,ak as q,al as K,ae as G,T as ne,af as Z,F as se,k as de,a5 as R,$ as Le,u as Ne,au as Be,av as He,i as Ve,S as Ye}from"./index-5b79c039.js";import{e as ge,T as be,a as fe,b as I,c as u,d as Se,f as ae,G as V,u as ie,S as Y,h as le,B as ce,E as ye}from"./moment-864131f4.js";import{E as $e,P as qe,M as _e}from"./ModalDelete-04bd8acd.js";import{I as Ke,m as Ue,U as ze,a as Xe,C as Je,D as Qe}from"./UploadFileModel-b18e9ca9.js";import{E as Ze}from"./Eye-655a27ed.js";import{C as et,T as tt}from"./index-be556e9b.js";import{F as st}from"./FilePreview-1d12d7cb.js";import{T as nt,C as me}from"./TableRowsLoader-23cb4167.js";import{A as at}from"./AlertError-96b329d4.js";import{K as ot,a as rt}from"./KeyboardArrowUp-c6409d2a.js";import{D as it}from"./DeleteOutlineOutlined-32598299.js";import{u as ue,c as pe,e as Ee,C as Re,b as lt,d as L}from"./formik.esm-f8b1f355.js";import"./fr-4efeb1d7.js";import{D as Q}from"./DatePicker-9add668e.js";import{M as Pe}from"./ModalConfirm-575c2085.js";import{D as dt}from"./Delete-951034da.js";import{E as ct}from"./Edit-65022ded.js";import{C as mt}from"./Check-81145735.js";const ut=j.memo(i=>{let{count:c=0,items:a=[],onDeselectAll:n,onDeselectOne:l,onSelectAll:d,onSelectOne:h,selected:S=[],isLoading:C,isError:v}=i;const t=T(),[D,A]=j.useState(1),[o,g]=j.useState(!1),[W,y]=j.useState(25),{t:x,i18n:Oe}=O(),[he,xe]=j.useState({}),[oe,z]=j.useState(!1),[Ce,ve]=j.useState(),[p,b]=j.useState(),w=[{mode:1,text:x(s.global.oui)},{mode:2,text:x(s.global.enCours)},{mode:3,text:x(s.global.echec)}],ee=[x(s.paiment.espece),x(s.paiment.virment),x(s.paiment.cheque),x(s.paiment.lcn)],[X,P]=j.useState(null),N=!!X,B=j.useRef(null),Te=(m,f)=>{b(f),P(m.currentTarget)},Ie=()=>{P(null)},Fe=m=>{xe(f=>({...f,[m]:!f[m]}))},re=(m,f)=>{const H=a.filter(te=>te.id==m);t(r.actions.setCurrentData(H[0])),f=="update"?t(r.actions.openCloseModalUpdate()):f=="delete"?t(r.actions.openCloseModalDelete()):f=="paimentHistory"?t(r.actions.openCloseModalHistory()):g(!0)},Me=()=>{const m=B.current;m&&m.scrollHeight===m.scrollTop+m.clientHeight&&!C&&A(H=>H+1)};j.useEffect(()=>(B.current&&B.current.addEventListener("scroll",Me),()=>{B.current&&B.current.removeEventListener("scroll",Me)}),[C]);const J=a==null?void 0:a.slice(0,D*W),Ge=m=>{E.put("/payment/payed/",{id:p,mode:m}).then(f=>{t(r.actions.handlePayed({id:p,data:f.data})),P(null)})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{sx:{position:"relative"},children:[e.jsx(ge,{component:De,sx:{maxHeight:"60vh"},ref:B,children:e.jsxs(be,{sx:{minWidth:700},children:[e.jsx(fe,{children:e.jsxs(I,{children:[e.jsx(u,{align:"left"}),e.jsx(u,{children:x(s.client.title)}),e.jsxs(u,{children:[x(s.paiment.amount)," ",x(s.global.mad)]}),e.jsx(u,{children:x(s.entrer.date)}),e.jsx(u,{children:x(s.paiment.typePayment)}),e.jsx(u,{children:x(s.paiment.isPayed)}),e.jsx(u,{})]})}),C?e.jsx(nt,{rowsNum:10}):e.jsx(Se,{children:(J==null?void 0:J.length)>0?J==null?void 0:J.map(m=>{const f=he[m.id]||!1;let H=new Date(m.date),te={year:H.getFullYear(),month:`${H.getMonth()+1}`,day:`${H.getDate()}`};const We=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(I,{hover:!0,children:[e.jsx(u,{children:m.payment_proof.length!==0&&e.jsx(_,{"aria-label":"expand row",size:"small",onClick:()=>Fe(m.id),children:f?e.jsx(ot,{}):e.jsx(rt,{})})}),e.jsxs(u,{children:[m.client_f_n," ",m.client_l_n]}),e.jsx(u,{sx:{direction:"initial",whiteSpace:"nowrap"},children:We.format(m.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(u,{children:[" ",te.day.padStart(2,0),"/",te.month.padStart(2,0),"/",te.year]}),e.jsx(u,{children:ee[m.mode-1]}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx(F,{id:"basic-button","aria-controls":N?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":N?"true":void 0,onClick:M=>Te(M,m.id),color:m.payed==1?"success":m.payed==2?"warning":"error",sx:{"&:disabled":{color:M=>M.palette.success.dark}},disabled:m.mode==1||m.mode==2,children:w[Number(m.payed)-1].text}),(m.payed==3||m.history)&&e.jsx(_,{color:"success",onClick:()=>re(m.id,"paimentHistory"),children:e.jsx(k,{children:e.jsx(Ke,{path:Ue,size:1})})}),e.jsx(we,{id:"basic-menu",anchorEl:X,open:N,onClose:Ie,MenuListProps:{"aria-labelledby":"basic-button"},children:w.map((M,je)=>e.jsx(U,{onClick:Ot=>Ge(M.mode),children:M.text},je))})]})}),e.jsxs(u,{children:[e.jsx(_,{color:"warning",onClick:()=>re(m.id,"update"),children:e.jsx(k,{children:e.jsx($e,{})})}),e.jsx(_,{color:"error",onClick:()=>re(m.id,"delete"),children:e.jsx(k,{children:e.jsx(it,{})})}),m.payment_proof.length!==4&&e.jsx(_,{color:"success",onClick:()=>re(m.id,"upload"),children:e.jsx(k,{children:e.jsx(et,{})})})]})]},m.id),e.jsx(I,{children:e.jsx(u,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(ke,{in:f,timeout:"auto",unmountOnExit:!0,children:e.jsx(ge,{sx:{width:"100%"},component:De,children:e.jsxs(be,{sx:{width:"100%"},children:[e.jsx(fe,{children:e.jsxs(I,{children:[e.jsx(u,{children:x(s.paiment.fileName)}),e.jsx(u,{})]})}),e.jsx(Se,{children:m.payment_proof.map((M,je)=>e.jsxs(I,{children:[e.jsx(u,{children:M.file.replace("http://192.168.1.100:80/api".replace("/api","")+"/uploads/","")}),e.jsxs(u,{children:[" ",e.jsx(_,{color:"inherit",onClick:()=>{t(r.actions.openCloseConfirmDeleteProof()),t(r.actions.setCurrentData({id:m.id,idFile:M.id}))},children:e.jsx(k,{children:e.jsx(tt,{})})}),e.jsx(_,{color:"secondary",onClick:()=>{ve({file:M.file,extension:M.extension}),z(!0)},children:e.jsx(k,{children:e.jsx(Ze,{})})})]})]},je))})]})})})})})]})}):e.jsx(I,{children:e.jsx(u,{colSpan:8,sx:{textAlign:"center"},children:x(s.batiment.nothingToDisplay)})})})]})}),v&&e.jsx(at,{})]}),o&&e.jsx(ze,{isModalUpload:o,close:()=>g(!1)}),oe&&e.jsx(st,{isPreview:oe,close:()=>z(!1),file:Ce})]})});function pt({clients:i}){ae.locale("fr");const{t:c,i18n:a}=O(),n=T(),l=ue({initialValues:{date1:null,date2:null,client:""},validationSchema:pe({date1:Ee().nullable().test("is-before-date2",c(s.global.date2Greather),function(d){const{date2:h}=this.parent;return d<=h}),date2:Ee().nullable().test("is-after-date1",c(s.global.date2Greather),function(d){const{date1:h}=this.parent;return d>=h})}),onSubmit:async(d,{resetForm:h,setErrors:S})=>{let C="";for(let v in d)if(d[v]!==""&&d[v]!==null){let t=new Date(d[v]),D=t.getFullYear()!==1970?`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`:d[v];C==""?C+=`?${v}=${D}`:C+=`&${v}=${D}`}E.get("/payment/list/"+C).then(v=>{n(r.actions.fetchPaiment(v.data))})},onReset:()=>{E.get("/payment/list/").then(d=>{n(r.actions.fetchPaiment(d.data))})}});return e.jsx(Re,{children:e.jsx(lt,{children:e.jsx("form",{noValidate:!0,onSubmit:l.handleSubmit,onReset:l.handleReset,children:e.jsxs(V,{container:!0,alignItems:"center",gap:2,children:[e.jsx(V,{item:!0,xs:12,md:5,sm:12,children:e.jsxs($,{fullWidth:!0,children:[e.jsx(q,{id:"batiment-id",size:"small",children:c(s.client.title)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:l.handleBlur,fullWidth:!0,name:"client",size:"small",onChange:l.handleChange,value:l.values.client,label:c(s.client.title),children:i==null?void 0:i.map(d=>e.jsxs(U,{value:d.id,children:[d.first_name," ",d.last_name]}))})]})}),e.jsx(V,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Q,{value:l.values.date1,onChange:d=>l.setFieldValue("date1",d),onBlur:l.handleBlur,label:c(s.global.date1),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",size:"small",error:!!(l.touched.date1&&l.errors.date1),helperText:l.touched.date1&&l.errors.date1}}})}),e.jsx(V,{item:!0,xs:12,md:2,sm:12,children:e.jsx(Q,{value:l.values.date2,onChange:d=>l.setFieldValue("date2",d),onBlur:l.handleBlur,label:c(s.global.date2),name:"date",sx:{width:"100%"},slotProps:{textField:{variant:"outlined",size:"small",error:!!(l.touched.date2&&l.errors.date2),helperText:l.touched.date2&&l.errors.date2}}})}),e.jsxs(V,{item:!0,container:!0,xs:12,md:12,sm:12,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(V,{items:!0,children:e.jsx(F,{variant:"contained",type:"reset",children:c(s.global.reset)})}),e.jsx(V,{items:!0,children:e.jsx(F,{type:"submit",variant:"contained",children:c(s.global.filter)})})]})]})})})})}function ht(){const i=T(),{t:c,i18n:a}=O(),{paiment:n}=G(h=>h.paiment),l=ie("paiment",le.getPaiments),d=ie("clients",le.getClientSelect);return j.useEffect(()=>{l.status=="success"&&i(r.actions.fetchPaiment(l.data))},[l.status]),e.jsxs(Y,{spacing:4,children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(Y,{spacing:1,children:e.jsx(ne,{variant:"h4",children:c(s.paiment.title)})}),e.jsx(Y,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(F,{startIcon:e.jsx(k,{children:e.jsx(qe,{})}),variant:"contained",onClick:()=>i(r.actions.openCloseModalAdd()),children:c(s.global.ajouter)})})]}),e.jsxs(Re,{children:[e.jsx(pt,{clients:d.data}),e.jsx(ut,{items:n,count:n.length,rowsPerPage:25,isLoading:l.isLoading,isError:l.isError})]})]})}const xt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function Ct({clients:i,paimentModes:c}){const a=T(),{t:n,i18n:l}=O();JSON.parse(sessionStorage.getItem("user"));const{currentData:d,isModalUpdate:h,isConfirm:S}=G(o=>o.paiment),C=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],v=pe({client:L().required(n(s.sortie.clientRequired)),amount:L().required(n(s.paiment.amountRequired)),mode:L().required(n(s.paiment.typePaymentRequired))}),t=ue({initialValues:{client:"",amount:"",mode:"",date:new Date},validationSchema:v,onSubmit:async(o,{resetForm:g,setErrors:W})=>{const y={...o};console.log(o),y.date=ae(o.date).format("YYYY-MM-DD"),E.put("/payment/update/",y).then(x=>{a(r.actions.editPaiment(x.data)),a(r.actions.openCloseModalUpdate()),a(r.actions.openCloseConfirm()),R.success(n(s.paiment.toastUpdateSuccess)),g()}).catch(x=>{a(r.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),D=async o=>{o.preventDefault();const g=await t.validateForm();Object.keys(g).length===0?a(r.actions.openCloseConfirm()):await t.submitForm()},A=()=>{t.handleSubmit()};return j.useEffect(()=>{let o={...d};o.date=new Date(o.date),t.setValues(o)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:h,onClose:()=>a(r.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ce,{sx:xt,children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(ne,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.update)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(r.actions.openCloseModalUpdate()),children:e.jsx(me,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>D(o),children:[e.jsxs($,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.client&&t.errors.client),children:[e.jsx(q,{id:"batiment-id",children:n(s.client.title)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"client",onChange:t.handleChange,value:t.values.client,label:n(s.client.title),children:i.map(o=>e.jsxs(U,{value:o.id,children:[o.first_name," ",o.last_name]}))}),t.touched.client&&t.errors.client&&e.jsx(se,{children:t.errors.client})]}),e.jsxs($,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(q,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:c.map(o=>e.jsx(U,{value:o.id,children:C[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(se,{children:t.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Q,{label:n(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(F,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(Pe,{confirmed:A,cancel:()=>a(r.actions.openCloseConfirm()),isConfirm:S})]})}const vt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function jt({clients:i,paimentModes:c}){const a=T(),{t:n,i18n:l}=O();JSON.parse(sessionStorage.getItem("user"));const{paiment:d,isModalAdd:h,isConfirm:S}=G(o=>o.paiment),C=[n(s.paiment.espece),n(s.paiment.virment),n(s.paiment.cheque),n(s.paiment.lcn)],v=pe({client:L().required(n(s.sortie.clientRequired)),amount:L().required(n(s.paiment.amountRequired)),mode:L().required(n(s.paiment.typePaymentRequired))}),t=ue({initialValues:{client:"",amount:"",mode:"",date:new Date},validationSchema:v,onSubmit:async(o,{resetForm:g,setErrors:W})=>{const y={...o};y.date=ae(o.date).format("YYYY-MM-DD"),E.post("/payment/add/",y).then(x=>{a(r.actions.addPaiment(x.data)),a(r.actions.openCloseModalAdd()),a(r.actions.openCloseConfirm()),R.success(n(s.paiment.toastAddSuccess)),g()}).catch(x=>{a(r.actions.openCloseConfirm()),R.error(n(s.global.toastError))})}}),D=async o=>{o.preventDefault();const g=await t.validateForm();Object.keys(g).length===0?a(r.actions.openCloseConfirm()):await t.submitForm()},A=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:h,onClose:()=>a(r.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ce,{sx:vt,children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(ne,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>a(r.actions.openCloseModalAdd()),children:e.jsx(me,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>D(o),children:[e.jsxs($,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.client&&t.errors.client),children:[e.jsx(q,{id:"batiment-id",children:n(s.client.title)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"client",onChange:t.handleChange,value:t.values.client,label:n(s.client.title),children:i.length>0?i.map(o=>e.jsxs(U,{value:o.id,children:[o.first_name," ",o.last_name]})):e.jsx(U,{children:n(s.batiment.nothingToDisplay)})}),t.touched.client&&t.errors.client&&e.jsx(se,{children:t.errors.client})]}),e.jsxs($,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(q,{id:"batiment-id",children:n(s.paiment.typePayment)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:n(s.paiment.typePayment),children:c.map(o=>e.jsx(U,{value:o.id,children:C[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(se,{children:t.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Q,{label:n(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(F,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(Pe,{confirmed:A,cancel:()=>a(r.actions.openCloseConfirm()),isConfirm:S})]})}function Dt(){const{currentData:i,isModalDelete:c}=G(h=>h.paiment),a=T(),{t:n,i18n:l}=O();JSON.parse(sessionStorage.getItem("user"));const d=()=>{E.delete(`/payment/delete/${i.id}`).then(h=>{a(r.actions.deletePaiment()),a(r.actions.openCloseModalDelete()),R.success(n(s.paiment.toastDeleteSuccess))}).catch(h=>{a(r.actions.openCloseModalDelete()),R.error(n(s.global.toastError))})};return e.jsx(Z,{open:c,onClose:()=>a(r.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(_e,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:d,cancel:()=>a(r.actions.openCloseModalDelete())})})}function gt(){const{currentData:i,isModalDeleteProof:c}=G(h=>h.paiment),a=T(),{t:n,i18n:l}=O(),d=()=>{E.delete(`/payment/proof/delete/${i.idFile}`).then(h=>{a(r.actions.deletePaimentProof()),a(r.actions.openCloseConfirmDeleteProof()),R.success(n(s.global.toastSuccessDeleteFile))}).catch(h=>{a(r.actions.openCloseConfirmDeleteProof()),R.error(n(s.global.toastError))})};return e.jsx(Z,{open:c,onClose:()=>a(r.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(_e,{title:n(s.paiment.deleteTitleFile),message:n(s.paiment.deleteDescriptionFile),deleteFn:d,cancel:()=>a(r.actions.openCloseConfirmDeleteProof())})})}function bt({isOpen:i,close:c,handleDelete:a}){const{t:n,i18n:l}=O();return e.jsx(Z,{open:i,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(_e,{title:n(s.paiment.deleteTitle),message:n(s.paiment.deleteDescription),deleteFn:a,cancel:c})})}function ft(){const{t:i,i18n:c}=O(),{currentData:a}=G(p=>p.paiment),[n,l]=j.useState(),d=T(),[h,S]=j.useState(!1),[C,v]=j.useState(!1),[t,D]=j.useState(),A=[{mode:1,text:i(s.global.oui)},{mode:2,text:i(s.global.enCours)},{mode:3,text:i(s.global.echec)}],o=[i(s.paiment.espece),i(s.paiment.virment),i(s.paiment.cheque),i(s.paiment.lcn)],[g,W]=j.useState(null),y=!!g,x=(p,b)=>{l(b),W(p.currentTarget)},Oe=()=>{W(null)},he=p=>{E.put("/payment/payedcorrection/",{id:n,mode:p}).then(b=>{d(r.actions.handlePayedCorrection({id:n,data:b.data})),W(null)})},xe=(p,b)=>{D(b),S(!0),l(p)},oe=p=>{v(!0),l(p)},z=p=>{const b=p.target.name;D(b?w=>({...w,date:new Date(w.date),[b]:Number(p.target.value)}):w=>({...w,date:new Date(w.date)}))},Ce=()=>{let p={...t,date:ae(t.date).format("YYYY-MM-DD")};E.put("/payment/updatecorrection/",p).then(b=>{d(r.actions.handlePayedCorrection({id:n,data:b.data})),S(!1)})},ve=()=>{E.delete(`/payment/deletecorrection/${n}`).then(p=>{d(r.actions.deletePaimentHistory()),v(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{sx:{position:"relative"},children:e.jsx(ge,{component:De,children:e.jsxs(be,{sx:{minWidth:700},children:[e.jsx(fe,{children:e.jsxs(I,{children:[e.jsxs(u,{children:[i(s.paiment.amount)," ",i(s.global.mad)]}),e.jsx(u,{children:i(s.entrer.date)}),e.jsx(u,{children:i(s.paiment.typePayment)}),e.jsx(u,{children:i(s.paiment.isPayed)}),e.jsx(u,{})]})}),e.jsx(Se,{children:a.payment_correction.map((p,b)=>{const w=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});let ee=new Date(p.date),X={year:ee.getFullYear(),month:`${ee.getMonth()+1}`,day:`${ee.getDate()}`};return!h||a.payment_correction.length-1!==b?e.jsxs(I,{children:[e.jsxs(u,{sx:{direction:"initial"},children:[" ",w.format(p.amount).replaceAll(","," ").replace("MAD","")]}),e.jsxs(u,{children:[" ",X.day.padStart(2,0),"/",X.month.padStart(2,0),"/",X.year]}),e.jsx(u,{children:o[p.mode-1]}),e.jsxs(u,{children:[" ",e.jsxs("div",{children:[e.jsx(F,{id:"basic-button","aria-controls":y?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":y?"true":void 0,onClick:P=>x(P,p.id),color:p.payed==1?"success":p.payed==2?"warning":"error",sx:{"&:disabled":{color:P=>P.palette.success.dark}},disabled:p.mode==1||p.mode==2?!0:b==0,children:A[Number(p.payed)-1].text}),p.payed==3&&e.jsx(_,{color:"success",onClick:()=>openModal(p.id,"paimentHistory"),children:e.jsx(k,{children:e.jsx(Xe,{path:Ue,size:1})})}),e.jsx(we,{id:"basic-menu",anchorEl:g,open:y,onClose:Oe,MenuListProps:{"aria-labelledby":"basic-button"},children:A.map((P,N)=>e.jsx(U,{onClick:B=>he(P.mode),children:P.text},N))})]})]}),a.payment_correction.length-1==b&&b!==0&&e.jsxs(u,{children:[e.jsx(_,{color:"error",onClick:()=>oe(p.id),children:e.jsx(dt,{})}),e.jsx(_,{color:"warning",onClick:()=>xe(p.id,p),children:e.jsx(ct,{})})]})]}):e.jsxs(I,{children:[e.jsx(u,{sx:{direction:"initial"},children:e.jsx(de,{value:t.amount,fullWidth:!0,label:i(s.paiment.amount),type:"number",name:"amount",onChange:z})}),e.jsxs(u,{children:[" ",e.jsx(Q,{value:new Date(t.date),name:"date",onChange:z,label:i(s.entrer.date)})]}),e.jsx(u,{children:e.jsxs($,{fullWidth:!0,children:[e.jsx(q,{id:"demo-simple-select-label",children:i(s.paiment.typePayment)}),e.jsx(K,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:t.mode,label:i(s.paiment.typePayment),onChange:z,name:"mode",children:o.map((P,N)=>e.jsx(U,{value:N+1,children:P}))})]})}),e.jsxs(u,{children:[e.jsx(_,{color:"success",onClick:Ce,children:e.jsx(mt,{})}),e.jsx(_,{color:"error",onClick:()=>S(!1),children:e.jsx(Je,{})})]})]})})})]})})}),e.jsx(bt,{isOpen:C,close:()=>v(!1),handleDelete:ve})]})}function St(){const i=T(),c=Le(),{t:a}=O(),{currentData:n,isModalHistory:l}=G(C=>C.paiment),d=Ne(c.breakpoints.down("md")),[h,S]=j.useState(!0);return j.useEffect(()=>{let C=n.payment_correction[0].amount;n.payment_correction.slice(1,n.payment_correction.length).reduce((t,D)=>D.payed==1?t+D.amount:t,0)>=C&&S(!1)},[n]),e.jsxs(Be,{onClose:()=>i(r.actions.openCloseModalHistory()),fullScreen:d,open:l,maxWidth:"lg",children:[e.jsxs(Qe,{sx:{m:0,p:2.5},id:"customized-dialog-title",children:[a(s.paiment.titleHistory)," ",n.client_f_n," ",n.client_l_n]}),e.jsx(_,{"aria-label":"close",onClick:()=>i(r.actions.openCloseModalHistory()),sx:C=>({position:"absolute",right:8,top:8,color:C.palette.grey[500]}),children:e.jsx(me,{})}),e.jsxs(He,{children:[e.jsxs(Ve,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:1.5,children:[e.jsx(ne,{variant:"h6"}),h&&e.jsx(F,{variant:"contained",onClick:()=>i(r.actions.openCloseModalAddHistory()),children:a(s.global.ajouter)})]}),e.jsx(ft,{})]})]})}const yt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function _t({paimentModes:i}){const c=T(),{t:a,i18n:n}=O(),l=[a(s.paiment.espece),a(s.paiment.virment),a(s.paiment.cheque),a(s.paiment.lcn)],{paiment:d,isModalAddHistory:h,currentData:S,isConfirm:C}=G(o=>o.paiment),v=pe({amount:L().required(a(s.paiment.amountRequired)),mode:L().required(a(s.paiment.typePaymentRequired))}),t=ue({initialValues:{amount:"",mode:"",date:new Date,payment:S.id},validationSchema:v,onSubmit:async(o,{resetForm:g,setErrors:W})=>{const y={...o};y.date=ae(o.date).format("YYYY-MM-DD"),E.post("/payment/addcorrection/",y).then(x=>{c(r.actions.addPaimentHistory(x.data)),c(r.actions.openCloseModalAddHistory()),c(r.actions.openCloseConfirm()),R.success(a(s.paiment.toastAddSuccess)),g()}).catch(x=>{c(r.actions.openCloseConfirm()),R.error(a(s.global.toastError))})}}),D=async o=>{o.preventDefault();const g=await t.validateForm();Object.keys(g).length===0?c(r.actions.openCloseConfirm()):await t.submitForm()},A=()=>{t.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{open:h,onClose:()=>c(r.actions.openCloseModalAddHistory()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(ce,{sx:yt,children:[e.jsxs(Y,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(ne,{id:"modal-modal-title",variant:"h6",component:"h2",children:a(s.paiment.add)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>c(r.actions.openCloseModalAddHistory()),children:e.jsx(me,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:o=>D(o),children:[e.jsxs($,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(t.touched.mode&&t.errors.mode),children:[e.jsx(q,{id:"batiment-id",children:a(s.paiment.typePayment)}),e.jsx(K,{labelId:"batiment-id",id:"demo-simple-select",onBlur:t.handleBlur,fullWidth:!0,name:"mode",onChange:t.handleChange,value:t.values.mode,label:a(s.paiment.typePayment),children:i.map(o=>e.jsx(U,{value:o.id,children:l[o.id-1]}))}),t.touched.mode&&t.errors.mode&&e.jsx(se,{children:t.errors.mode})]}),e.jsx(de,{id:"outlined-basic",label:a(s.paiment.amount),variant:"outlined",onBlur:t.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:t.handleChange,value:t.values.amount,error:!!(t.touched.amount&&t.errors.amount),helperText:t.touched.amount&&t.errors.amount,style:{marginBottom:"15px"}}),e.jsx(Q,{label:a(s.entrer.date),value:t.values.date,onChange:o=>t.setFieldValue("date",o),onBlur:t.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(F,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:a(s.global.ajouter)})]})]})}),e.jsx(Pe,{confirmed:A,cancel:()=>c(r.actions.openCloseConfirm()),isConfirm:C})]})}function Pt(){const{isModalAdd:i,isModalUpdate:c,isModalHistory:a,isModalAddHistory:n}=G(h=>h.paiment),l=ie("clients",le.getClientSelect),d=ie("paimentsMode",le.paymentMode);return e.jsxs(ce,{component:"main",sx:{flexGrow:1,p:3},children:[e.jsx(ye,{children:e.jsx(ht,{})}),i&&e.jsx(jt,{clients:l.data,paimentModes:d.data}),c&&e.jsx(Ct,{clients:l.data,paimentModes:d.data}),n&&e.jsx(_t,{paimentModes:d.data}),e.jsx(Dt,{}),e.jsx(gt,{}),a&&e.jsxs(ye,{children:[" ",e.jsx(St,{})]})]})}function $t(){const{t:i,i18n:c}=O();return e.jsxs("div",{children:[e.jsx(Ye,{title:`ESM | ${i(s.nav.Paiment)}`}),e.jsx(ye,{children:e.jsx(Pt,{})})]})}export{$t as default};
