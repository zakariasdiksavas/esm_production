import{a2 as U,at as Pe,a6 as M,d as w,r as D,j as e,a7 as k,X as Oe,l as s,a1 as A,a as N,h as R,bH as r,Y as j,an as Ee,T as Y,B as Ae,a3 as ae,V as G,al as Ue,k as ce,ab as pe,ac as me,ad as ue,ae as V,F as he}from"./index-b9aeea20.js";import{E as we,P as ye,M as xe}from"./ModalDelete-e666945f.js";import{u as Me,C as Re,T as Te}from"./index-75d71bb2.js";import{B as K,j as Fe,e as oe,T as re,a as ie,b as F,c as v,d as le,f as Ie,g as Q,G as I,u as Ce,S as L,h as Ge,E as Le}from"./moment-8bb476e3.js";import{C as X,T as Ne}from"./TableRowsLoader-c4300d5c.js";import{E as We}from"./Eye-bd865af3.js";import{A as ke,K as Be,a as He}from"./KeyboardArrowUp-80820a8c.js";import{A as Ve}from"./AlertError-9fdceddd.js";import{D as $e}from"./DeleteOutlineOutlined-7644538f.js";import{A as Ye}from"./Add-94c13e39.js";import{u as ee,c as se,e as de,C as De,b as Ke,d as ve,a as ge}from"./formik.esm-799b94e8.js";import{A as Xe,a as ze,F as qe,b as Je}from"./fr-3088b82b.js";import{E as Ze}from"./ExpandMore-6e3ae782.js";import{D as $}from"./DatePicker-05f47eec.js";import{C as Qe}from"./Container-7ef0f39f.js";import{M as fe}from"./ModalConfirm-37aae7aa.js";const es=i=>({position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",boxShadow:24,p:4,[i.breakpoints.down("md")]:{width:"95%"}}),ss=["application/pdf","image/jpg","image/jpeg","image/png"];function ns({isModalUpload:i,close:o,isFournisseur:n}){var B;const t=U(),m=Pe(),{currentData:l}=M(x=>x.divers),{t:c,i18n:d}=w(),[a,g]=D.useState([]),[u,p]=D.useState(4-((B=l==null?void 0:l.expenses_proof)==null?void 0:B.length)-a.length),[S,_]=D.useState(!1),{acceptedFiles:P,getRootProps:O,getInputProps:z}=Me({onDrop:(x,C)=>{var E;if(C.length>0){if(C[0].errors[0].code=="too-many-files"){j.error(c(s.paiment.uploadLimitFile)+` ${4-((E=l==null?void 0:l.expenses_proof)==null?void 0:E.length)}`);return}else if(C[0].errors[0].code=="file-invalid-type"){j.error(c(s.paiment.fileSupported));return}j.error(C[0].errors[0].message)}g(T=>[...T,...x])},multiple:!0,maxFiles:u,validator:q,accept:{"application/pdf":[],"image/jpeg":[],"image/jpg":[],"image/png":[]}}),b=()=>{_(!0);const x=new FormData;x.append("id",l.id),a.map(C=>{x.append("files",C)}),R.post("/otherexpenses/proof/add/",x).then(C=>{t(r.actions.addProofDivers(C.data)),j.success(c(s.paiment.toastUploadFile)),_(!1),o(),g([])})},ne=x=>{const C=a.findIndex(T=>T.path==x),E=a.filter((T,J)=>J!==C);g(E)};function q(x){var E;if(!ss.includes(x.type))return{code:"extension-supported",message:c(s.paiment.fileSupported)};const C=5*1024*1024;return x.size>C?{code:"max-size",message:c(s.paiment.uploadMaxSize)}:u<=0?{code:"max-file",message:`${c(s.paiment.uploadLimitFile)} ${4-((E=l==null?void 0:l.expenses_proof)==null?void 0:E.length)}`}:null}return D.useEffect(()=>{var x;a.length>0&&p(4-((x=l==null?void 0:l.expenses_proof)==null?void 0:x.length)-a.length)},[a.length]),e.jsx(e.Fragment,{children:e.jsx(k,{open:i,onClose:o,children:e.jsxs(K,{sx:es(m),children:[S&&e.jsx(Oe,{}),e.jsx("h3",{className:"text-center font-semibold text-lg",children:c(s.paiment.uploadTitle)}),e.jsxs("div",{className:"flex flex-col items-center my-4 border-2 border-dashed border-purple-500 p-4",...O(),children:[e.jsx("input",{...z()}),e.jsx(Re,{color:"primary",fontSize:"large"}),e.jsx("p",{children:c(s.paiment.uploadTitle)}),e.jsxs("p",{children:[c(s.paiment.uploadMessage)," PNG, JPG, JPEG, PDF"]})]}),e.jsx("div",{children:a.map((x,C)=>e.jsxs("p",{children:[x.path," ",e.jsx(A,{onClick:()=>ne(x.path),children:e.jsx(X,{color:"error"})})]},C))}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{onClick:b,variant:"contained",color:"primary",children:c(s.paiment.upload)})})]})})})}function ts({close:i,isPreview:o,file:n}){const[t,m]=D.useState(null);return D.useEffect(()=>(console.log(n),(async()=>{try{console.log(n.file);const c=await R.get(n.file,{responseType:"blob"}),d=URL.createObjectURL(c.data);console.log(d),m(d)}catch(c){console.error("Error fetching PDF:",c)}})(),()=>{t&&URL.revokeObjectURL(t)}),[]),e.jsxs(Ee,{fullScreen:!0,open:o,children:[e.jsx(ke,{sx:{position:"relative"},children:e.jsxs(Fe,{children:[e.jsx(A,{edge:"start",color:"inherit","aria-label":"close",onClick:()=>i(),children:e.jsx(X,{})}),e.jsx(Y,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Preview File"})]})}),e.jsx("iframe",{src:t,height:"100%"})]})}const as=D.memo(i=>{const o=U();let{count:n=0,items:t=[],onDeselectAll:m,onDeselectOne:l,onSelectAll:c,onSelectOne:d,selected:a=[],isLoading:g,isError:u}=i;const[p,S]=D.useState(0),[_,P]=D.useState(!1),[O,z]=D.useState(25),{t:b,i18n:ne}=w(),[q,B]=D.useState({}),[x,C]=D.useState(!1),[E,T]=D.useState();D.useState(),D.useState(null);const J=h=>{B(f=>({...f,[h]:!f[h]}))},Z=(h,f)=>{const y=t.filter(W=>W.id==h);o(r.actions.setCurrentData(y[0])),f=="update"?o(r.actions.openCloseModalUpdate()):f=="delete"?o(r.actions.openCloseModalDelete()):P(!0)},je=(h,f)=>{S(f)},Se=h=>{z(parseInt(h.target.value,10)),S(0)},te=t==null?void 0:t.slice(p*O,p*O+O);return e.jsxs(e.Fragment,{children:[e.jsxs(Ae,{sx:{position:"relative"},children:[e.jsx(oe,{component:ae,children:e.jsxs(re,{sx:{minWidth:700},children:[e.jsx(ie,{children:e.jsxs(F,{children:[e.jsx(v,{align:"left"}),e.jsxs(v,{children:[b(s.paiment.amount)," ",b(s.global.mad)]}),e.jsx(v,{children:b(s.entrer.date)}),e.jsx(v,{children:b(s.depense.addlabel)}),e.jsx(v,{})]})}),g?e.jsx(Ne,{rowsNum:10}):e.jsx(le,{children:te.length>0?te.map(h=>{const f=q[h.id]||!1;let y=new Date(h.date),W={year:y.getFullYear(),month:`${y.getMonth()+1}`,day:`${y.getDate()}`};const be=new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"});return e.jsxs(e.Fragment,{children:[e.jsxs(F,{hover:!0,children:[e.jsx(v,{sx:{width:"5%"},children:h.expenses_proof.length!==0&&e.jsx(A,{"aria-label":"expand row",size:"small",onClick:()=>J(h.id),children:f?e.jsx(Be,{}):e.jsx(He,{})})}),e.jsx(v,{sx:{direction:"initial",whiteSpace:"nowrap"},children:be.format(h.amount).replaceAll(","," ").replace("MAD","")}),e.jsxs(v,{children:[" ",W.day.padStart(2,0),"/",W.month.padStart(2,0),"/",W.year]}),e.jsx(v,{children:h.type_name}),e.jsxs(v,{children:[e.jsx(A,{color:"warning",onClick:()=>Z(h.id,"update"),children:e.jsx(G,{children:e.jsx(we,{})})}),e.jsx(A,{color:"error",onClick:()=>Z(h.id,"delete"),children:e.jsx(G,{children:e.jsx($e,{})})}),h.expenses_proof.length!==4&&e.jsx(A,{color:"success",onClick:()=>Z(h.id,"upload"),children:e.jsx(G,{children:e.jsx(Ye,{})})})]})]},h.id),e.jsx(F,{children:e.jsx(v,{style:{paddingBottom:0,paddingTop:0},colSpan:8,children:e.jsx(Ue,{in:f,timeout:"auto",unmountOnExit:!0,children:e.jsx(oe,{sx:{width:"100%"},component:ae,children:e.jsxs(re,{sx:{width:"100%"},children:[e.jsx(ie,{children:e.jsxs(F,{children:[e.jsx(v,{children:b(s.paiment.fileName)}),e.jsx(v,{})]})}),e.jsx(le,{children:h.expenses_proof.map((H,_e)=>e.jsxs(F,{children:[e.jsx(v,{children:H.file.replace("http://192.168.1.97:8000/api".replace("/api","")+"/uploads/","")}),e.jsxs(v,{children:[" ",e.jsx(A,{color:"inherit",onClick:()=>{o(r.actions.openCloseConfirmDeleteProof()),o(r.actions.setCurrentData({id:h.id,idFile:H.id}))},children:e.jsx(G,{children:e.jsx(Te,{})})}),e.jsx(A,{color:"secondary",onClick:()=>{T({file:H.file,extension:H.extension}),C(!0)},children:e.jsx(G,{children:e.jsx(We,{})})})]})]},_e))})]})})})})})]})}):e.jsx(F,{children:e.jsx(v,{colSpan:5,sx:{textAlign:"center"},children:b(s.batiment.nothingToDisplay)})})})]})}),e.jsx(Ie,{component:"div",count:n,onPageChange:je,onRowsPerPageChange:Se,page:p,rowsPerPage:O,rowsPerPageOptions:[5,10,25],labelRowsPerPage:b(s.batiment.Lignes),labelDisplayedRows:({from:h,to:f,count:y})=>`${h}â€“${f} ${b(s.batiment.sur)} ${y}`}),u&&e.jsx(Ve,{})]}),_&&e.jsx(ns,{isModalUpload:_,close:()=>P(!1)}),x&&e.jsx(ts,{isPreview:x,close:()=>C(!1),file:E})]})});function os(){Q.locale("fr");const{t:i,i18n:o}=w(),n=U(),t=ee({initialValues:{date1:null,date2:null,client:""},validationSchema:se({date1:de().nullable().test("is-before-date2",i(s.global.date2Greather),function(m){const{date2:l}=this.parent;return m<=l}),date2:de().nullable().test("is-after-date1",i(s.global.date2Greather),function(m){const{date1:l}=this.parent;return m>=l})}),onSubmit:async(m,{resetForm:l,setErrors:c})=>{let d="";for(let a in m)if(m[a]!==""&&m[a]!==null){let g=new Date(m[a]),u=`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`;d==""?d+=`?${a}=${u}`:d+=`&${a}=${u}`}n(r.actions.setLink(d))},onReset:()=>{n(r.actions.setLink(""))}});return e.jsxs(Xe,{defaultExpanded:!0,children:[e.jsx(ze,{expandIcon:e.jsx(Ze,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsxs("h3",{className:"font-bold text-lg",children:[e.jsx(qe,{}),i(s.global.filter)]})}),e.jsx(Je,{children:e.jsx(De,{children:e.jsx(Ke,{children:e.jsx("form",{noValidate:!0,onSubmit:t.handleSubmit,onReset:t.handleReset,children:e.jsxs(I,{container:!0,alignItems:"center",gap:2,children:[e.jsx(I,{item:!0,xs:12,md:4,children:e.jsx($,{value:t.values.date1,onChange:m=>t.setFieldValue("date1",m),onBlur:t.handleBlur,label:i(s.global.date1),name:"date",slotProps:{textField:{variant:"outlined",error:!!(t.touched.date1&&t.errors.date1),helperText:t.touched.date1&&t.errors.date1}},sx:{width:"100%"}})}),e.jsx(I,{item:!0,xs:12,md:4,children:e.jsx($,{value:t.values.date2,onChange:m=>t.setFieldValue("date2",m),onBlur:t.handleBlur,label:i(s.global.date2),name:"date",slotProps:{textField:{variant:"outlined",error:!!(t.touched.date2&&t.errors.date2),helperText:t.touched.date2&&t.errors.date2}},sx:{width:"100%"}})}),e.jsxs(I,{item:!0,container:!0,xs:12,md:3,gap:2,sx:{alignContent:"center",justifyContent:"end"},children:[e.jsx(I,{items:!0,children:e.jsx(N,{variant:"contained",type:"reset",children:i(s.global.reset)})}),e.jsx(I,{items:!0,children:e.jsx(N,{type:"submit",variant:"contained",children:i(s.global.filter)})})]})]})})})})})]})}function rs(){const i=U(),{t:o,i18n:n}=w(),{divers:t,link:m}=M(c=>c.divers),l=Ce(["divers",m],()=>Ge.fetchDivers(m));return D.useEffect(()=>{l.status=="success"&&i(r.actions.fetchDivers(l.data))},[l.status,m]),e.jsx(Qe,{maxWidth:"xl",children:e.jsxs(L,{spacing:4,children:[e.jsxs(L,{direction:"row",justifyContent:"space-between",spacing:4,children:[e.jsx(L,{spacing:1,children:e.jsx(Y,{variant:"h4",children:o(s.divers.title)})}),e.jsx(L,{alignItems:"center",direction:"row",spacing:3,children:e.jsx(N,{startIcon:e.jsx(G,{children:e.jsx(ye,{})}),variant:"contained",onClick:()=>i(r.actions.openCloseModalAdd()),children:o(s.global.ajouter)})})]}),e.jsxs(De,{children:[e.jsx(os,{}),e.jsx(as,{items:t,count:t.length,rowsPerPage:25,isLoading:l.isLoading,isError:l.isError})]})]})})}const is={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ls({typeDepense:i}){const o=U(),{t:n,i18n:t}=w(),{currentData:m,isModalUpdate:l,isConfirm:c}=M(p=>p.divers),d=se({amount:ve().required(n(s.paiment.amountRequired)),type:ge().required()}),a=ee({initialValues:{amount:0,type:"",date:new Date},validationSchema:d,onSubmit:async(p,{resetForm:S,setErrors:_})=>{const P={...p};P.date=Q(p.date).format("YYYY-MM-DD"),R.put("/otherexpenses/update/",P).then(O=>{o(r.actions.editDivers(O.data)),o(r.actions.openCloseModalUpdate()),o(r.actions.openCloseConfirm()),j.success(n(s.divers.toastUpdateSuccess)),S()}).catch(O=>{o(r.actions.openCloseConfirm()),j.error(n(s.global.toastError))})}}),g=async p=>{p.preventDefault();const S=await a.validateForm();console.log(S),Object.keys(S).length===0?o(r.actions.openCloseConfirm()):await a.submitForm()},u=()=>{a.handleSubmit()};return D.useEffect(()=>{const p={...m};p.date=new Date(p.date),a.setValues(p)},[]),e.jsxs(e.Fragment,{children:[e.jsx(k,{open:l,onClose:()=>o(r.actions.openCloseModalUpdate()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(K,{sx:is,children:[e.jsxs(L,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(Y,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.divers.updateTitle)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(r.actions.openCloseModalUpdate()),children:e.jsx(X,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:p=>g(p),children:[e.jsx(ce,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:a.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:a.handleChange,value:a.values.amount,error:!!(a.touched.amount&&a.errors.amount),helperText:a.touched.amount&&a.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(pe,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(a.touched.type&&a.errors.type),children:[e.jsx(me,{id:"batiment-id",children:n(s.depense.addlabel)}),e.jsx(ue,{labelId:"batiment-id",id:"demo-simple-select",onBlur:a.handleBlur,fullWidth:!0,name:"type",onChange:a.handleChange,value:a.values.type,label:n(s.depense.addlabel),children:i.length>0?i.map(p=>e.jsx(V,{value:p.id,children:p.type})):e.jsx(V,{children:n(s.batiment.nothingToDisplay)})}),a.touched.type&&a.errors.type&&e.jsx(he,{children:a.errors.type})]}),e.jsx($,{label:n(s.entrer.date),value:a.values.date,onChange:p=>a.setFieldValue("date",p),onBlur:a.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(N,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.modifier)})]})]})}),e.jsx(fe,{confirmed:u,cancel:()=>o(r.actions.openCloseConfirm()),isConfirm:c})]})}const ds={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function cs({typeDepense:i}){const o=U(),{t:n,i18n:t}=w(),{isModalAdd:m,isConfirm:l}=M(u=>u.divers),c=se({amount:ve().required(n(s.paiment.amountRequired)),type:ge().required()}),d=ee({initialValues:{amount:0,type:"",date:new Date},validationSchema:c,onSubmit:async(u,{resetForm:p,setErrors:S})=>{const _={...u};_.date=Q(u.date).format("YYYY-MM-DD"),R.post("/otherexpenses/add/",_).then(P=>{o(r.actions.addDivers(P.data)),o(r.actions.openCloseModalAdd()),o(r.actions.openCloseConfirm()),j.success(n(s.divers.toastAddSuccess)),p()}).catch(P=>{o(r.actions.openCloseConfirm()),j.error(n(s.global.toastError))})}}),a=async u=>{u.preventDefault();const p=await d.validateForm();console.log(p),Object.keys(p).length===0?o(r.actions.openCloseConfirm()):await d.submitForm()},g=()=>{d.handleSubmit()};return e.jsxs(e.Fragment,{children:[e.jsx(k,{open:m,onClose:()=>o(r.actions.openCloseModalAdd()),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(K,{sx:ds,children:[e.jsxs(L,{direction:"row",justifyContent:"space-between",alignItems:"center",style:{marginBottom:"20px"},children:[e.jsx(Y,{id:"modal-modal-title",variant:"h6",component:"h2",children:n(s.divers.addTitle)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>o(r.actions.openCloseModalAdd()),children:e.jsx(X,{})})]}),e.jsxs("form",{noValidate:!0,onSubmit:u=>a(u),children:[e.jsx(ce,{id:"outlined-basic",label:n(s.paiment.amount),variant:"outlined",onBlur:d.handleBlur,fullWidth:!0,type:"number",name:"amount",onChange:d.handleChange,value:d.values.amount,error:!!(d.touched.amount&&d.errors.amount),helperText:d.touched.amount&&d.errors.amount,style:{marginBottom:"15px"}}),e.jsxs(pe,{style:{marginBottom:"15px"},fullWidth:!0,error:!!(d.touched.type&&d.errors.type),children:[e.jsx(me,{id:"batiment-id",children:n(s.depense.addlabel)}),e.jsx(ue,{labelId:"batiment-id",id:"demo-simple-select",onBlur:d.handleBlur,fullWidth:!0,name:"type",onChange:d.handleChange,value:d.values.type,label:n(s.depense.addlabel),children:i.length>0?i.map(u=>e.jsx(V,{value:u.id,children:u.type})):e.jsx(V,{children:n(s.batiment.nothingToDisplay)})}),d.touched.type&&d.errors.type&&e.jsx(he,{children:d.errors.type})]}),e.jsx($,{label:n(s.entrer.date),value:d.values.date,onChange:u=>d.setFieldValue("date",u),onBlur:d.handleBlur,name:"date",sx:{width:"100%"}}),e.jsx(N,{fullWidth:!0,size:"large",sx:{mt:2},type:"submit",variant:"contained",children:n(s.global.ajouter)})]})]})}),e.jsx(fe,{confirmed:g,cancel:()=>o(r.actions.openCloseConfirm()),isConfirm:l})]})}function ps(){const{currentData:i,isModalDelete:o}=M(c=>c.divers),n=U(),{t,i18n:m}=w(),l=()=>{R.delete(`/otherexpenses/delete/${i.id}`).then(c=>{n(r.actions.deleteDivers()),n(r.actions.openCloseModalDelete()),j.success(t(s.divers.toastDeleteSuccess))}).catch(c=>{n(r.actions.openCloseModalDelete()),j.error(t(s.global.toastError))})};return e.jsx(k,{open:o,onClose:()=>n(r.actions.openCloseModalDelete()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(xe,{title:t(s.divers.deletetitle),message:t(s.divers.deletemessage),deleteFn:l,cancel:()=>n(r.actions.openCloseModalDelete())})})}function ms(){const{currentData:i,isModalDeleteProof:o}=M(c=>c.divers),n=U(),{t,i18n:m}=w(),l=()=>{R.delete(`/otherexpenses/proof/delete/${i.idFile}`).then(c=>{n(r.actions.deleteDiversProof()),n(r.actions.openCloseConfirmDeleteProof()),j.success(t(s.global.toastSuccessDeleteFile))}).catch(c=>{console.log(c),n(r.actions.openCloseConfirmDeleteProof()),j.error(t(s.global.toastError))})};return e.jsx(k,{open:o,onClose:()=>n(r.actions.openCloseConfirmDeleteProof()),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e.jsx(xe,{title:t(s.paiment.deleteTitleFile),message:t(s.paiment.deleteDescriptionFile),deleteFn:l,cancel:()=>n(r.actions.openCloseConfirmDeleteProof())})})}const us=async()=>{try{const{data:i}=await R.get("/otherexpensestype/list/");return i}catch(i){throw new Error(i)}};function hs(){const{isModalAdd:i,isModalUpdate:o}=M(t=>t.divers),n=Ce("typeDepenseDivers",us);return e.jsxs(K,{component:"main",sx:{flexGrow:1,py:8},children:[e.jsx(Le,{children:e.jsx(rs,{})}),i&&e.jsx(cs,{typeDepense:n.data}),o&&e.jsx(ls,{typeDepense:n.data}),e.jsx(ps,{}),e.jsx(ms,{})]})}function ys(){return e.jsx(e.Fragment,{children:e.jsx(hs,{})})}export{ys as default};
